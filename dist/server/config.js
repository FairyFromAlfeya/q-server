"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ensureProtocol = ensureProtocol;
exports.STATS = exports.BLOCKCHAIN_DB = exports.QRequestsMode = void 0;

/*
 * Copyright 2018-2020 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at:
 *
 * http://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 */
const QRequestsMode = {
  kafka: 'kafka',
  rest: 'rest,'
};
exports.QRequestsMode = QRequestsMode;

function ensureProtocol(address, defaultProtocol) {
  return /^\w+:\/\//gi.test(address) ? address : `${defaultProtocol}://${address}`;
}

function sortedIndex(fields) {
  return fields;
}

const BLOCKCHAIN_DB = {
  name: 'blockchain',
  collections: {
    blocks: {
      name: 'blocks',
      indexes: [sortedIndex(['seq_no', 'gen_utime']), sortedIndex(['gen_utime']), sortedIndex(['workchain_id', 'shard', 'seq_no']), sortedIndex(['workchain_id', 'seq_no']), sortedIndex(['workchain_id', 'gen_utime']), sortedIndex(['master.min_shard_gen_utime'])]
    },
    accounts: {
      name: 'accounts',
      indexes: [sortedIndex(['last_trans_lt']), sortedIndex(['balance'])]
    },
    messages: {
      name: 'messages',
      indexes: [sortedIndex(['block_id']), sortedIndex(['value', 'created_at']), sortedIndex(['src', 'value', 'created_at']), sortedIndex(['dst', 'value', 'created_at']), sortedIndex(['src', 'created_at']), sortedIndex(['dst', 'created_at']), sortedIndex(['created_lt']), sortedIndex(['created_at'])]
    },
    transactions: {
      name: 'transactions',
      indexes: [sortedIndex(['block_id']), sortedIndex(['in_msg']), sortedIndex(['out_msgs[*]']), sortedIndex(['account_addr', 'now']), sortedIndex(['now']), sortedIndex(['lt']), sortedIndex(['account_addr', 'orig_status', 'end_status'])]
    },
    blocks_signatures: {
      name: 'blocks_signatures',
      indexes: []
    }
  }
};
exports.BLOCKCHAIN_DB = BLOCKCHAIN_DB;
const STATS = {
  prefix: 'qserver.',
  doc: {
    count: 'doc.count'
  },
  query: {
    count: 'query.count',
    time: 'query.time',
    active: 'query.active'
  },
  subscription: {
    active: 'subscription.active'
  },
  waitFor: {
    active: 'waitfor.active'
  }
};
exports.STATS = STATS;

for (const [n, c] of Object.entries(BLOCKCHAIN_DB.collections)) {
  c.name = n;
  c.indexes.push(['_key']);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NlcnZlci9jb25maWcuanMiXSwibmFtZXMiOlsiUVJlcXVlc3RzTW9kZSIsImthZmthIiwicmVzdCIsImVuc3VyZVByb3RvY29sIiwiYWRkcmVzcyIsImRlZmF1bHRQcm90b2NvbCIsInRlc3QiLCJzb3J0ZWRJbmRleCIsImZpZWxkcyIsIkJMT0NLQ0hBSU5fREIiLCJuYW1lIiwiY29sbGVjdGlvbnMiLCJibG9ja3MiLCJpbmRleGVzIiwiYWNjb3VudHMiLCJtZXNzYWdlcyIsInRyYW5zYWN0aW9ucyIsImJsb2Nrc19zaWduYXR1cmVzIiwiU1RBVFMiLCJwcmVmaXgiLCJkb2MiLCJjb3VudCIsInF1ZXJ5IiwidGltZSIsImFjdGl2ZSIsInN1YnNjcmlwdGlvbiIsIndhaXRGb3IiLCJuIiwiYyIsIk9iamVjdCIsImVudHJpZXMiLCJwdXNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7QUFrQk8sTUFBTUEsYUFBYSxHQUFHO0FBQ3pCQyxFQUFBQSxLQUFLLEVBQUUsT0FEa0I7QUFFekJDLEVBQUFBLElBQUksRUFBRTtBQUZtQixDQUF0Qjs7O0FBMENBLFNBQVNDLGNBQVQsQ0FBd0JDLE9BQXhCLEVBQXlDQyxlQUF6QyxFQUEwRTtBQUM3RSxTQUFPLGNBQWNDLElBQWQsQ0FBbUJGLE9BQW5CLElBQThCQSxPQUE5QixHQUF5QyxHQUFFQyxlQUFnQixNQUFLRCxPQUFRLEVBQS9FO0FBQ0g7O0FBRUQsU0FBU0csV0FBVCxDQUFxQkMsTUFBckIsRUFBaUQ7QUFDN0MsU0FBT0EsTUFBUDtBQUNIOztBQWNNLE1BQU1DLGFBQXFCLEdBQUc7QUFDakNDLEVBQUFBLElBQUksRUFBRSxZQUQyQjtBQUVqQ0MsRUFBQUEsV0FBVyxFQUFFO0FBQ1RDLElBQUFBLE1BQU0sRUFBRTtBQUNKRixNQUFBQSxJQUFJLEVBQUUsUUFERjtBQUVKRyxNQUFBQSxPQUFPLEVBQUUsQ0FDTE4sV0FBVyxDQUFDLENBQUMsUUFBRCxFQUFXLFdBQVgsQ0FB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QSxDQUFDLENBQUNmLE9BQUYsQ0FBVWtCLElBQVYsQ0FBZSxDQUFDLE1BQUQsQ0FBZjtBQUNIIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE4LTIwMjAgVE9OIERFViBTT0xVVElPTlMgTFRELlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBTT0ZUV0FSRSBFVkFMVUFUSU9OIExpY2Vuc2UgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxuICogdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlXG4gKiBMaWNlbnNlIGF0OlxuICpcbiAqIGh0dHA6Ly93d3cudG9uLmRldi9saWNlbnNlc1xuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgVE9OIERFViBzb2Z0d2FyZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vLyBAZmxvd1xuXG5leHBvcnQgY29uc3QgUVJlcXVlc3RzTW9kZSA9IHtcbiAgICBrYWZrYTogJ2thZmthJyxcbiAgICByZXN0OiAncmVzdCwnXG59O1xuXG5leHBvcnQgdHlwZSBRRGJDb25maWcgPSB7XG4gICAgc2VydmVyOiBzdHJpbmcsXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGF1dGg6IHN0cmluZyxcbiAgICBtYXhTb2NrZXRzOiBudW1iZXIsXG59O1xuXG5leHBvcnQgdHlwZSBRQ29uZmlnID0ge1xuICAgIHNlcnZlcjoge1xuICAgICAgICBob3N0OiBzdHJpbmcsXG4gICAgICAgIHBvcnQ6IG51bWJlcixcbiAgICAgICAgcnBjUG9ydDogc3RyaW5nLFxuICAgIH0sXG4gICAgcmVxdWVzdHM6IHtcbiAgICAgICAgbW9kZTogJ2thZmthJyB8ICdyZXN0JyxcbiAgICAgICAgc2VydmVyOiBzdHJpbmcsXG4gICAgICAgIHRvcGljOiBzdHJpbmcsXG4gICAgfSxcbiAgICBkYXRhYmFzZTogUURiQ29uZmlnLFxuICAgIHNsb3dEYXRhYmFzZTogUURiQ29uZmlnLFxuICAgIGxpc3RlbmVyOiB7XG4gICAgICAgIHJlc3RhcnRUaW1lb3V0OiBudW1iZXJcbiAgICB9LFxuICAgIGF1dGhvcml6YXRpb246IHtcbiAgICAgICAgZW5kcG9pbnQ6IHN0cmluZyxcbiAgICB9LFxuICAgIGphZWdlcjoge1xuICAgICAgICBlbmRwb2ludDogc3RyaW5nLFxuICAgICAgICBzZXJ2aWNlOiBzdHJpbmcsXG4gICAgICAgIHRhZ3M6IHsgW3N0cmluZ106IHN0cmluZyB9XG4gICAgfSxcbiAgICBzdGF0c2Q6IHtcbiAgICAgICAgc2VydmVyOiBzdHJpbmcsXG4gICAgfSxcbiAgICBtYW1BY2Nlc3NLZXlzOiBTZXQ8c3RyaW5nPixcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVuc3VyZVByb3RvY29sKGFkZHJlc3M6IHN0cmluZywgZGVmYXVsdFByb3RvY29sOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiAvXlxcdys6XFwvXFwvL2dpLnRlc3QoYWRkcmVzcykgPyBhZGRyZXNzIDogYCR7ZGVmYXVsdFByb3RvY29sfTovLyR7YWRkcmVzc31gO1xufVxuXG5mdW5jdGlvbiBzb3J0ZWRJbmRleChmaWVsZHM6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBmaWVsZHM7XG59XG5cbmV4cG9ydCB0eXBlIENvbGxlY3Rpb25JbmZvID0ge1xuICAgIG5hbWU6IHN0cmluZyxcbiAgICBpbmRleGVzOiBzdHJpbmdbXVtdLFxufTtcblxuZXhwb3J0IHR5cGUgRGJJbmZvID0ge1xuICAgIG5hbWU6IHN0cmluZyxcbiAgICBjb2xsZWN0aW9uczoge1xuICAgICAgICBbc3RyaW5nXTogQ29sbGVjdGlvbkluZm8sXG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgQkxPQ0tDSEFJTl9EQjogRGJJbmZvID0ge1xuICAgIG5hbWU6ICdibG9ja2NoYWluJyxcbiAgICBjb2xsZWN0aW9uczoge1xuICAgICAgICBibG9ja3M6IHtcbiAgICAgICAgICAgIG5hbWU6ICdibG9ja3MnLFxuICAgICAgICAgICAgaW5kZXhlczogW1xuICAgICAgICAgICAgICAgIHNvcnRlZEluZGV4KFsnc2VxX25vJywgJ2dlbl91dGltZSddKSxcbiAgICAgICAgICAgICAgICBzb3J0ZWRJbmRleChbJ2dlbl91dGltZSddKSxcbiAgICAgICAgICAgICAgICBzb3J0ZWRJbmRleChbJ3dvcmtjaGFpbl9pZCcsICdzaGFyZCcsICdzZXFfbm8nXSksXG4gICAgICAgICAgICAgICAgc29ydGVkSW5kZXgoWyd3b3JrY2hhaW5faWQnLCAnc2VxX25vJ10pLFxuICAgICAgICAgICAgICAgIHNvcnRlZEluZGV4KFsnd29ya2NoYWluX2lkJywgJ2dlbl91dGltZSddKSxcbiAgICAgICAgICAgICAgICBzb3J0ZWRJbmRleChbJ21hc3Rlci5taW5fc2hhcmRfZ2VuX3V0aW1lJ10pLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICAgYWNjb3VudHM6IHtcbiAgICAgICAgICAgIG5hbWU6ICdhY2NvdW50cycsXG4gICAgICAgICAgICBpbmRleGVzOiBbXG4gICAgICAgICAgICAgICAgc29ydGVkSW5kZXgoWydsYXN0X3RyYW5zX2x0J10pLFxuICAgICAgICAgICAgICAgIHNvcnRlZEluZGV4KFsnYmFsYW5jZSddKSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICBuYW1lOiAnbWVzc2FnZXMnLFxuICAgICAgICAgICAgaW5kZXhlczogW1xuICAgICAgICAgICAgICAgIHNvcnRlZEluZGV4KFsnYmxvY2tfaWQnXSksXG4gICAgICAgICAgICAgICAgc29ydGVkSW5kZXgoWyd2YWx1ZScsICdjcmVhdGVkX2F0J10pLFxuICAgICAgICAgICAgICAgIHNvcnRlZEluZGV4KFsnc3JjJywgJ3ZhbHVlJywgJ2NyZWF0ZWRfYXQnXSksXG4gICAgICAgICAgICAgICAgc29ydGVkSW5kZXgoWydkc3QnLCAndmFsdWUnLCAnY3JlYXRlZF9hdCddKSxcbiAgICAgICAgICAgICAgICBzb3J0ZWRJbmRleChbJ3NyYycsICdjcmVhdGVkX2F0J10pLFxuICAgICAgICAgICAgICAgIHNvcnRlZEluZGV4KFsnZHN0JywgJ2NyZWF0ZWRfYXQnXSksXG4gICAgICAgICAgICAgICAgc29ydGVkSW5kZXgoWydjcmVhdGVkX2x0J10pLFxuICAgICAgICAgICAgICAgIHNvcnRlZEluZGV4KFsnY3JlYXRlZF9hdCddKSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIHRyYW5zYWN0aW9uczoge1xuICAgICAgICAgICAgbmFtZTogJ3RyYW5zYWN0aW9ucycsXG4gICAgICAgICAgICBpbmRleGVzOiBbXG4gICAgICAgICAgICAgICAgc29ydGVkSW5kZXgoWydibG9ja19pZCddKSxcbiAgICAgICAgICAgICAgICBzb3J0ZWRJbmRleChbJ2luX21zZyddKSxcbiAgICAgICAgICAgICAgICBzb3J0ZWRJbmRleChbJ291dF9tc2dzWypdJ10pLFxuICAgICAgICAgICAgICAgIHNvcnRlZEluZGV4KFsnYWNjb3VudF9hZGRyJywgJ25vdyddKSxcbiAgICAgICAgICAgICAgICBzb3J0ZWRJbmRleChbJ25vdyddKSxcbiAgICAgICAgICAgICAgICBzb3J0ZWRJbmRleChbJ2x0J10pLFxuICAgICAgICAgICAgICAgIHNvcnRlZEluZGV4KFsnYWNjb3VudF9hZGRyJywgJ29yaWdfc3RhdHVzJywgJ2VuZF9zdGF0dXMnXSksXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBibG9ja3Nfc2lnbmF0dXJlczoge1xuICAgICAgICAgICAgbmFtZTogJ2Jsb2Nrc19zaWduYXR1cmVzJyxcbiAgICAgICAgICAgIGluZGV4ZXM6IFtdLFxuICAgICAgICB9LFxuICAgIH1cbn07XG5cbmV4cG9ydCBjb25zdCBTVEFUUyA9IHtcbiAgICBwcmVmaXg6ICdxc2VydmVyLicsXG4gICAgZG9jOiB7XG4gICAgICAgIGNvdW50OiAnZG9jLmNvdW50JyxcbiAgICB9LFxuICAgIHF1ZXJ5OiB7XG4gICAgICAgIGNvdW50OiAncXVlcnkuY291bnQnLFxuICAgICAgICB0aW1lOiAncXVlcnkudGltZScsXG4gICAgICAgIGFjdGl2ZTogJ3F1ZXJ5LmFjdGl2ZScsXG4gICAgfSxcbiAgICBzdWJzY3JpcHRpb246IHtcbiAgICAgICAgYWN0aXZlOiAnc3Vic2NyaXB0aW9uLmFjdGl2ZScsXG4gICAgfSxcbiAgICB3YWl0Rm9yOiB7XG4gICAgICAgIGFjdGl2ZTogJ3dhaXRmb3IuYWN0aXZlJyxcbiAgICB9LFxufTtcblxuZm9yIChjb25zdCBbbiwgY10gb2YgKE9iamVjdC5lbnRyaWVzKEJMT0NLQ0hBSU5fREIuY29sbGVjdGlvbnMpOiBBcnJheTxhbnk+KSkge1xuICAgIGMubmFtZSA9IG47XG4gICAgYy5pbmRleGVzLnB1c2goWydfa2V5J10pO1xufVxuIl19