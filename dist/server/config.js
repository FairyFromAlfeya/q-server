"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ensureProtocol = ensureProtocol;
exports.resolveOptions = resolveOptions;
exports.createConfig = createConfig;
exports.STATS = exports.BLOCKCHAIN_DB = exports.defaultOptions = exports.QRequestsMode = void 0;

var _os = _interopRequireDefault(require("os"));

var _dbTypes = require("./db-types");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
 * Copyright 2018-2020 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at:
 *
 * http://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 */
const QRequestsMode = {
  kafka: 'kafka',
  rest: 'rest,'
};
exports.QRequestsMode = QRequestsMode;

function ensureProtocol(address, defaultProtocol) {
  return /^\w+:\/\//gi.test(address) ? address : `${defaultProtocol}://${address}`;
}

function getIp() {
  const ipv4 = Object.values(_os.default.networkInterfaces()).flatMap(x => x).find(x => x.family === 'IPv4' && !x.internal);
  return ipv4 && ipv4.address;
}

function parseTags(s) {
  const tags = {};
  s.split(',').forEach(t => {
    const i = t.indexOf('=');

    if (i >= 0) {
      tags[t.substr(0, i)] = t.substr(i + 1);
    } else {
      tags[t] = '';
    }
  });
  return tags;
}

const defaultOptions = {
  host: getIp(),
  port: '4000',
  rpcPort: '',
  requestsMode: 'kafka',
  requestsServer: 'kafka:9092',
  requestsTopic: 'requests',
  dbServer: 'arangodb:8529',
  dbName: 'blockchain',
  dbAuth: '',
  dbMaxSockets: '100',
  slowDbServer: '',
  slowDbName: '',
  slowDbAuth: '',
  slowDbMaxSockets: '3',
  authEndpoint: '',
  mamAccessKeys: '',
  jaegerEndpoint: '',
  traceService: 'Q Server',
  traceTags: '',
  statsdServer: '',
  statsdTags: '',
  keepAlive: '60000'
};
exports.defaultOptions = defaultOptions;

function resolveOptions(options, env, defaults) {
  return {
    host: options.host || env.Q_SERVER_HOST || defaults.host,
    port: options.port || env.Q_SERVER_PORT || defaults.port,
    rpcPort: options.rpcPort || env.Q_SERVER_RPC_PORT || defaults.rpcPort,
    requestsMode: options.requestsMode || env.Q_REQUESTS_MODE || defaults.requestsMode,
    requestsServer: options.requestsServer || env.Q_REQUESTS_SERVER || defaults.requestsServer,
    requestsTopic: options.requestsTopic || env.Q_REQUESTS_TOPIC || defaults.requestsTopic,
    dbServer: options.dbServer || env.Q_DATABASE_SERVER || defaults.dbServer,
    dbName: options.dbName || env.Q_DATABASE_NAME || defaults.dbName,
    dbAuth: options.dbAuth || env.Q_DATABASE_AUTH || defaults.dbAuth,
    dbMaxSockets: options.dbMaxSockets || env.Q_DATABASE_MAX_SOCKETS || defaults.dbMaxSockets,
    slowDbServer: options.slowDbServer || env.Q_SLOW_DATABASE_SERVER || defaults.slowDbServer,
    slowDbName: options.slowDbName || env.Q_SLOW_DATABASE_NAME || defaults.slowDbName,
    slowDbAuth: options.slowDbAuth || env.Q_SLOW_DATABASE_AUTH || defaults.slowDbAuth,
    slowDbMaxSockets: options.slowDbMaxSockets || env.Q_SLOW_DATABASE_MAX_SOCKETS || defaults.slowDbMaxSockets,
    authEndpoint: options.authEndpoint || env.Q_AUTH_ENDPOINT || defaults.authEndpoint,
    mamAccessKeys: options.mamAccessKeys || env.Q_MAM_ACCESS_KEYS || defaults.mamAccessKeys,
    jaegerEndpoint: options.jaegerEndpoint || env.Q_JAEGER_ENDPOINT || defaults.jaegerEndpoint,
    traceService: options.traceService || env.Q_TRACE_SERVICE || defaults.traceService,
    traceTags: options.traceTags || env.Q_TRACE_TAGS || defaults.traceTags,
    statsdServer: options.statsdServer || env.Q_STATSD_SERVER || defaults.statsdServer,
    statsdTags: options.statsdTags || env.Q_STATSD_TAGS || defaults.statsdTags,
    keepAlive: options.keepAlive || env.Q_KEEP_ALIVE || defaults.keepAlive
  };
}

function createConfig(options, env, defaults) {
  const resolvedOptions = resolveOptions(options, env, defaults);
  return {
    server: {
      host: resolvedOptions.host,
      port: Number.parseInt(resolvedOptions.port),
      rpcPort: resolvedOptions.rpcPort,
      keepAlive: Number.parseInt(resolvedOptions.keepAlive)
    },
    requests: {
      mode: resolvedOptions.requestsMode,
      server: resolvedOptions.requestsServer,
      topic: resolvedOptions.requestsTopic
    },
    database: {
      server: resolvedOptions.dbServer,
      name: resolvedOptions.dbName,
      auth: resolvedOptions.dbAuth,
      maxSockets: Number(resolvedOptions.dbMaxSockets)
    },
    slowDatabase: {
      server: resolvedOptions.slowDbServer || resolvedOptions.dbServer,
      name: resolvedOptions.slowDbName || resolvedOptions.dbName,
      auth: resolvedOptions.slowDbAuth || resolvedOptions.dbAuth,
      maxSockets: Number(resolvedOptions.slowDbMaxSockets)
    },
    listener: {
      restartTimeout: 1000
    },
    authorization: {
      endpoint: resolvedOptions.authEndpoint
    },
    jaeger: {
      endpoint: resolvedOptions.jaegerEndpoint,
      service: resolvedOptions.traceService,
      tags: parseTags(resolvedOptions.traceTags)
    },
    statsd: {
      server: resolvedOptions.statsdServer,
      tags: (resolvedOptions.statsdTags || '').split(',').map(x => x.trim()).filter(x => x)
    },
    mamAccessKeys: new Set((resolvedOptions.mamAccessKeys || '').split(','))
  };
}

const INDEXES = {
  blocks: ['seq_no, gen_utime', 'gen_utime', 'workchain_id, shard, seq_no', 'workchain_id, seq_no', 'workchain_id, gen_utime', 'master.min_shard_gen_utime'],
  accounts: ['last_trans_lt', 'balance'],
  messages: ['block_id', 'value, created_at', 'src, value, created_at', 'dst, value, created_at', 'src, created_at', 'dst, created_at', 'src, dst, created_at, _key', 'created_lt', 'created_at'],
  transactions: ['block_id', 'in_msg', 'out_msgs[*]', 'account_addr, now', 'now', 'lt', 'account_addr, orig_status, end_status', 'now, account_addr, lt'],
  blocks_signatures: ['signatures[*].node_id, gen_utime']
};
const BLOCKCHAIN_DB = {
  lastUpdateTime: 0,
  name: 'blockchain',
  collections: {}
};
exports.BLOCKCHAIN_DB = BLOCKCHAIN_DB;
Object.entries(INDEXES).forEach(([name, indexes]) => {
  BLOCKCHAIN_DB.collections[name] = {
    name,
    indexes: ['_key', ...indexes].map(_dbTypes.parseIndex)
  };
});
const STATS = {
  prefix: 'qserver.',
  doc: {
    count: 'doc.count'
  },
  post: {
    count: 'post.count',
    failed: 'post.failed'
  },
  query: {
    count: 'query.count',
    time: 'query.time',
    active: 'query.active',
    failed: 'query.failed',
    slow: 'query.slow'
  },
  subscription: {
    active: 'subscription.active'
  },
  waitFor: {
    active: 'waitfor.active'
  }
};
exports.STATS = STATS;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NlcnZlci9jb25maWcuanMiXSwibmFtZXMiOlsiUVJlcXVlc3RzTW9kZSIsImthZmthIiwicmVzdCIsImVuc3VyZVByb3RvY29sIiwiYWRkcmVzcyIsImRlZmF1bHRQcm90b2NvbCIsInRlc3QiLCJnZXRJcCIsImlwdjQiLCJPYmplY3QiLCJ2YWx1ZXMiLCJvcyIsIm5ldHdvcmtJbnRlcmZhY2VzIiwiZmxhdE1hcCIsIngiLCJmaW5kIiwiZmFtaWx5IiwiaW50ZXJuYWwiLCJwYXJzZVRhZ3MiLCJzIiwidGFncyIsInNwbGl0IiwiZm9yRWFjaCIsInQiLCJpIiwiaW5kZXhPZiIsInN1YnN0ciIsImRlZmF1bHRPcHRpb25zIiwiaG9zdCIsInBvcnQiLCJycGNQb3J0IiwicmVxdWVzdHNNb2RlIiwicmVxdWVzdHNTZXJ2ZXIiLCJyZXF1ZXN0c1RvcGljIiwiZGJTZXJ2ZXIiLCJkYk5hbWUiLCJkYkF1dGgiLCJkYk1heFNvY2tldHMiLCJzbG93RGJTZXJ2ZXIiLCJzbG93RGJOYW1lIiwic2xvd0RiQXV0aCIsInNsb3dEYk1heFNvY2tldHMiLCJhdXRoRW5kcG9pbnQiLCJtYW1BY2Nlc3NLZXlzIiwiamFlZ2VyRW5kcG9pbnQiLCJ0cmFjZVNlcnZpY2UiLCJ0cmFjZVRhZ3MiLCJzdGF0c2RTZXJ2ZXIiLCJzdGF0c2RUYWdzIiwia2VlcEFsaXZlIiwicmVzb2x2ZU9wdGlvbnMiLCJvcHRpb25zIiwiZW52IiwiZGVmYXVsdHMiLCJRX1NFUlZFUl9IT1NUIiwiUV9TRVJWRVJfUE9SVCIsIlFfU0VSVkVSX1JQQ19QT1JUIiwiUV9SRVFVRVNUU19NT0RFIiwiUV9SRVFVRVNUU19TRVJWRVIiLCJRX1JFUVVFU1RTX1RPUElDIiwiUV9EQVRBQkFTRV9TRVJWRVIiLCJRX0RBVEFCQVNFX05BTUUiLCJRX0RBVEFCQVNFX0FVVEgiLCJRX0RBVEFCQVNFX01BWF9TT0NLRVRTIiwiUV9TTE9XX0RBVEFCQVNFX1NFUlZFUiIsIlFfU0xPV19EQVRBQkFTRV9OQU1FIiwiUV9TTE9XX0RBVEFCQVNFX0FVVEgiLCJRX1NMT1dfREFUQUJBU0VfTUFYX1NPQ0tFVFMiLCJRX0FVVEhfRU5EUE9JTlQiLCJRX01BTV9BQ0NFU1NfS0VZUyIsIlFfSkFFR0VSX0VORFBPSU5UIiwiUV9UUkFDRV9TRVJWSUNFIiwiUV9UUkFDRV9UQUdTIiwiUV9TVEFUU0RfU0VSVkVSIiwiUV9TVEFUU0RfVEFHUyIsIlFfS0VFUF9BTElWRSIsImNyZWF0ZUNvbmZpZyIsInJlc29sdmVkT3B0aW9ucyIsInNlcnZlciIsIk51bWJlciIsInBhcnNlSW50IiwicmVxdWVzdHMiLCJtb2RlIiwidG9waWMiLCJkYXRhYmFzZSIsIm5hbWUiLCJhdXRoIiwibWF4U29ja2V0cyIsInNsb3dEYXRhYmFzZSIsImxpc3RlbmVyIiwicmVzdGFydFRpbWVvdXQiLCJhdXRob3JpemF0aW9uIiwiZW5kcG9pbnQiLCJqYWVnZXIiLCJzZXJ2aWNlIiwic3RhdHNkIiwibWFwIiwidHJpbSIsImZpbHRlciIsIlNldCIsIklOREVYRVMiLCJibG9ja3MiLCJhY2NvdW50cyIsIm1lc3NhZ2VzIiwidHJhbnNhY3Rpb25zIiwiYmxvY2tzX3NpZ25hdHVyZXMiLCJCTE9DS0NIQUlOX0RCIiwibGFzdFVwZGF0ZVRpbWUiLCJjb2xsZWN0aW9ucyIsImVudHJpZXMiLCJpbmRleGVzIiwicGFyc2VJbmRleCIsIlNUQVRTIiwicHJlZml4IiwiZG9jIiwiY291bnQiLCJwb3N0IiwiZmFpbGVkIiwicXVlcnkiLCJ0aW1lIiwiYWN0aXZlIiwic2xvdyIsInN1YnNjcmlwdGlvbiIsIndhaXRGb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFrQkE7O0FBQ0E7Ozs7QUFuQkE7Ozs7Ozs7Ozs7Ozs7OztBQXFCTyxNQUFNQSxhQUFhLEdBQUc7QUFDekJDLEVBQUFBLEtBQUssRUFBRSxPQURrQjtBQUV6QkMsRUFBQUEsSUFBSSxFQUFFO0FBRm1CLENBQXRCOzs7QUErRkEsU0FBU0MsY0FBVCxDQUF3QkMsT0FBeEIsRUFBeUNDLGVBQXpDLEVBQTBFO0FBQzdFLFNBQU8sY0FBY0MsSUFBZCxDQUFtQkYsT0FBbkIsSUFBOEJBLE9BQTlCLEdBQXlDLEdBQUVDLGVBQWdCLE1BQUtELE9BQVEsRUFBL0U7QUFDSDs7QUFFRCxTQUFTRyxLQUFULEdBQXlCO0FBQ3JCLFFBQU1DLElBQUksR0FBSUMsTUFBTSxDQUFDQyxNQUFQLENBQWNDLFlBQUdDLGlCQUFILEVBQWQsQ0FBRCxDQUNSQyxPQURRLENBQ0FDLENBQUMsSUFBSUEsQ0FETCxFQUVSQyxJQUZRLENBRUhELENBQUMsSUFBSUEsQ0FBQyxDQUFDRSxNQUFGLEtBQWEsTUFBYixJQUF1QixDQUFDRixDQUFDLENBQUNHLFFBRjVCLENBQWI7QUFHQSxTQUFPVCxJQUFJLElBQUlBLElBQUksQ0FBQ0osT0FBcEI7QUFDSDs7QUFFRCxTQUFTYyxTQUFULENBQW1CQyxDQUFuQixFQUFvRDtBQUNoRCxRQUFNQyxJQUEwQixHQUFHLEVBQW5DO0FBQ0FELEVBQUFBLENBQUMsQ0FBQ0UsS0FBRixDQUFRLEdBQVIsRUFBYUMsT0FBYixDQUFzQkMsQ0FBRCxJQUFPO0FBQ3hCLFVBQU1DLENBQUMsR0FBR0QsQ0FBQyxDQUFDRSxPQUFGLENBQVUsR0FBVixDQUFWOztBQUNBLFFBQUlELENBQUMsSUFBSSxDQUFULEVBQVk7QUFDUkosTUFBQUEsSUFBSSxDQUFDRyxDQUFDLENBQUNHLE1BQUYsQ0FBUyxDQUFULEVBQVlGLENBQVosQ0FBRCxDQUFKLEdBQXVCRCxDQUFDLENBQUNHLE1BQUYsQ0FBU0YsQ0FBQyxHQUFHLENBQWIsQ0FBdkI7QUFDSCxLQUZELE1BRU87QUFDSEosTUFBQUEsSUFBSSxDQUFDRyxDQUFELENBQUosR0FBVSxFQUFWO0FBQ0g7QUFDSixHQVBEO0FBUUEsU0FBT0gsSUFBUDtBQUVIOztBQUVNLE1BQU1PLGNBQThCLEdBQUc7QUFDMUNDLEVBQUFBLElBQUksRUFBRXJCLEtBQUssRUFEK0I7QUFFMUNzQixFQUFBQSxJQUFJLEVBQUUsTUFGb0M7QUFHMUNDLEVBQUFBLE9BQU8sRUFBRSxFQUhpQztBQUkxQ0MsRUFBQUEsWUFBWSxFQUFFLE9BSjRCO0FBSzFDQyxFQUFBQSxjQUFjLEVBQUUsWUFMMEI7QUFNMUNDLEVBQUFBLGFBQWEsRUFBRSxVQU4yQjtBQU8xQ0MsRUFBQUEsUUFBUSxFQUFFLGVBUGdDO0FBUTFDQyxFQUFBQSxNQUFNLEVBQUUsWUFSa0M7QUFTMUNDLEVBQUFBLE1BQU0sRUFBRSxFQVRrQztBQVUxQ0MsRUFBQUEsWUFBWSxFQUFFLEtBVjRCO0FBVzFDQyxFQUFBQSxZQUFZLEVBQUUsRUFYNEI7QUFZMUNDLEVBQUFBLFVBQVUsRUFBRSxFQVo4QjtBQWExQ0MsRUFBQUEsVUFBVSxFQUFFLEVBYjhCO0FBYzFDQyxFQUFBQSxnQkFBZ0IsRUFBRSxHQWR3QjtBQWUxQ0MsRUFBQUEsWUFBWSxFQUFFLEVBZjRCO0FBZ0IxQ0MsRUFBQUEsYUFBYSxFQUFFLEVBaEIyQjtBQWlCMUNDLEVBQUFBLGNBQWMsRUFBRSxFQWpCMEI7QUFrQjFDQyxFQUFBQSxZQUFZLEVBQUUsVUFsQjRCO0FBbUIxQ0MsRUFBQUEsU0FBUyxFQUFFLEVBbkIrQjtBQW9CMUNDLEVBQUFBLFlBQVksRUFBRSxFQXBCNEI7QUFxQjFDQyxFQUFBQSxVQUFVLEVBQUUsRUFyQjhCO0FBc0IxQ0MsRUFBQUEsU0FBUyxFQUFFO0FBdEIrQixDQUF2Qzs7O0FBeUJBLFNBQVNDLGNBQVQsQ0FBd0JDLE9BQXhCLEVBQXlEQyxHQUF6RCxFQUEwRUMsUUFBMUUsRUFBb0g7QUFDdkgsU0FBTztBQUNIekIsSUFBQUEsSUFBSSxFQUFFdUIsT0FBTyxDQUFDdkIsSUFBUixJQUFnQndCLEdBQUcsQ0FBQ0UsYUFBcEIsSUFBcUNELFFBQVEsQ0FBQ3pCLElBRGpEO0FBRUhDLElBQUFBLElBQUksRUFBRXNCLE9BQU8sQ0FBQ3RCLElBQVIsSUFBZ0J1QixHQUFHLENBQUNHLGFBQXBCLElBQXFDRixRQUFRLENBQUN4QixJQUZqRDtBQUdIQyxJQUFBQSxPQUFPLEVBQUVxQixPQUFPLENBQUNyQixPQUFSLElBQW1Cc0IsR0FBRyxDQUFDSSxpQkFBdkIsSUFBNENILFFBQVEsQ0FBQ3ZCLE9BSDNEO0FBSUhDLElBQUFBLFlBQVksRUFBRW9CLE9BQU8sQ0FBQ3BCLFlBQVIsSUFBeUJxQixHQUFHLENBQUNLLGVBQTdCLElBQXNESixRQUFRLENBQUN0QixZQUoxRTtBQUtIQyxJQUFBQSxjQUFjLEVBQUVtQixPQUFPLENBQUNuQixjQUFSLElBQTBCb0IsR0FBRyxDQUFDTSxpQkFBOUIsSUFBbURMLFFBQVEsQ0FBQ3JCLGNBTHpFO0FBTUhDLElBQUFBLGFBQWEsRUFBRWtCLE9BQU8sQ0FBQ2xCLGFBQVIsSUFBeUJtQixHQUFHLENBQUNPLGdCQUE3QixJQUFpRE4sUUFBUSxDQUFDcEIsYUFOdEU7QUFPSEMsSUFBQUEsUUFBUSxFQUFFaUIsT0FBTyxDQUFDakIsUUFBUixJQUFvQmtCLEdBQUcsQ0FBQ1EsaUJBQXhCLElBQTZDUCxRQUFRLENBQUNuQixRQVA3RDtBQVFIQyxJQUFBQSxNQUFNLEVBQUVnQixPQUFPLENBQUNoQixNQUFSLElBQWtCaUIsR0FBRyxDQUFDUyxlQUF0QixJQUF5Q1IsUUFBUSxDQUFDbEIsTUFSdkQ7QUFTSEMsSUFBQUEsTUFBTSxFQUFFZSxPQUFPLENBQUNmLE1BQVIsSUFBa0JnQixHQUFHLENBQUNVLGVBQXRCLElBQXlDVCxRQUFRLENBQUNqQixNQVR2RDtBQVVIQyxJQUFBQSxZQUFZLEVBQUVjLE9BQU8sQ0FBQ2QsWUFBUixJQUF3QmUsR0FBRyxDQUFDVyxzQkFBNUIsSUFBc0RWLFFBQVEsQ0FBQ2hCLFlBVjFFO0FBV0hDLElBQUFBLFlBQVksRUFBRWEsT0FBTyxDQUFDYixZQUFSLElBQXdCYyxHQUFHLENBQUNZLHNCQUE1QixJQUFzRFgsUUFBUSxDQUFDZixZQVgxRTtBQVlIQyxJQUFBQSxVQUFVLEVBQUVZLE9BQU8sQ0FBQ1osVUFBUixJQUFzQmEsR0FBRyxDQUFDYSxvQkFBMUIsSUFBa0RaLFFBQVEsQ0FBQ2QsVUFacEU7QUFhSEMsSUFBQUEsVUFBVSxFQUFFVyxPQUFPLENBQUNYLFVBQVIsSUFBc0JZLEdBQUcsQ0FBQ2Msb0JBQTFCLElBQWtEYixRQUFRLENBQUNiLFVBYnBFO0FBY0hDLElBQUFBLGdCQUFnQixFQUFFVSxPQUFPLENBQUNWLGdCQUFSLElBQTRCVyxHQUFHLENBQUNlLDJCQUFoQyxJQUErRGQsUUFBUSxDQUFDWixnQkFkdkY7QUFlSEMsSUFBQUEsWUFBWSxFQUFFUyxPQUFPLENBQUNULFlBQVIsSUFBd0JVLEdBQUcsQ0FBQ2dCLGVBQTVCLElBQStDZixRQUFRLENBQUNYLFlBZm5FO0FBZ0JIQyxJQUFBQSxhQUFhLEVBQUVRLE9BQU8sQ0FBQ1IsYUFBUixJQUF5QlMsR0FBRyxDQUFDaUIsaUJBQTdCLElBQWtEaEIsUUFBUSxDQUFDVixhQWhCdkU7QUFpQkhDLElBQUFBLGNBQWMsRUFBRU8sT0FBTyxDQUFDUCxjQUFSLElBQTBCUSxHQUFHLENBQUNrQixpQkFBOUIsSUFBbURqQixRQUFRLENBQUNULGNBakJ6RTtBQWtCSEMsSUFBQUEsWUFBWSxFQUFFTSxPQUFPLENBQUNOLFlBQVIsSUFBd0JPLEdBQUcsQ0FBQ21CLGVBQTVCLElBQStDbEIsUUFBUSxDQUFDUixZQWxCbkU7QUFtQkhDLElBQUFBLFNBQVMsRUFBRUssT0FBTyxDQUFDTCxTQUFSLElBQXFCTSxHQUFHLENBQUNvQixZQUF6QixJQUF5Q25CLFFBQVEsQ0FBQ1AsU0FuQjFEO0FBb0JIQyxJQUFBQSxZQUFZLEVBQUVJLE9BQU8sQ0FBQ0osWUFBUixJQUF3QkssR0FBRyxDQUFDcUIsZUFBNUIsSUFBK0NwQixRQUFRLENBQUNOLFlBcEJuRTtBQXFCSEMsSUFBQUEsVUFBVSxFQUFFRyxPQUFPLENBQUNILFVBQVIsSUFBc0JJLEdBQUcsQ0FBQ3NCLGFBQTFCLElBQTJDckIsUUFBUSxDQUFDTCxVQXJCN0Q7QUFzQkhDLElBQUFBLFNBQVMsRUFBRUUsT0FBTyxDQUFDRixTQUFSLElBQXFCRyxHQUFHLENBQUN1QixZQUF6QixJQUF5Q3RCLFFBQVEsQ0FBQ0o7QUF0QjFELEdBQVA7QUF3Qkg7O0FBRU0sU0FBUzJCLFlBQVQsQ0FBc0J6QixPQUF0QixFQUF1REMsR0FBdkQsRUFBd0VDLFFBQXhFLEVBQTJHO0FBQzlHLFFBQU13QixlQUFlLEdBQUczQixjQUFjLENBQUNDLE9BQUQsRUFBVUMsR0FBVixFQUFlQyxRQUFmLENBQXRDO0FBQ0EsU0FBTztBQUNIeUIsSUFBQUEsTUFBTSxFQUFFO0FBQ0psRCxNQUFBQSxJQUFJLEVBQUVpRCxlQUFlLENBQUNqRCxJQURsQjtBQUVKQyxNQUFBQSxJQUFJLEVBQUVrRCxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JILGVBQWUsQ0FBQ2hELElBQWhDLENBRkY7QUFHSkMsTUFBQUEsT0FBTyxFQUFFK0MsZUFBZSxDQUFDL0MsT0FIckI7QUFJSm1CLE1BQUFBLFNBQVMsRUFBRThCLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkgsZUFBZSxDQUFDNUIsU0FBaEM7QUFKUCxLQURMO0FBT0hnQyxJQUFBQSxRQUFRLEVBQUU7QUFDTkMsTUFBQUEsSUFBSSxFQUFFTCxlQUFlLENBQUM5QyxZQURoQjtBQUVOK0MsTUFBQUEsTUFBTSxFQUFFRCxlQUFlLENBQUM3QyxjQUZsQjtBQUdObUQsTUFBQUEsS0FBSyxFQUFFTixlQUFlLENBQUM1QztBQUhqQixLQVBQO0FBWUhtRCxJQUFBQSxRQUFRLEVBQUU7QUFDTk4sTUFBQUEsTUFBTSxFQUFFRCxlQUFlLENBQUMzQyxRQURsQjtBQUVObUQsTUFBQUEsSUFBSSxFQUFFUixlQUFlLENBQUMxQyxNQUZoQjtBQUdObUQsTUFBQUEsSUFBSSxFQUFFVCxlQUFlLENBQUN6QyxNQUhoQjtBQUlObUQsTUFBQUEsVUFBVSxFQUFFUixNQUFNLENBQUNGLGVBQWUsQ0FBQ3hDLFlBQWpCO0FBSlosS0FaUDtBQWtCSG1ELElBQUFBLFlBQVksRUFBRTtBQUNWVixNQUFBQSxNQUFNLEVBQUVELGVBQWUsQ0FBQ3ZDLFlBQWhCLElBQWdDdUMsZUFBZSxDQUFDM0MsUUFEOUM7QUFFVm1ELE1BQUFBLElBQUksRUFBRVIsZUFBZSxDQUFDdEMsVUFBaEIsSUFBOEJzQyxlQUFlLENBQUMxQyxNQUYxQztBQUdWbUQsTUFBQUEsSUFBSSxFQUFFVCxlQUFlLENBQUNyQyxVQUFoQixJQUE4QnFDLGVBQWUsQ0FBQ3pDLE1BSDFDO0FBSVZtRCxNQUFBQSxVQUFVLEVBQUVSLE1BQU0sQ0FBQ0YsZUFBZSxDQUFDcEMsZ0JBQWpCO0FBSlIsS0FsQlg7QUF3QkhnRCxJQUFBQSxRQUFRLEVBQUU7QUFDTkMsTUFBQUEsY0FBYyxFQUFFO0FBRFYsS0F4QlA7QUEyQkhDLElBQUFBLGFBQWEsRUFBRTtBQUNYQyxNQUFBQSxRQUFRLEVBQUVmLGVBQWUsQ0FBQ25DO0FBRGYsS0EzQlo7QUE4QkhtRCxJQUFBQSxNQUFNLEVBQUU7QUFDSkQsTUFBQUEsUUFBUSxFQUFFZixlQUFlLENBQUNqQyxjQUR0QjtBQUVKa0QsTUFBQUEsT0FBTyxFQUFFakIsZUFBZSxDQUFDaEMsWUFGckI7QUFHSnpCLE1BQUFBLElBQUksRUFBRUYsU0FBUyxDQUFDMkQsZUFBZSxDQUFDL0IsU0FBakI7QUFIWCxLQTlCTDtBQW1DSGlELElBQUFBLE1BQU0sRUFBRTtBQUNKakIsTUFBQUEsTUFBTSxFQUFFRCxlQUFlLENBQUM5QixZQURwQjtBQUVKM0IsTUFBQUEsSUFBSSxFQUFFLENBQUN5RCxlQUFlLENBQUM3QixVQUFoQixJQUE4QixFQUEvQixFQUFtQzNCLEtBQW5DLENBQXlDLEdBQXpDLEVBQThDMkUsR0FBOUMsQ0FBa0RsRixDQUFDLElBQUlBLENBQUMsQ0FBQ21GLElBQUYsRUFBdkQsRUFBaUVDLE1BQWpFLENBQXdFcEYsQ0FBQyxJQUFJQSxDQUE3RTtBQUZGLEtBbkNMO0FBdUNINkIsSUFBQUEsYUFBYSxFQUFFLElBQUl3RCxHQUFKLENBQVEsQ0FBQ3RCLGVBQWUsQ0FBQ2xDLGFBQWhCLElBQWlDLEVBQWxDLEVBQXNDdEIsS0FBdEMsQ0FBNEMsR0FBNUMsQ0FBUjtBQXZDWixHQUFQO0FBeUNIOztBQUVELE1BQU0rRSxPQUVMLEdBQUc7QUFDQUMsRUFBQUEsTUFBTSxFQUFFLENBQ0osbUJBREksRUFFSixXQUZJLEVBR0osNkJBSEksRUFJSixzQkFKSSxFQUtKLHlCQUxJLEVBTUosNEJBTkksQ0FEUjtBQVNBQyxFQUFBQSxRQUFRLEVBQUUsQ0FDTixlQURNLEVBRU4sU0FGTSxDQVRWO0FBYUFDLEVBQUFBLFFBQVEsRUFBRSxDQUNOLFVBRE0sRUFFTixtQkFGTSxFQUdOLHdCQUhNLEVBSU4sd0JBSk0sRUFLTixpQkFMTSxFQU1OLGlCQU5NLEVBT04sNEJBUE0sRUFRTixZQVJNLEVBU04sWUFUTSxDQWJWO0FBd0JBQyxFQUFBQSxZQUFZLEVBQUUsQ0FDVixVQURVLEVBRVYsUUFGVSxFQUdWLGFBSFUsRUFJVixtQkFKVSxFQUtWLEtBTFUsRUFNVixJQU5VLEVBT1YsdUNBUFUsRUFRVix1QkFSVSxDQXhCZDtBQWtDQUMsRUFBQUEsaUJBQWlCLEVBQUUsQ0FDZixrQ0FEZTtBQWxDbkIsQ0FGSjtBQXlETyxNQUFNQyxhQUFxQixHQUFHO0FBQ2pDQyxFQUFBQSxjQUFjLEVBQUUsQ0FEaUI7QUFFakN0QixFQUFBQSxJQUFJLEVBQUUsWUFGMkI7QUFHakN1QixFQUFBQSxXQUFXLEVBQUU7QUFIb0IsQ0FBOUI7O0FBTVBuRyxNQUFNLENBQUNvRyxPQUFQLENBQWVULE9BQWYsRUFBd0I5RSxPQUF4QixDQUFnQyxDQUFDLENBQUMrRCxJQUFELEVBQU95QixPQUFQLENBQUQsS0FBcUI7QUFDakRKLEVBQUFBLGFBQWEsQ0FBQ0UsV0FBZCxDQUEwQnZCLElBQTFCLElBQWtDO0FBQzlCQSxJQUFBQSxJQUQ4QjtBQUU5QnlCLElBQUFBLE9BQU8sRUFBRSxDQUFDLE1BQUQsRUFBUyxHQUFJQSxPQUFiLEVBQTRCZCxHQUE1QixDQUFnQ2UsbUJBQWhDO0FBRnFCLEdBQWxDO0FBSUgsQ0FMRDtBQU9PLE1BQU1DLEtBQUssR0FBRztBQUNqQkMsRUFBQUEsTUFBTSxFQUFFLFVBRFM7QUFFakJDLEVBQUFBLEdBQUcsRUFBRTtBQUNEQyxJQUFBQSxLQUFLLEVBQUU7QUFETixHQUZZO0FBS2pCQyxFQUFBQSxJQUFJLEVBQUU7QUFDRkQsSUFBQUEsS0FBSyxFQUFFLFlBREw7QUFFRkUsSUFBQUEsTUFBTSxFQUFFO0FBRk4sR0FMVztBQVNqQkMsRUFBQUEsS0FBSyxFQUFFO0FBQ0hILElBQUFBLEtBQUssRUFBRSxhQURKO0FBRUhJLElBQUFBLElBQUksRUFBRSxZQUZIO0FBR0hDLElBQUFBLE1BQU0sRUFBRSxjQUhMO0FBSUhILElBQUFBLE1BQU0sRUFBRSxjQUpMO0FBS0hJLElBQUFBLElBQUksRUFBRTtBQUxILEdBVFU7QUFnQmpCQyxFQUFBQSxZQUFZLEVBQUU7QUFDVkYsSUFBQUEsTUFBTSxFQUFFO0FBREUsR0FoQkc7QUFtQmpCRyxFQUFBQSxPQUFPLEVBQUU7QUFDTEgsSUFBQUEsTUFBTSxFQUFFO0FBREg7QUFuQlEsQ0FBZCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxOC0yMDIwIFRPTiBERVYgU09MVVRJT05TIExURC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgU09GVFdBUkUgRVZBTFVBVElPTiBMaWNlbnNlICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcbiAqIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZVxuICogTGljZW5zZSBhdDpcbiAqXG4gKiBodHRwOi8vd3d3LnRvbi5kZXYvbGljZW5zZXNcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIFRPTiBERVYgc29mdHdhcmUgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuLy8gQGZsb3dcblxuaW1wb3J0IG9zIGZyb20gXCJvc1wiO1xuaW1wb3J0IHtwYXJzZUluZGV4fSBmcm9tIFwiLi9kYi10eXBlc1wiO1xuXG5leHBvcnQgY29uc3QgUVJlcXVlc3RzTW9kZSA9IHtcbiAgICBrYWZrYTogJ2thZmthJyxcbiAgICByZXN0OiAncmVzdCwnLFxufTtcblxuZXhwb3J0IHR5cGUgUURiQ29uZmlnID0ge1xuICAgIHNlcnZlcjogc3RyaW5nLFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBhdXRoOiBzdHJpbmcsXG4gICAgbWF4U29ja2V0czogbnVtYmVyLFxufTtcblxuZXhwb3J0IHR5cGUgUUNvbmZpZyA9IHtcbiAgICBzZXJ2ZXI6IHtcbiAgICAgICAgaG9zdDogc3RyaW5nLFxuICAgICAgICBwb3J0OiBudW1iZXIsXG4gICAgICAgIHJwY1BvcnQ6IHN0cmluZyxcbiAgICAgICAga2VlcEFsaXZlOiBudW1iZXIsXG4gICAgfSxcbiAgICByZXF1ZXN0czoge1xuICAgICAgICBtb2RlOiAna2Fma2EnIHwgJ3Jlc3QnLFxuICAgICAgICBzZXJ2ZXI6IHN0cmluZyxcbiAgICAgICAgdG9waWM6IHN0cmluZyxcbiAgICB9LFxuICAgIGRhdGFiYXNlOiBRRGJDb25maWcsXG4gICAgc2xvd0RhdGFiYXNlOiBRRGJDb25maWcsXG4gICAgbGlzdGVuZXI6IHtcbiAgICAgICAgcmVzdGFydFRpbWVvdXQ6IG51bWJlclxuICAgIH0sXG4gICAgYXV0aG9yaXphdGlvbjoge1xuICAgICAgICBlbmRwb2ludDogc3RyaW5nLFxuICAgIH0sXG4gICAgamFlZ2VyOiB7XG4gICAgICAgIGVuZHBvaW50OiBzdHJpbmcsXG4gICAgICAgIHNlcnZpY2U6IHN0cmluZyxcbiAgICAgICAgdGFnczogeyBbc3RyaW5nXTogc3RyaW5nIH1cbiAgICB9LFxuICAgIHN0YXRzZDoge1xuICAgICAgICBzZXJ2ZXI6IHN0cmluZyxcbiAgICAgICAgdGFnczogc3RyaW5nW10sXG4gICAgfSxcbiAgICBtYW1BY2Nlc3NLZXlzOiBTZXQ8c3RyaW5nPixcbiAgICBpc1Rlc3RzPzogYm9vbGVhbixcbn1cblxuZXhwb3J0IHR5cGUgUHJvZ3JhbU9wdGlvbnMgPSB7XG4gICAgcmVxdWVzdHNNb2RlOiAna2Fma2EnIHwgJ3Jlc3QnLFxuICAgIHJlcXVlc3RzU2VydmVyOiBzdHJpbmcsXG4gICAgcmVxdWVzdHNUb3BpYzogc3RyaW5nLFxuICAgIGRiU2VydmVyOiBzdHJpbmcsXG4gICAgZGJOYW1lOiBzdHJpbmcsXG4gICAgZGJBdXRoOiBzdHJpbmcsXG4gICAgZGJNYXhTb2NrZXRzOiBzdHJpbmcsXG4gICAgc2xvd0RiU2VydmVyOiBzdHJpbmcsXG4gICAgc2xvd0RiTmFtZTogc3RyaW5nLFxuICAgIHNsb3dEYkF1dGg6IHN0cmluZyxcbiAgICBzbG93RGJNYXhTb2NrZXRzOiBzdHJpbmcsXG4gICAgaG9zdDogc3RyaW5nLFxuICAgIHBvcnQ6IHN0cmluZyxcbiAgICBycGNQb3J0OiBzdHJpbmcsXG4gICAgamFlZ2VyRW5kcG9pbnQ6IHN0cmluZyxcbiAgICB0cmFjZVNlcnZpY2U6IHN0cmluZyxcbiAgICB0cmFjZVRhZ3M6IHN0cmluZyxcbiAgICBhdXRoRW5kcG9pbnQ6IHN0cmluZyxcbiAgICBzdGF0c2RTZXJ2ZXI6IHN0cmluZyxcbiAgICBzdGF0c2RUYWdzOiBzdHJpbmcsXG4gICAgbWFtQWNjZXNzS2V5czogc3RyaW5nLFxuICAgIGtlZXBBbGl2ZTogc3RyaW5nLFxufVxuXG50eXBlIFByb2dyYW1FbnYgPSB7XG4gICAgUV9TRVJWRVJfSE9TVDogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1NFUlZFUl9QT1JUOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfU0VSVkVSX1JQQ19QT1JUOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfUkVRVUVTVFNfTU9ERTogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1JFUVVFU1RTX1NFUlZFUjogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1JFUVVFU1RTX1RPUElDOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfREFUQUJBU0VfU0VSVkVSOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfREFUQUJBU0VfTkFNRTogc3RyaW5nIHwgdm9pZCxcbiAgICBRX0RBVEFCQVNFX0FVVEg6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9EQVRBQkFTRV9NQVhfU09DS0VUUzogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1NMT1dfREFUQUJBU0VfU0VSVkVSOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfU0xPV19EQVRBQkFTRV9OQU1FOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfU0xPV19EQVRBQkFTRV9BVVRIOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfU0xPV19EQVRBQkFTRV9NQVhfU09DS0VUUzogc3RyaW5nIHwgdm9pZCxcbiAgICBRX0FVVEhfRU5EUE9JTlQ6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9NQU1fQUNDRVNTX0tFWVM6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9KQUVHRVJfRU5EUE9JTlQ6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9UUkFDRV9TRVJWSUNFOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfVFJBQ0VfVEFHUzogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1NUQVRTRF9TRVJWRVI6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9TVEFUU0RfVEFHUzogc3RyaW5nIHwgdm9pZCxcbiAgICBRX0tFRVBfQUxJVkU6IHN0cmluZyB8IHZvaWQsXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbnN1cmVQcm90b2NvbChhZGRyZXNzOiBzdHJpbmcsIGRlZmF1bHRQcm90b2NvbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gL15cXHcrOlxcL1xcLy9naS50ZXN0KGFkZHJlc3MpID8gYWRkcmVzcyA6IGAke2RlZmF1bHRQcm90b2NvbH06Ly8ke2FkZHJlc3N9YDtcbn1cblxuZnVuY3Rpb24gZ2V0SXAoKTogc3RyaW5nIHtcbiAgICBjb25zdCBpcHY0ID0gKE9iamVjdC52YWx1ZXMob3MubmV0d29ya0ludGVyZmFjZXMoKSk6IGFueSlcbiAgICAgICAgLmZsYXRNYXAoeCA9PiB4KVxuICAgICAgICAuZmluZCh4ID0+IHguZmFtaWx5ID09PSAnSVB2NCcgJiYgIXguaW50ZXJuYWwpO1xuICAgIHJldHVybiBpcHY0ICYmIGlwdjQuYWRkcmVzcztcbn1cblxuZnVuY3Rpb24gcGFyc2VUYWdzKHM6IHN0cmluZyk6IHsgW3N0cmluZ106IHN0cmluZyB9IHtcbiAgICBjb25zdCB0YWdzOiB7IFtzdHJpbmddOiBzdHJpbmcgfSA9IHt9O1xuICAgIHMuc3BsaXQoJywnKS5mb3JFYWNoKCh0KSA9PiB7XG4gICAgICAgIGNvbnN0IGkgPSB0LmluZGV4T2YoJz0nKTtcbiAgICAgICAgaWYgKGkgPj0gMCkge1xuICAgICAgICAgICAgdGFnc1t0LnN1YnN0cigwLCBpKV0gPSB0LnN1YnN0cihpICsgMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0YWdzW3RdID0gJyc7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gdGFncztcblxufVxuXG5leHBvcnQgY29uc3QgZGVmYXVsdE9wdGlvbnM6IFByb2dyYW1PcHRpb25zID0ge1xuICAgIGhvc3Q6IGdldElwKCksXG4gICAgcG9ydDogJzQwMDAnLFxuICAgIHJwY1BvcnQ6ICcnLFxuICAgIHJlcXVlc3RzTW9kZTogJ2thZmthJyxcbiAgICByZXF1ZXN0c1NlcnZlcjogJ2thZmthOjkwOTInLFxuICAgIHJlcXVlc3RzVG9waWM6ICdyZXF1ZXN0cycsXG4gICAgZGJTZXJ2ZXI6ICdhcmFuZ29kYjo4NTI5JyxcbiAgICBkYk5hbWU6ICdibG9ja2NoYWluJyxcbiAgICBkYkF1dGg6ICcnLFxuICAgIGRiTWF4U29ja2V0czogJzEwMCcsXG4gICAgc2xvd0RiU2VydmVyOiAnJyxcbiAgICBzbG93RGJOYW1lOiAnJyxcbiAgICBzbG93RGJBdXRoOiAnJyxcbiAgICBzbG93RGJNYXhTb2NrZXRzOiAnMycsXG4gICAgYXV0aEVuZHBvaW50OiAnJyxcbiAgICBtYW1BY2Nlc3NLZXlzOiAnJyxcbiAgICBqYWVnZXJFbmRwb2ludDogJycsXG4gICAgdHJhY2VTZXJ2aWNlOiAnUSBTZXJ2ZXInLFxuICAgIHRyYWNlVGFnczogJycsXG4gICAgc3RhdHNkU2VydmVyOiAnJyxcbiAgICBzdGF0c2RUYWdzOiAnJyxcbiAgICBrZWVwQWxpdmU6ICc2MDAwMCcsXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gcmVzb2x2ZU9wdGlvbnMob3B0aW9uczogJFNoYXBlPFByb2dyYW1PcHRpb25zPiwgZW52OiBQcm9ncmFtRW52LCBkZWZhdWx0czogUHJvZ3JhbU9wdGlvbnMpOiBQcm9ncmFtT3B0aW9ucyB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaG9zdDogb3B0aW9ucy5ob3N0IHx8IGVudi5RX1NFUlZFUl9IT1NUIHx8IGRlZmF1bHRzLmhvc3QsXG4gICAgICAgIHBvcnQ6IG9wdGlvbnMucG9ydCB8fCBlbnYuUV9TRVJWRVJfUE9SVCB8fCBkZWZhdWx0cy5wb3J0LFxuICAgICAgICBycGNQb3J0OiBvcHRpb25zLnJwY1BvcnQgfHwgZW52LlFfU0VSVkVSX1JQQ19QT1JUIHx8IGRlZmF1bHRzLnJwY1BvcnQsXG4gICAgICAgIHJlcXVlc3RzTW9kZTogb3B0aW9ucy5yZXF1ZXN0c01vZGUgfHwgKGVudi5RX1JFUVVFU1RTX01PREU6IGFueSkgfHwgZGVmYXVsdHMucmVxdWVzdHNNb2RlLFxuICAgICAgICByZXF1ZXN0c1NlcnZlcjogb3B0aW9ucy5yZXF1ZXN0c1NlcnZlciB8fCBlbnYuUV9SRVFVRVNUU19TRVJWRVIgfHwgZGVmYXVsdHMucmVxdWVzdHNTZXJ2ZXIsXG4gICAgICAgIHJlcXVlc3RzVG9waWM6IG9wdGlvbnMucmVxdWVzdHNUb3BpYyB8fCBlbnYuUV9SRVFVRVNUU19UT1BJQyB8fCBkZWZhdWx0cy5yZXF1ZXN0c1RvcGljLFxuICAgICAgICBkYlNlcnZlcjogb3B0aW9ucy5kYlNlcnZlciB8fCBlbnYuUV9EQVRBQkFTRV9TRVJWRVIgfHwgZGVmYXVsdHMuZGJTZXJ2ZXIsXG4gICAgICAgIGRiTmFtZTogb3B0aW9ucy5kYk5hbWUgfHwgZW52LlFfREFUQUJBU0VfTkFNRSB8fCBkZWZhdWx0cy5kYk5hbWUsXG4gICAgICAgIGRiQXV0aDogb3B0aW9ucy5kYkF1dGggfHwgZW52LlFfREFUQUJBU0VfQVVUSCB8fCBkZWZhdWx0cy5kYkF1dGgsXG4gICAgICAgIGRiTWF4U29ja2V0czogb3B0aW9ucy5kYk1heFNvY2tldHMgfHwgZW52LlFfREFUQUJBU0VfTUFYX1NPQ0tFVFMgfHwgZGVmYXVsdHMuZGJNYXhTb2NrZXRzLFxuICAgICAgICBzbG93RGJTZXJ2ZXI6IG9wdGlvbnMuc2xvd0RiU2VydmVyIHx8IGVudi5RX1NMT1dfREFUQUJBU0VfU0VSVkVSIHx8IGRlZmF1bHRzLnNsb3dEYlNlcnZlcixcbiAgICAgICAgc2xvd0RiTmFtZTogb3B0aW9ucy5zbG93RGJOYW1lIHx8IGVudi5RX1NMT1dfREFUQUJBU0VfTkFNRSB8fCBkZWZhdWx0cy5zbG93RGJOYW1lLFxuICAgICAgICBzbG93RGJBdXRoOiBvcHRpb25zLnNsb3dEYkF1dGggfHwgZW52LlFfU0xPV19EQVRBQkFTRV9BVVRIIHx8IGRlZmF1bHRzLnNsb3dEYkF1dGgsXG4gICAgICAgIHNsb3dEYk1heFNvY2tldHM6IG9wdGlvbnMuc2xvd0RiTWF4U29ja2V0cyB8fCBlbnYuUV9TTE9XX0RBVEFCQVNFX01BWF9TT0NLRVRTIHx8IGRlZmF1bHRzLnNsb3dEYk1heFNvY2tldHMsXG4gICAgICAgIGF1dGhFbmRwb2ludDogb3B0aW9ucy5hdXRoRW5kcG9pbnQgfHwgZW52LlFfQVVUSF9FTkRQT0lOVCB8fCBkZWZhdWx0cy5hdXRoRW5kcG9pbnQsXG4gICAgICAgIG1hbUFjY2Vzc0tleXM6IG9wdGlvbnMubWFtQWNjZXNzS2V5cyB8fCBlbnYuUV9NQU1fQUNDRVNTX0tFWVMgfHwgZGVmYXVsdHMubWFtQWNjZXNzS2V5cyxcbiAgICAgICAgamFlZ2VyRW5kcG9pbnQ6IG9wdGlvbnMuamFlZ2VyRW5kcG9pbnQgfHwgZW52LlFfSkFFR0VSX0VORFBPSU5UIHx8IGRlZmF1bHRzLmphZWdlckVuZHBvaW50LFxuICAgICAgICB0cmFjZVNlcnZpY2U6IG9wdGlvbnMudHJhY2VTZXJ2aWNlIHx8IGVudi5RX1RSQUNFX1NFUlZJQ0UgfHwgZGVmYXVsdHMudHJhY2VTZXJ2aWNlLFxuICAgICAgICB0cmFjZVRhZ3M6IG9wdGlvbnMudHJhY2VUYWdzIHx8IGVudi5RX1RSQUNFX1RBR1MgfHwgZGVmYXVsdHMudHJhY2VUYWdzLFxuICAgICAgICBzdGF0c2RTZXJ2ZXI6IG9wdGlvbnMuc3RhdHNkU2VydmVyIHx8IGVudi5RX1NUQVRTRF9TRVJWRVIgfHwgZGVmYXVsdHMuc3RhdHNkU2VydmVyLFxuICAgICAgICBzdGF0c2RUYWdzOiBvcHRpb25zLnN0YXRzZFRhZ3MgfHwgZW52LlFfU1RBVFNEX1RBR1MgfHwgZGVmYXVsdHMuc3RhdHNkVGFncyxcbiAgICAgICAga2VlcEFsaXZlOiBvcHRpb25zLmtlZXBBbGl2ZSB8fCBlbnYuUV9LRUVQX0FMSVZFIHx8IGRlZmF1bHRzLmtlZXBBbGl2ZSxcbiAgICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ29uZmlnKG9wdGlvbnM6ICRTaGFwZTxQcm9ncmFtT3B0aW9ucz4sIGVudjogUHJvZ3JhbUVudiwgZGVmYXVsdHM6IFByb2dyYW1PcHRpb25zKTogUUNvbmZpZyB7XG4gICAgY29uc3QgcmVzb2x2ZWRPcHRpb25zID0gcmVzb2x2ZU9wdGlvbnMob3B0aW9ucywgZW52LCBkZWZhdWx0cyk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2VydmVyOiB7XG4gICAgICAgICAgICBob3N0OiByZXNvbHZlZE9wdGlvbnMuaG9zdCxcbiAgICAgICAgICAgIHBvcnQ6IE51bWJlci5wYXJzZUludChyZXNvbHZlZE9wdGlvbnMucG9ydCksXG4gICAgICAgICAgICBycGNQb3J0OiByZXNvbHZlZE9wdGlvbnMucnBjUG9ydCxcbiAgICAgICAgICAgIGtlZXBBbGl2ZTogTnVtYmVyLnBhcnNlSW50KHJlc29sdmVkT3B0aW9ucy5rZWVwQWxpdmUpLFxuICAgICAgICB9LFxuICAgICAgICByZXF1ZXN0czoge1xuICAgICAgICAgICAgbW9kZTogcmVzb2x2ZWRPcHRpb25zLnJlcXVlc3RzTW9kZSxcbiAgICAgICAgICAgIHNlcnZlcjogcmVzb2x2ZWRPcHRpb25zLnJlcXVlc3RzU2VydmVyLFxuICAgICAgICAgICAgdG9waWM6IHJlc29sdmVkT3B0aW9ucy5yZXF1ZXN0c1RvcGljLFxuICAgICAgICB9LFxuICAgICAgICBkYXRhYmFzZToge1xuICAgICAgICAgICAgc2VydmVyOiByZXNvbHZlZE9wdGlvbnMuZGJTZXJ2ZXIsXG4gICAgICAgICAgICBuYW1lOiByZXNvbHZlZE9wdGlvbnMuZGJOYW1lLFxuICAgICAgICAgICAgYXV0aDogcmVzb2x2ZWRPcHRpb25zLmRiQXV0aCxcbiAgICAgICAgICAgIG1heFNvY2tldHM6IE51bWJlcihyZXNvbHZlZE9wdGlvbnMuZGJNYXhTb2NrZXRzKSxcbiAgICAgICAgfSxcbiAgICAgICAgc2xvd0RhdGFiYXNlOiB7XG4gICAgICAgICAgICBzZXJ2ZXI6IHJlc29sdmVkT3B0aW9ucy5zbG93RGJTZXJ2ZXIgfHwgcmVzb2x2ZWRPcHRpb25zLmRiU2VydmVyLFxuICAgICAgICAgICAgbmFtZTogcmVzb2x2ZWRPcHRpb25zLnNsb3dEYk5hbWUgfHwgcmVzb2x2ZWRPcHRpb25zLmRiTmFtZSxcbiAgICAgICAgICAgIGF1dGg6IHJlc29sdmVkT3B0aW9ucy5zbG93RGJBdXRoIHx8IHJlc29sdmVkT3B0aW9ucy5kYkF1dGgsXG4gICAgICAgICAgICBtYXhTb2NrZXRzOiBOdW1iZXIocmVzb2x2ZWRPcHRpb25zLnNsb3dEYk1heFNvY2tldHMpLFxuICAgICAgICB9LFxuICAgICAgICBsaXN0ZW5lcjoge1xuICAgICAgICAgICAgcmVzdGFydFRpbWVvdXQ6IDEwMDAsXG4gICAgICAgIH0sXG4gICAgICAgIGF1dGhvcml6YXRpb246IHtcbiAgICAgICAgICAgIGVuZHBvaW50OiByZXNvbHZlZE9wdGlvbnMuYXV0aEVuZHBvaW50LFxuICAgICAgICB9LFxuICAgICAgICBqYWVnZXI6IHtcbiAgICAgICAgICAgIGVuZHBvaW50OiByZXNvbHZlZE9wdGlvbnMuamFlZ2VyRW5kcG9pbnQsXG4gICAgICAgICAgICBzZXJ2aWNlOiByZXNvbHZlZE9wdGlvbnMudHJhY2VTZXJ2aWNlLFxuICAgICAgICAgICAgdGFnczogcGFyc2VUYWdzKHJlc29sdmVkT3B0aW9ucy50cmFjZVRhZ3MpLFxuICAgICAgICB9LFxuICAgICAgICBzdGF0c2Q6IHtcbiAgICAgICAgICAgIHNlcnZlcjogcmVzb2x2ZWRPcHRpb25zLnN0YXRzZFNlcnZlcixcbiAgICAgICAgICAgIHRhZ3M6IChyZXNvbHZlZE9wdGlvbnMuc3RhdHNkVGFncyB8fCAnJykuc3BsaXQoJywnKS5tYXAoeCA9PiB4LnRyaW0oKSkuZmlsdGVyKHggPT4geCksXG4gICAgICAgIH0sXG4gICAgICAgIG1hbUFjY2Vzc0tleXM6IG5ldyBTZXQoKHJlc29sdmVkT3B0aW9ucy5tYW1BY2Nlc3NLZXlzIHx8ICcnKS5zcGxpdCgnLCcpKSxcbiAgICB9O1xufVxuXG5jb25zdCBJTkRFWEVTOiB7XG4gICAgW3N0cmluZ106IHN0cmluZ1tdLFxufSA9IHtcbiAgICBibG9ja3M6IFtcbiAgICAgICAgJ3NlcV9ubywgZ2VuX3V0aW1lJyxcbiAgICAgICAgJ2dlbl91dGltZScsXG4gICAgICAgICd3b3JrY2hhaW5faWQsIHNoYXJkLCBzZXFfbm8nLFxuICAgICAgICAnd29ya2NoYWluX2lkLCBzZXFfbm8nLFxuICAgICAgICAnd29ya2NoYWluX2lkLCBnZW5fdXRpbWUnLFxuICAgICAgICAnbWFzdGVyLm1pbl9zaGFyZF9nZW5fdXRpbWUnLFxuICAgIF0sXG4gICAgYWNjb3VudHM6IFtcbiAgICAgICAgJ2xhc3RfdHJhbnNfbHQnLFxuICAgICAgICAnYmFsYW5jZScsXG4gICAgXSxcbiAgICBtZXNzYWdlczogW1xuICAgICAgICAnYmxvY2tfaWQnLFxuICAgICAgICAndmFsdWUsIGNyZWF0ZWRfYXQnLFxuICAgICAgICAnc3JjLCB2YWx1ZSwgY3JlYXRlZF9hdCcsXG4gICAgICAgICdkc3QsIHZhbHVlLCBjcmVhdGVkX2F0JyxcbiAgICAgICAgJ3NyYywgY3JlYXRlZF9hdCcsXG4gICAgICAgICdkc3QsIGNyZWF0ZWRfYXQnLFxuICAgICAgICAnc3JjLCBkc3QsIGNyZWF0ZWRfYXQsIF9rZXknLFxuICAgICAgICAnY3JlYXRlZF9sdCcsXG4gICAgICAgICdjcmVhdGVkX2F0JyxcbiAgICBdLFxuICAgIHRyYW5zYWN0aW9uczogW1xuICAgICAgICAnYmxvY2tfaWQnLFxuICAgICAgICAnaW5fbXNnJyxcbiAgICAgICAgJ291dF9tc2dzWypdJyxcbiAgICAgICAgJ2FjY291bnRfYWRkciwgbm93JyxcbiAgICAgICAgJ25vdycsXG4gICAgICAgICdsdCcsXG4gICAgICAgICdhY2NvdW50X2FkZHIsIG9yaWdfc3RhdHVzLCBlbmRfc3RhdHVzJyxcbiAgICAgICAgJ25vdywgYWNjb3VudF9hZGRyLCBsdCcsXG4gICAgXSxcbiAgICBibG9ja3Nfc2lnbmF0dXJlczogW1xuICAgICAgICAnc2lnbmF0dXJlc1sqXS5ub2RlX2lkLCBnZW5fdXRpbWUnLFxuICAgIF0sXG59O1xuXG5leHBvcnQgdHlwZSBJbmRleEluZm8gPSB7XG4gICAgZmllbGRzOiBzdHJpbmdbXSxcbn1cblxuZXhwb3J0IHR5cGUgQ29sbGVjdGlvbkluZm8gPSB7XG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGluZGV4ZXM6IEluZGV4SW5mb1tdLFxufTtcblxuZXhwb3J0IHR5cGUgRGJJbmZvID0ge1xuICAgIG5hbWU6IHN0cmluZyxcbiAgICBjb2xsZWN0aW9uczoge1xuICAgICAgICBbc3RyaW5nXTogQ29sbGVjdGlvbkluZm8sXG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgQkxPQ0tDSEFJTl9EQjogRGJJbmZvID0ge1xuICAgIGxhc3RVcGRhdGVUaW1lOiAwLFxuICAgIG5hbWU6ICdibG9ja2NoYWluJyxcbiAgICBjb2xsZWN0aW9uczoge30sXG59O1xuXG5PYmplY3QuZW50cmllcyhJTkRFWEVTKS5mb3JFYWNoKChbbmFtZSwgaW5kZXhlc10pID0+IHtcbiAgICBCTE9DS0NIQUlOX0RCLmNvbGxlY3Rpb25zW25hbWVdID0ge1xuICAgICAgICBuYW1lLFxuICAgICAgICBpbmRleGVzOiBbJ19rZXknLCAuLi4oaW5kZXhlczogYW55KV0ubWFwKHBhcnNlSW5kZXgpLFxuICAgIH1cbn0pO1xuXG5leHBvcnQgY29uc3QgU1RBVFMgPSB7XG4gICAgcHJlZml4OiAncXNlcnZlci4nLFxuICAgIGRvYzoge1xuICAgICAgICBjb3VudDogJ2RvYy5jb3VudCcsXG4gICAgfSxcbiAgICBwb3N0OiB7XG4gICAgICAgIGNvdW50OiAncG9zdC5jb3VudCcsXG4gICAgICAgIGZhaWxlZDogJ3Bvc3QuZmFpbGVkJyxcbiAgICB9LFxuICAgIHF1ZXJ5OiB7XG4gICAgICAgIGNvdW50OiAncXVlcnkuY291bnQnLFxuICAgICAgICB0aW1lOiAncXVlcnkudGltZScsXG4gICAgICAgIGFjdGl2ZTogJ3F1ZXJ5LmFjdGl2ZScsXG4gICAgICAgIGZhaWxlZDogJ3F1ZXJ5LmZhaWxlZCcsXG4gICAgICAgIHNsb3c6ICdxdWVyeS5zbG93JyxcbiAgICB9LFxuICAgIHN1YnNjcmlwdGlvbjoge1xuICAgICAgICBhY3RpdmU6ICdzdWJzY3JpcHRpb24uYWN0aXZlJyxcbiAgICB9LFxuICAgIHdhaXRGb3I6IHtcbiAgICAgICAgYWN0aXZlOiAnd2FpdGZvci5hY3RpdmUnLFxuICAgIH0sXG59O1xuXG4iXX0=