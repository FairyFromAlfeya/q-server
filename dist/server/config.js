"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ensureProtocol = ensureProtocol;
exports.resolveOptions = resolveOptions;
exports.createConfig = createConfig;
exports.STATS = exports.BLOCKCHAIN_DB = exports.defaultOptions = exports.QRequestsMode = void 0;

var _os = _interopRequireDefault(require("os"));

var _dbTypes = require("./db-types");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
 * Copyright 2018-2020 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at:
 *
 * http://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 */
const QRequestsMode = {
  kafka: 'kafka',
  rest: 'rest'
};
exports.QRequestsMode = QRequestsMode;

function ensureProtocol(address, defaultProtocol) {
  return /^\w+:\/\//gi.test(address) ? address : `${defaultProtocol}://${address}`;
}

function getIp() {
  const ipv4 = Object.values(_os.default.networkInterfaces()).flatMap(x => x).find(x => x.family === 'IPv4' && !x.internal);
  return ipv4 && ipv4.address;
}

function parseTags(s) {
  const tags = {};
  s.split(',').forEach(t => {
    const i = t.indexOf('=');

    if (i >= 0) {
      tags[t.substr(0, i)] = t.substr(i + 1);
    } else {
      tags[t] = '';
    }
  });
  return tags;
}

const defaultOptions = {
  host: getIp(),
  port: '4000',
  rpcPort: '',
  requestsMode: 'kafka',
  requestsServer: 'kafka:9092',
  requestsTopic: 'requests',
  dbServer: 'arangodb:8529',
  dbName: 'blockchain',
  dbAuth: '',
  dbMaxSockets: '100',
  slowDbServer: '',
  slowDbName: '',
  slowDbAuth: '',
  slowDbMaxSockets: '3',
  authEndpoint: '',
  mamAccessKeys: '',
  jaegerEndpoint: '',
  traceService: 'Q Server',
  traceTags: '',
  statsdServer: '',
  statsdTags: '',
  keepAlive: '60000'
};
exports.defaultOptions = defaultOptions;

function resolveOptions(options, env, defaults) {
  return {
    host: options.host || env.Q_SERVER_HOST || defaults.host,
    port: options.port || env.Q_SERVER_PORT || defaults.port,
    rpcPort: options.rpcPort || env.Q_SERVER_RPC_PORT || defaults.rpcPort,
    requestsMode: options.requestsMode || env.Q_REQUESTS_MODE || defaults.requestsMode,
    requestsServer: options.requestsServer || env.Q_REQUESTS_SERVER || defaults.requestsServer,
    requestsTopic: options.requestsTopic || env.Q_REQUESTS_TOPIC || defaults.requestsTopic,
    dbServer: options.dbServer || env.Q_DATABASE_SERVER || defaults.dbServer,
    dbName: options.dbName || env.Q_DATABASE_NAME || defaults.dbName,
    dbAuth: options.dbAuth || env.Q_DATABASE_AUTH || defaults.dbAuth,
    dbMaxSockets: options.dbMaxSockets || env.Q_DATABASE_MAX_SOCKETS || defaults.dbMaxSockets,
    slowDbServer: options.slowDbServer || env.Q_SLOW_DATABASE_SERVER || defaults.slowDbServer,
    slowDbName: options.slowDbName || env.Q_SLOW_DATABASE_NAME || defaults.slowDbName,
    slowDbAuth: options.slowDbAuth || env.Q_SLOW_DATABASE_AUTH || defaults.slowDbAuth,
    slowDbMaxSockets: options.slowDbMaxSockets || env.Q_SLOW_DATABASE_MAX_SOCKETS || defaults.slowDbMaxSockets,
    authEndpoint: options.authEndpoint || env.Q_AUTH_ENDPOINT || defaults.authEndpoint,
    mamAccessKeys: options.mamAccessKeys || env.Q_MAM_ACCESS_KEYS || defaults.mamAccessKeys,
    jaegerEndpoint: options.jaegerEndpoint || env.Q_JAEGER_ENDPOINT || defaults.jaegerEndpoint,
    traceService: options.traceService || env.Q_TRACE_SERVICE || defaults.traceService,
    traceTags: options.traceTags || env.Q_TRACE_TAGS || defaults.traceTags,
    statsdServer: options.statsdServer || env.Q_STATSD_SERVER || defaults.statsdServer,
    statsdTags: options.statsdTags || env.Q_STATSD_TAGS || defaults.statsdTags,
    keepAlive: options.keepAlive || env.Q_KEEP_ALIVE || defaults.keepAlive
  };
}

function createConfig(options, env, defaults) {
  const resolvedOptions = resolveOptions(options, env, defaults);
  return {
    server: {
      host: resolvedOptions.host,
      port: Number.parseInt(resolvedOptions.port),
      rpcPort: resolvedOptions.rpcPort,
      keepAlive: Number.parseInt(resolvedOptions.keepAlive)
    },
    requests: {
      mode: resolvedOptions.requestsMode,
      server: resolvedOptions.requestsServer,
      topic: resolvedOptions.requestsTopic
    },
    database: {
      server: resolvedOptions.dbServer,
      name: resolvedOptions.dbName,
      auth: resolvedOptions.dbAuth,
      maxSockets: Number(resolvedOptions.dbMaxSockets)
    },
    slowDatabase: {
      server: resolvedOptions.slowDbServer || resolvedOptions.dbServer,
      name: resolvedOptions.slowDbName || resolvedOptions.dbName,
      auth: resolvedOptions.slowDbAuth || resolvedOptions.dbAuth,
      maxSockets: Number(resolvedOptions.slowDbMaxSockets)
    },
    listener: {
      restartTimeout: 1000
    },
    authorization: {
      endpoint: resolvedOptions.authEndpoint
    },
    jaeger: {
      endpoint: resolvedOptions.jaegerEndpoint,
      service: resolvedOptions.traceService,
      tags: parseTags(resolvedOptions.traceTags)
    },
    statsd: {
      server: resolvedOptions.statsdServer,
      tags: (resolvedOptions.statsdTags || '').split(',').map(x => x.trim()).filter(x => x)
    },
    mamAccessKeys: new Set((resolvedOptions.mamAccessKeys || '').split(','))
  };
}

const INDEXES = {
  blocks: ['seq_no, gen_utime', 'gen_utime', 'workchain_id, shard, seq_no', 'workchain_id, seq_no', 'workchain_id, gen_utime', 'master.min_shard_gen_utime'],
  accounts: ['last_trans_lt', 'balance'],
  messages: ['block_id', 'value, created_at', 'src, value, created_at', 'dst, value, created_at', 'src, created_at', 'dst, created_at', 'src, dst, created_at, _key', 'created_lt', 'created_at'],
  transactions: ['block_id', 'in_msg', 'out_msgs[*]', 'account_addr, now', 'now', 'lt', 'account_addr, orig_status, end_status', 'now, account_addr, lt'],
  blocks_signatures: ['signatures[*].node_id, gen_utime']
};
const BLOCKCHAIN_DB = {
  lastUpdateTime: 0,
  name: 'blockchain',
  collections: {}
};
exports.BLOCKCHAIN_DB = BLOCKCHAIN_DB;
Object.entries(INDEXES).forEach(([name, indexes]) => {
  BLOCKCHAIN_DB.collections[name] = {
    name,
    indexes: ['_key', ...indexes].map(_dbTypes.parseIndex)
  };
});
const STATS = {
  prefix: 'qserver.',
  doc: {
    count: 'doc.count'
  },
  post: {
    count: 'post.count',
    failed: 'post.failed'
  },
  query: {
    count: 'query.count',
    time: 'query.time',
    active: 'query.active',
    failed: 'query.failed',
    slow: 'query.slow'
  },
  subscription: {
    active: 'subscription.active'
  },
  waitFor: {
    active: 'waitfor.active'
  }
};
exports.STATS = STATS;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NlcnZlci9jb25maWcuanMiXSwibmFtZXMiOlsiUVJlcXVlc3RzTW9kZSIsImthZmthIiwicmVzdCIsImVuc3VyZVByb3RvY29sIiwiYWRkcmVzcyIsImRlZmF1bHRQcm90b2NvbCIsInRlc3QiLCJnZXRJcCIsImlwdjQiLCJPYmplY3QiLCJ2YWx1ZXMiLCJvcyIsIm5ldHdvcmtJbnRlcmZhY2VzIiwiZmxhdE1hcCIsIngiLCJmaW5kIiwiZmFtaWx5IiwiaW50ZXJuYWwiLCJwYXJzZVRhZ3MiLCJzIiwidGFncyIsInNwbGl0IiwiZm9yRWFjaCIsInQiLCJpIiwiaW5kZXhPZiIsInN1YnN0ciIsImRlZmF1bHRPcHRpb25zIiwiaG9zdCIsInBvcnQiLCJycGNQb3J0IiwicmVxdWVzdHNNb2RlIiwicmVxdWVzdHNTZXJ2ZXIiLCJyZXF1ZXN0c1RvcGljIiwiZGJTZXJ2ZXIiLCJkYk5hbWUiLCJkYkF1dGgiLCJkYk1heFNvY2tldHMiLCJzbG93RGJTZXJ2ZXIiLCJzbG93RGJOYW1lIiwic2xvd0RiQXV0aCIsInNsb3dEYk1heFNvY2tldHMiLCJhdXRoRW5kcG9pbnQiLCJtYW1BY2Nlc3NLZXlzIiwiamFlZ2VyRW5kcG9pbnQiLCJ0cmFjZVNlcnZpY2UiLCJ0cmFjZVRhZ3MiLCJzdGF0c2RTZXJ2ZXIiLCJzdGF0c2RUYWdzIiwia2VlcEFsaXZlIiwicmVzb2x2ZU9wdGlvbnMiLCJvcHRpb25zIiwiZW52IiwiZGVmYXVsdHMiLCJRX1NFUlZFUl9IT1NUIiwiUV9TRVJWRVJfUE9SVCIsIlFfU0VSVkVSX1JQQ19QT1JUIiwiUV9SRVFVRVNUU19NT0RFIiwiUV9SRVFVRVNUU19TRVJWRVIiLCJRX1JFUVVFU1RTX1RPUElDIiwiUV9EQVRBQkFTRV9TRVJWRVIiLCJRX0RBVEFCQVNFX05BTUUiLCJRX0RBVEFCQVNFX0FVVEgiLCJRX0RBVEFCQVNFX01BWF9TT0NLRVRTIiwiUV9TTE9XX0RBVEFCQVNFX1NFUlZFUiIsIlFfU0xPV19EQVRBQkFTRV9OQU1FIiwiUV9TTE9XX0RBVEFCQVNFX0FVVEgiLCJRX1NMT1dfREFUQUJBU0VfTUFYX1NPQ0tFVFMiLCJRX0FVVEhfRU5EUE9JTlQiLCJRX01BTV9BQ0NFU1NfS0VZUyIsIlFfSkFFR0VSX0VORFBPSU5UIiwiUV9UUkFDRV9TRVJWSUNFIiwiUV9UUkFDRV9UQUdTIiwiUV9TVEFUU0RfU0VSVkVSIiwiUV9TVEFUU0RfVEFHUyIsIlFfS0VFUF9BTElWRSIsImNyZWF0ZUNvbmZpZyIsInJlc29sdmVkT3B0aW9ucyIsInNlcnZlciIsIk51bWJlciIsInBhcnNlSW50IiwicmVxdWVzdHMiLCJtb2RlIiwidG9waWMiLCJkYXRhYmFzZSIsIm5hbWUiLCJhdXRoIiwibWF4U29ja2V0cyIsInNsb3dEYXRhYmFzZSIsImxpc3RlbmVyIiwicmVzdGFydFRpbWVvdXQiLCJhdXRob3JpemF0aW9uIiwiZW5kcG9pbnQiLCJqYWVnZXIiLCJzZXJ2aWNlIiwic3RhdHNkIiwibWFwIiwidHJpbSIsImZpbHRlciIsIlNldCIsIklOREVYRVMiLCJibG9ja3MiLCJhY2NvdW50cyIsIm1lc3NhZ2VzIiwidHJhbnNhY3Rpb25zIiwiYmxvY2tzX3NpZ25hdHVyZXMiLCJCTE9DS0NIQUlOX0RCIiwibGFzdFVwZGF0ZVRpbWUiLCJjb2xsZWN0aW9ucyIsImVudHJpZXMiLCJpbmRleGVzIiwicGFyc2VJbmRleCIsIlNUQVRTIiwicHJlZml4IiwiZG9jIiwiY291bnQiLCJwb3N0IiwiZmFpbGVkIiwicXVlcnkiLCJ0aW1lIiwiYWN0aXZlIiwic2xvdyIsInN1YnNjcmlwdGlvbiIsIndhaXRGb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFrQkE7O0FBQ0E7Ozs7QUFuQkE7Ozs7Ozs7Ozs7Ozs7OztBQXFCTyxNQUFNQSxhQUFhLEdBQUc7QUFDekJDLEVBQUFBLEtBQUssRUFBRSxPQURrQjtBQUV6QkMsRUFBQUEsSUFBSSxFQUFFO0FBRm1CLENBQXRCOzs7QUErRkEsU0FBU0MsY0FBVCxDQUF3QkMsT0FBeEIsRUFBeUNDLGVBQXpDLEVBQTBFO0FB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QUEsS0FBSyxFQUFFO0FBQ0hILElBQUFBLEtBQUssRUFBRSxhQURKO0FBRUhJLElBQUFBLElBQUksRUFBRSxZQUZIO0FBR0hDLElBQUFBLE1BQU0sRUFBRSxjQUhMO0FBSUhILElBQUFBLE1BQU0sRUFBRSxjQUpMO0FBS0hJLElBQUFBLElBQUksRUFBRTtBQUxILEdBVFU7QUFnQmpCQyxFQUFBQSxZQUFZLEVBQUU7QUFDVkYsSUFBQUEsTUFBTSxFQUFFO0FBREUsR0FoQkc7QUFtQmpCRyxFQUFBQSxPQUFPLEVBQUU7QUFDTEgsSUFBQUEsTUFBTSxFQUFFO0FBREg7QUFuQlEsQ0FBZCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxOC0yMDIwIFRPTiBERVYgU09MVVRJT05TIExURC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgU09GVFdBUkUgRVZBTFVBVElPTiBMaWNlbnNlICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcbiAqIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZVxuICogTGljZW5zZSBhdDpcbiAqXG4gKiBodHRwOi8vd3d3LnRvbi5kZXYvbGljZW5zZXNcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIFRPTiBERVYgc29mdHdhcmUgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuLy8gQGZsb3dcblxuaW1wb3J0IG9zIGZyb20gXCJvc1wiO1xuaW1wb3J0IHtwYXJzZUluZGV4fSBmcm9tIFwiLi9kYi10eXBlc1wiO1xuXG5leHBvcnQgY29uc3QgUVJlcXVlc3RzTW9kZSA9IHtcbiAgICBrYWZrYTogJ2thZmthJyxcbiAgICByZXN0OiAncmVzdCcsXG59O1xuXG5leHBvcnQgdHlwZSBRRGJDb25maWcgPSB7XG4gICAgc2VydmVyOiBzdHJpbmcsXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGF1dGg6IHN0cmluZyxcbiAgICBtYXhTb2NrZXRzOiBudW1iZXIsXG59O1xuXG5leHBvcnQgdHlwZSBRQ29uZmlnID0ge1xuICAgIHNlcnZlcjoge1xuICAgICAgICBob3N0OiBzdHJpbmcsXG4gICAgICAgIHBvcnQ6IG51bWJlcixcbiAgICAgICAgcnBjUG9ydDogc3RyaW5nLFxuICAgICAgICBrZWVwQWxpdmU6IG51bWJlcixcbiAgICB9LFxuICAgIHJlcXVlc3RzOiB7XG4gICAgICAgIG1vZGU6ICdrYWZrYScgfCAncmVzdCcsXG4gICAgICAgIHNlcnZlcjogc3RyaW5nLFxuICAgICAgICB0b3BpYzogc3RyaW5nLFxuICAgIH0sXG4gICAgZGF0YWJhc2U6IFFEYkNvbmZpZyxcbiAgICBzbG93RGF0YWJhc2U6IFFEYkNvbmZpZyxcbiAgICBsaXN0ZW5lcjoge1xuICAgICAgICByZXN0YXJ0VGltZW91dDogbnVtYmVyXG4gICAgfSxcbiAgICBhdXRob3JpemF0aW9uOiB7XG4gICAgICAgIGVuZHBvaW50OiBzdHJpbmcsXG4gICAgfSxcbiAgICBqYWVnZXI6IHtcbiAgICAgICAgZW5kcG9pbnQ6IHN0cmluZyxcbiAgICAgICAgc2VydmljZTogc3RyaW5nLFxuICAgICAgICB0YWdzOiB7IFtzdHJpbmddOiBzdHJpbmcgfVxuICAgIH0sXG4gICAgc3RhdHNkOiB7XG4gICAgICAgIHNlcnZlcjogc3RyaW5nLFxuICAgICAgICB0YWdzOiBzdHJpbmdbXSxcbiAgICB9LFxuICAgIG1hbUFjY2Vzc0tleXM6IFNldDxzdHJpbmc+LFxuICAgIGlzVGVzdHM/OiBib29sZWFuLFxufVxuXG5leHBvcnQgdHlwZSBQcm9ncmFtT3B0aW9ucyA9IHtcbiAgICByZXF1ZXN0c01vZGU6ICdrYWZrYScgfCAncmVzdCcsXG4gICAgcmVxdWVzdHNTZXJ2ZXI6IHN0cmluZyxcbiAgICByZXF1ZXN0c1RvcGljOiBzdHJpbmcsXG4gICAgZGJTZXJ2ZXI6IHN0cmluZyxcbiAgICBkYk5hbWU6IHN0cmluZyxcbiAgICBkYkF1dGg6IHN0cmluZyxcbiAgICBkYk1heFNvY2tldHM6IHN0cmluZyxcbiAgICBzbG93RGJTZXJ2ZXI6IHN0cmluZyxcbiAgICBzbG93RGJOYW1lOiBzdHJpbmcsXG4gICAgc2xvd0RiQXV0aDogc3RyaW5nLFxuICAgIHNsb3dEYk1heFNvY2tldHM6IHN0cmluZyxcbiAgICBob3N0OiBzdHJpbmcsXG4gICAgcG9ydDogc3RyaW5nLFxuICAgIHJwY1BvcnQ6IHN0cmluZyxcbiAgICBqYWVnZXJFbmRwb2ludDogc3RyaW5nLFxuICAgIHRyYWNlU2VydmljZTogc3RyaW5nLFxuICAgIHRyYWNlVGFnczogc3RyaW5nLFxuICAgIGF1dGhFbmRwb2ludDogc3RyaW5nLFxuICAgIHN0YXRzZFNlcnZlcjogc3RyaW5nLFxuICAgIHN0YXRzZFRhZ3M6IHN0cmluZyxcbiAgICBtYW1BY2Nlc3NLZXlzOiBzdHJpbmcsXG4gICAga2VlcEFsaXZlOiBzdHJpbmcsXG59XG5cbnR5cGUgUHJvZ3JhbUVudiA9IHtcbiAgICBRX1NFUlZFUl9IT1NUOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfU0VSVkVSX1BPUlQ6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9TRVJWRVJfUlBDX1BPUlQ6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9SRVFVRVNUU19NT0RFOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfUkVRVUVTVFNfU0VSVkVSOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfUkVRVUVTVFNfVE9QSUM6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9EQVRBQkFTRV9TRVJWRVI6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9EQVRBQkFTRV9OQU1FOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfREFUQUJBU0VfQVVUSDogc3RyaW5nIHwgdm9pZCxcbiAgICBRX0RBVEFCQVNFX01BWF9TT0NLRVRTOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfU0xPV19EQVRBQkFTRV9TRVJWRVI6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9TTE9XX0RBVEFCQVNFX05BTUU6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9TTE9XX0RBVEFCQVNFX0FVVEg6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9TTE9XX0RBVEFCQVNFX01BWF9TT0NLRVRTOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfQVVUSF9FTkRQT0lOVDogc3RyaW5nIHwgdm9pZCxcbiAgICBRX01BTV9BQ0NFU1NfS0VZUzogc3RyaW5nIHwgdm9pZCxcbiAgICBRX0pBRUdFUl9FTkRQT0lOVDogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1RSQUNFX1NFUlZJQ0U6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9UUkFDRV9UQUdTOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfU1RBVFNEX1NFUlZFUjogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1NUQVRTRF9UQUdTOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfS0VFUF9BTElWRTogc3RyaW5nIHwgdm9pZCxcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVuc3VyZVByb3RvY29sKGFkZHJlc3M6IHN0cmluZywgZGVmYXVsdFByb3RvY29sOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiAvXlxcdys6XFwvXFwvL2dpLnRlc3QoYWRkcmVzcykgPyBhZGRyZXNzIDogYCR7ZGVmYXVsdFByb3RvY29sfTovLyR7YWRkcmVzc31gO1xufVxuXG5mdW5jdGlvbiBnZXRJcCgpOiBzdHJpbmcge1xuICAgIGNvbnN0IGlwdjQgPSAoT2JqZWN0LnZhbHVlcyhvcy5uZXR3b3JrSW50ZXJmYWNlcygpKTogYW55KVxuICAgICAgICAuZmxhdE1hcCh4ID0+IHgpXG4gICAgICAgIC5maW5kKHggPT4geC5mYW1pbHkgPT09ICdJUHY0JyAmJiAheC5pbnRlcm5hbCk7XG4gICAgcmV0dXJuIGlwdjQgJiYgaXB2NC5hZGRyZXNzO1xufVxuXG5mdW5jdGlvbiBwYXJzZVRhZ3Moczogc3RyaW5nKTogeyBbc3RyaW5nXTogc3RyaW5nIH0ge1xuICAgIGNvbnN0IHRhZ3M6IHsgW3N0cmluZ106IHN0cmluZyB9ID0ge307XG4gICAgcy5zcGxpdCgnLCcpLmZvckVhY2goKHQpID0+IHtcbiAgICAgICAgY29uc3QgaSA9IHQuaW5kZXhPZignPScpO1xuICAgICAgICBpZiAoaSA+PSAwKSB7XG4gICAgICAgICAgICB0YWdzW3Quc3Vic3RyKDAsIGkpXSA9IHQuc3Vic3RyKGkgKyAxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhZ3NbdF0gPSAnJztcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiB0YWdzO1xuXG59XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0T3B0aW9uczogUHJvZ3JhbU9wdGlvbnMgPSB7XG4gICAgaG9zdDogZ2V0SXAoKSxcbiAgICBwb3J0OiAnNDAwMCcsXG4gICAgcnBjUG9ydDogJycsXG4gICAgcmVxdWVzdHNNb2RlOiAna2Fma2EnLFxuICAgIHJlcXVlc3RzU2VydmVyOiAna2Fma2E6OTA5MicsXG4gICAgcmVxdWVzdHNUb3BpYzogJ3JlcXVlc3RzJyxcbiAgICBkYlNlcnZlcjogJ2FyYW5nb2RiOjg1MjknLFxuICAgIGRiTmFtZTogJ2Jsb2NrY2hhaW4nLFxuICAgIGRiQXV0aDogJycsXG4gICAgZGJNYXhTb2NrZXRzOiAnMTAwJyxcbiAgICBzbG93RGJTZXJ2ZXI6ICcnLFxuICAgIHNsb3dEYk5hbWU6ICcnLFxuICAgIHNsb3dEYkF1dGg6ICcnLFxuICAgIHNsb3dEYk1heFNvY2tldHM6ICczJyxcbiAgICBhdXRoRW5kcG9pbnQ6ICcnLFxuICAgIG1hbUFjY2Vzc0tleXM6ICcnLFxuICAgIGphZWdlckVuZHBvaW50OiAnJyxcbiAgICB0cmFjZVNlcnZpY2U6ICdRIFNlcnZlcicsXG4gICAgdHJhY2VUYWdzOiAnJyxcbiAgICBzdGF0c2RTZXJ2ZXI6ICcnLFxuICAgIHN0YXRzZFRhZ3M6ICcnLFxuICAgIGtlZXBBbGl2ZTogJzYwMDAwJyxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiByZXNvbHZlT3B0aW9ucyhvcHRpb25zOiAkU2hhcGU8UHJvZ3JhbU9wdGlvbnM+LCBlbnY6IFByb2dyYW1FbnYsIGRlZmF1bHRzOiBQcm9ncmFtT3B0aW9ucyk6IFByb2dyYW1PcHRpb25zIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBob3N0OiBvcHRpb25zLmhvc3QgfHwgZW52LlFfU0VSVkVSX0hPU1QgfHwgZGVmYXVsdHMuaG9zdCxcbiAgICAgICAgcG9ydDogb3B0aW9ucy5wb3J0IHx8IGVudi5RX1NFUlZFUl9QT1JUIHx8IGRlZmF1bHRzLnBvcnQsXG4gICAgICAgIHJwY1BvcnQ6IG9wdGlvbnMucnBjUG9ydCB8fCBlbnYuUV9TRVJWRVJfUlBDX1BPUlQgfHwgZGVmYXVsdHMucnBjUG9ydCxcbiAgICAgICAgcmVxdWVzdHNNb2RlOiBvcHRpb25zLnJlcXVlc3RzTW9kZSB8fCAoZW52LlFfUkVRVUVTVFNfTU9ERTogYW55KSB8fCBkZWZhdWx0cy5yZXF1ZXN0c01vZGUsXG4gICAgICAgIHJlcXVlc3RzU2VydmVyOiBvcHRpb25zLnJlcXVlc3RzU2VydmVyIHx8IGVudi5RX1JFUVVFU1RTX1NFUlZFUiB8fCBkZWZhdWx0cy5yZXF1ZXN0c1NlcnZlcixcbiAgICAgICAgcmVxdWVzdHNUb3BpYzogb3B0aW9ucy5yZXF1ZXN0c1RvcGljIHx8IGVudi5RX1JFUVVFU1RTX1RPUElDIHx8IGRlZmF1bHRzLnJlcXVlc3RzVG9waWMsXG4gICAgICAgIGRiU2VydmVyOiBvcHRpb25zLmRiU2VydmVyIHx8IGVudi5RX0RBVEFCQVNFX1NFUlZFUiB8fCBkZWZhdWx0cy5kYlNlcnZlcixcbiAgICAgICAgZGJOYW1lOiBvcHRpb25zLmRiTmFtZSB8fCBlbnYuUV9EQVRBQkFTRV9OQU1FIHx8IGRlZmF1bHRzLmRiTmFtZSxcbiAgICAgICAgZGJBdXRoOiBvcHRpb25zLmRiQXV0aCB8fCBlbnYuUV9EQVRBQkFTRV9BVVRIIHx8IGRlZmF1bHRzLmRiQXV0aCxcbiAgICAgICAgZGJNYXhTb2NrZXRzOiBvcHRpb25zLmRiTWF4U29ja2V0cyB8fCBlbnYuUV9EQVRBQkFTRV9NQVhfU09DS0VUUyB8fCBkZWZhdWx0cy5kYk1heFNvY2tldHMsXG4gICAgICAgIHNsb3dEYlNlcnZlcjogb3B0aW9ucy5zbG93RGJTZXJ2ZXIgfHwgZW52LlFfU0xPV19EQVRBQkFTRV9TRVJWRVIgfHwgZGVmYXVsdHMuc2xvd0RiU2VydmVyLFxuICAgICAgICBzbG93RGJOYW1lOiBvcHRpb25zLnNsb3dEYk5hbWUgfHwgZW52LlFfU0xPV19EQVRBQkFTRV9OQU1FIHx8IGRlZmF1bHRzLnNsb3dEYk5hbWUsXG4gICAgICAgIHNsb3dEYkF1dGg6IG9wdGlvbnMuc2xvd0RiQXV0aCB8fCBlbnYuUV9TTE9XX0RBVEFCQVNFX0FVVEggfHwgZGVmYXVsdHMuc2xvd0RiQXV0aCxcbiAgICAgICAgc2xvd0RiTWF4U29ja2V0czogb3B0aW9ucy5zbG93RGJNYXhTb2NrZXRzIHx8IGVudi5RX1NMT1dfREFUQUJBU0VfTUFYX1NPQ0tFVFMgfHwgZGVmYXVsdHMuc2xvd0RiTWF4U29ja2V0cyxcbiAgICAgICAgYXV0aEVuZHBvaW50OiBvcHRpb25zLmF1dGhFbmRwb2ludCB8fCBlbnYuUV9BVVRIX0VORFBPSU5UIHx8IGRlZmF1bHRzLmF1dGhFbmRwb2ludCxcbiAgICAgICAgbWFtQWNjZXNzS2V5czogb3B0aW9ucy5tYW1BY2Nlc3NLZXlzIHx8IGVudi5RX01BTV9BQ0NFU1NfS0VZUyB8fCBkZWZhdWx0cy5tYW1BY2Nlc3NLZXlzLFxuICAgICAgICBqYWVnZXJFbmRwb2ludDogb3B0aW9ucy5qYWVnZXJFbmRwb2ludCB8fCBlbnYuUV9KQUVHRVJfRU5EUE9JTlQgfHwgZGVmYXVsdHMuamFlZ2VyRW5kcG9pbnQsXG4gICAgICAgIHRyYWNlU2VydmljZTogb3B0aW9ucy50cmFjZVNlcnZpY2UgfHwgZW52LlFfVFJBQ0VfU0VSVklDRSB8fCBkZWZhdWx0cy50cmFjZVNlcnZpY2UsXG4gICAgICAgIHRyYWNlVGFnczogb3B0aW9ucy50cmFjZVRhZ3MgfHwgZW52LlFfVFJBQ0VfVEFHUyB8fCBkZWZhdWx0cy50cmFjZVRhZ3MsXG4gICAgICAgIHN0YXRzZFNlcnZlcjogb3B0aW9ucy5zdGF0c2RTZXJ2ZXIgfHwgZW52LlFfU1RBVFNEX1NFUlZFUiB8fCBkZWZhdWx0cy5zdGF0c2RTZXJ2ZXIsXG4gICAgICAgIHN0YXRzZFRhZ3M6IG9wdGlvbnMuc3RhdHNkVGFncyB8fCBlbnYuUV9TVEFUU0RfVEFHUyB8fCBkZWZhdWx0cy5zdGF0c2RUYWdzLFxuICAgICAgICBrZWVwQWxpdmU6IG9wdGlvbnMua2VlcEFsaXZlIHx8IGVudi5RX0tFRVBfQUxJVkUgfHwgZGVmYXVsdHMua2VlcEFsaXZlLFxuICAgIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVDb25maWcob3B0aW9uczogJFNoYXBlPFByb2dyYW1PcHRpb25zPiwgZW52OiBQcm9ncmFtRW52LCBkZWZhdWx0czogUHJvZ3JhbU9wdGlvbnMpOiBRQ29uZmlnIHtcbiAgICBjb25zdCByZXNvbHZlZE9wdGlvbnMgPSByZXNvbHZlT3B0aW9ucyhvcHRpb25zLCBlbnYsIGRlZmF1bHRzKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBzZXJ2ZXI6IHtcbiAgICAgICAgICAgIGhvc3Q6IHJlc29sdmVkT3B0aW9ucy5ob3N0LFxuICAgICAgICAgICAgcG9ydDogTnVtYmVyLnBhcnNlSW50KHJlc29sdmVkT3B0aW9ucy5wb3J0KSxcbiAgICAgICAgICAgIHJwY1BvcnQ6IHJlc29sdmVkT3B0aW9ucy5ycGNQb3J0LFxuICAgICAgICAgICAga2VlcEFsaXZlOiBOdW1iZXIucGFyc2VJbnQocmVzb2x2ZWRPcHRpb25zLmtlZXBBbGl2ZSksXG4gICAgICAgIH0sXG4gICAgICAgIHJlcXVlc3RzOiB7XG4gICAgICAgICAgICBtb2RlOiByZXNvbHZlZE9wdGlvbnMucmVxdWVzdHNNb2RlLFxuICAgICAgICAgICAgc2VydmVyOiByZXNvbHZlZE9wdGlvbnMucmVxdWVzdHNTZXJ2ZXIsXG4gICAgICAgICAgICB0b3BpYzogcmVzb2x2ZWRPcHRpb25zLnJlcXVlc3RzVG9waWMsXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGFiYXNlOiB7XG4gICAgICAgICAgICBzZXJ2ZXI6IHJlc29sdmVkT3B0aW9ucy5kYlNlcnZlcixcbiAgICAgICAgICAgIG5hbWU6IHJlc29sdmVkT3B0aW9ucy5kYk5hbWUsXG4gICAgICAgICAgICBhdXRoOiByZXNvbHZlZE9wdGlvbnMuZGJBdXRoLFxuICAgICAgICAgICAgbWF4U29ja2V0czogTnVtYmVyKHJlc29sdmVkT3B0aW9ucy5kYk1heFNvY2tldHMpLFxuICAgICAgICB9LFxuICAgICAgICBzbG93RGF0YWJhc2U6IHtcbiAgICAgICAgICAgIHNlcnZlcjogcmVzb2x2ZWRPcHRpb25zLnNsb3dEYlNlcnZlciB8fCByZXNvbHZlZE9wdGlvbnMuZGJTZXJ2ZXIsXG4gICAgICAgICAgICBuYW1lOiByZXNvbHZlZE9wdGlvbnMuc2xvd0RiTmFtZSB8fCByZXNvbHZlZE9wdGlvbnMuZGJOYW1lLFxuICAgICAgICAgICAgYXV0aDogcmVzb2x2ZWRPcHRpb25zLnNsb3dEYkF1dGggfHwgcmVzb2x2ZWRPcHRpb25zLmRiQXV0aCxcbiAgICAgICAgICAgIG1heFNvY2tldHM6IE51bWJlcihyZXNvbHZlZE9wdGlvbnMuc2xvd0RiTWF4U29ja2V0cyksXG4gICAgICAgIH0sXG4gICAgICAgIGxpc3RlbmVyOiB7XG4gICAgICAgICAgICByZXN0YXJ0VGltZW91dDogMTAwMCxcbiAgICAgICAgfSxcbiAgICAgICAgYXV0aG9yaXphdGlvbjoge1xuICAgICAgICAgICAgZW5kcG9pbnQ6IHJlc29sdmVkT3B0aW9ucy5hdXRoRW5kcG9pbnQsXG4gICAgICAgIH0sXG4gICAgICAgIGphZWdlcjoge1xuICAgICAgICAgICAgZW5kcG9pbnQ6IHJlc29sdmVkT3B0aW9ucy5qYWVnZXJFbmRwb2ludCxcbiAgICAgICAgICAgIHNlcnZpY2U6IHJlc29sdmVkT3B0aW9ucy50cmFjZVNlcnZpY2UsXG4gICAgICAgICAgICB0YWdzOiBwYXJzZVRhZ3MocmVzb2x2ZWRPcHRpb25zLnRyYWNlVGFncyksXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXRzZDoge1xuICAgICAgICAgICAgc2VydmVyOiByZXNvbHZlZE9wdGlvbnMuc3RhdHNkU2VydmVyLFxuICAgICAgICAgICAgdGFnczogKHJlc29sdmVkT3B0aW9ucy5zdGF0c2RUYWdzIHx8ICcnKS5zcGxpdCgnLCcpLm1hcCh4ID0+IHgudHJpbSgpKS5maWx0ZXIoeCA9PiB4KSxcbiAgICAgICAgfSxcbiAgICAgICAgbWFtQWNjZXNzS2V5czogbmV3IFNldCgocmVzb2x2ZWRPcHRpb25zLm1hbUFjY2Vzc0tleXMgfHwgJycpLnNwbGl0KCcsJykpLFxuICAgIH07XG59XG5cbmNvbnN0IElOREVYRVM6IHtcbiAgICBbc3RyaW5nXTogc3RyaW5nW10sXG59ID0ge1xuICAgIGJsb2NrczogW1xuICAgICAgICAnc2VxX25vLCBnZW5fdXRpbWUnLFxuICAgICAgICAnZ2VuX3V0aW1lJyxcbiAgICAgICAgJ3dvcmtjaGFpbl9pZCwgc2hhcmQsIHNlcV9ubycsXG4gICAgICAgICd3b3JrY2hhaW5faWQsIHNlcV9ubycsXG4gICAgICAgICd3b3JrY2hhaW5faWQsIGdlbl91dGltZScsXG4gICAgICAgICdtYXN0ZXIubWluX3NoYXJkX2dlbl91dGltZScsXG4gICAgXSxcbiAgICBhY2NvdW50czogW1xuICAgICAgICAnbGFzdF90cmFuc19sdCcsXG4gICAgICAgICdiYWxhbmNlJyxcbiAgICBdLFxuICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICdibG9ja19pZCcsXG4gICAgICAgICd2YWx1ZSwgY3JlYXRlZF9hdCcsXG4gICAgICAgICdzcmMsIHZhbHVlLCBjcmVhdGVkX2F0JyxcbiAgICAgICAgJ2RzdCwgdmFsdWUsIGNyZWF0ZWRfYXQnLFxuICAgICAgICAnc3JjLCBjcmVhdGVkX2F0JyxcbiAgICAgICAgJ2RzdCwgY3JlYXRlZF9hdCcsXG4gICAgICAgICdzcmMsIGRzdCwgY3JlYXRlZF9hdCwgX2tleScsXG4gICAgICAgICdjcmVhdGVkX2x0JyxcbiAgICAgICAgJ2NyZWF0ZWRfYXQnLFxuICAgIF0sXG4gICAgdHJhbnNhY3Rpb25zOiBbXG4gICAgICAgICdibG9ja19pZCcsXG4gICAgICAgICdpbl9tc2cnLFxuICAgICAgICAnb3V0X21zZ3NbKl0nLFxuICAgICAgICAnYWNjb3VudF9hZGRyLCBub3cnLFxuICAgICAgICAnbm93JyxcbiAgICAgICAgJ2x0JyxcbiAgICAgICAgJ2FjY291bnRfYWRkciwgb3JpZ19zdGF0dXMsIGVuZF9zdGF0dXMnLFxuICAgICAgICAnbm93LCBhY2NvdW50X2FkZHIsIGx0JyxcbiAgICBdLFxuICAgIGJsb2Nrc19zaWduYXR1cmVzOiBbXG4gICAgICAgICdzaWduYXR1cmVzWypdLm5vZGVfaWQsIGdlbl91dGltZScsXG4gICAgXSxcbn07XG5cbmV4cG9ydCB0eXBlIEluZGV4SW5mbyA9IHtcbiAgICBmaWVsZHM6IHN0cmluZ1tdLFxufVxuXG5leHBvcnQgdHlwZSBDb2xsZWN0aW9uSW5mbyA9IHtcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgaW5kZXhlczogSW5kZXhJbmZvW10sXG59O1xuXG5leHBvcnQgdHlwZSBEYkluZm8gPSB7XG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGNvbGxlY3Rpb25zOiB7XG4gICAgICAgIFtzdHJpbmddOiBDb2xsZWN0aW9uSW5mbyxcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBCTE9DS0NIQUlOX0RCOiBEYkluZm8gPSB7XG4gICAgbGFzdFVwZGF0ZVRpbWU6IDAsXG4gICAgbmFtZTogJ2Jsb2NrY2hhaW4nLFxuICAgIGNvbGxlY3Rpb25zOiB7fSxcbn07XG5cbk9iamVjdC5lbnRyaWVzKElOREVYRVMpLmZvckVhY2goKFtuYW1lLCBpbmRleGVzXSkgPT4ge1xuICAgIEJMT0NLQ0hBSU5fREIuY29sbGVjdGlvbnNbbmFtZV0gPSB7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGluZGV4ZXM6IFsnX2tleScsIC4uLihpbmRleGVzOiBhbnkpXS5tYXAocGFyc2VJbmRleCksXG4gICAgfVxufSk7XG5cbmV4cG9ydCBjb25zdCBTVEFUUyA9IHtcbiAgICBwcmVmaXg6ICdxc2VydmVyLicsXG4gICAgZG9jOiB7XG4gICAgICAgIGNvdW50OiAnZG9jLmNvdW50JyxcbiAgICB9LFxuICAgIHBvc3Q6IHtcbiAgICAgICAgY291bnQ6ICdwb3N0LmNvdW50JyxcbiAgICAgICAgZmFpbGVkOiAncG9zdC5mYWlsZWQnLFxuICAgIH0sXG4gICAgcXVlcnk6IHtcbiAgICAgICAgY291bnQ6ICdxdWVyeS5jb3VudCcsXG4gICAgICAgIHRpbWU6ICdxdWVyeS50aW1lJyxcbiAgICAgICAgYWN0aXZlOiAncXVlcnkuYWN0aXZlJyxcbiAgICAgICAgZmFpbGVkOiAncXVlcnkuZmFpbGVkJyxcbiAgICAgICAgc2xvdzogJ3F1ZXJ5LnNsb3cnLFxuICAgIH0sXG4gICAgc3Vic2NyaXB0aW9uOiB7XG4gICAgICAgIGFjdGl2ZTogJ3N1YnNjcmlwdGlvbi5hY3RpdmUnLFxuICAgIH0sXG4gICAgd2FpdEZvcjoge1xuICAgICAgICBhY3RpdmU6ICd3YWl0Zm9yLmFjdGl2ZScsXG4gICAgfSxcbn07XG5cbiJdfQ==