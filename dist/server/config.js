"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ensureProtocol = ensureProtocol;
exports.resolveOptions = resolveOptions;
exports.createConfig = createConfig;
exports.STATS = exports.BLOCKCHAIN_DB = exports.defaultOptions = exports.QRequestsMode = void 0;

var _os = _interopRequireDefault(require("os"));

var _dbTypes = require("./db-types");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
 * Copyright 2018-2020 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at:
 *
 * http://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 */
const QRequestsMode = {
  kafka: 'kafka',
  rest: 'rest'
};
exports.QRequestsMode = QRequestsMode;

function ensureProtocol(address, defaultProtocol) {
  return /^\w+:\/\//gi.test(address) ? address : `${defaultProtocol}://${address}`;
}

function getIp() {
  const ipv4 = Object.values(_os.default.networkInterfaces()).reduce((acc, x) => acc.concat(x), []).find(x => x.family === 'IPv4' && !x.internal);
  return ipv4 && ipv4.address;
}

function parseTags(s) {
  const tags = {};
  s.split(',').forEach(t => {
    const i = t.indexOf('=');

    if (i >= 0) {
      tags[t.substr(0, i)] = t.substr(i + 1);
    } else {
      tags[t] = '';
    }
  });
  return tags;
}

const defaultOptions = {
  host: getIp(),
  port: '4000',
  rpcPort: '',
  requestsMode: 'kafka',
  requestsServer: 'kafka:9092',
  requestsTopic: 'requests',
  dbServer: 'arangodb:8529',
  dbName: 'blockchain',
  dbAuth: '',
  dbMaxSockets: '100',
  slowDbServer: '',
  slowDbName: '',
  slowDbAuth: '',
  slowDbMaxSockets: '3',
  authEndpoint: '',
  mamAccessKeys: '',
  jaegerEndpoint: '',
  traceService: 'Q Server',
  traceTags: '',
  statsdServer: '',
  statsdTags: '',
  keepAlive: '60000'
};
exports.defaultOptions = defaultOptions;

function resolveOptions(options, env, defaults) {
  return {
    host: options.host || env.Q_SERVER_HOST || defaults.host,
    port: options.port || env.Q_SERVER_PORT || defaults.port,
    rpcPort: options.rpcPort || env.Q_SERVER_RPC_PORT || defaults.rpcPort,
    requestsMode: options.requestsMode || env.Q_REQUESTS_MODE || defaults.requestsMode,
    requestsServer: options.requestsServer || env.Q_REQUESTS_SERVER || defaults.requestsServer,
    requestsTopic: options.requestsTopic || env.Q_REQUESTS_TOPIC || defaults.requestsTopic,
    dbServer: options.dbServer || env.Q_DATABASE_SERVER || defaults.dbServer,
    dbName: options.dbName || env.Q_DATABASE_NAME || defaults.dbName,
    dbAuth: options.dbAuth || env.Q_DATABASE_AUTH || defaults.dbAuth,
    dbMaxSockets: options.dbMaxSockets || env.Q_DATABASE_MAX_SOCKETS || defaults.dbMaxSockets,
    slowDbServer: options.slowDbServer || env.Q_SLOW_DATABASE_SERVER || defaults.slowDbServer,
    slowDbName: options.slowDbName || env.Q_SLOW_DATABASE_NAME || defaults.slowDbName,
    slowDbAuth: options.slowDbAuth || env.Q_SLOW_DATABASE_AUTH || defaults.slowDbAuth,
    slowDbMaxSockets: options.slowDbMaxSockets || env.Q_SLOW_DATABASE_MAX_SOCKETS || defaults.slowDbMaxSockets,
    authEndpoint: options.authEndpoint || env.Q_AUTH_ENDPOINT || defaults.authEndpoint,
    mamAccessKeys: options.mamAccessKeys || env.Q_MAM_ACCESS_KEYS || defaults.mamAccessKeys,
    jaegerEndpoint: options.jaegerEndpoint || env.Q_JAEGER_ENDPOINT || defaults.jaegerEndpoint,
    traceService: options.traceService || env.Q_TRACE_SERVICE || defaults.traceService,
    traceTags: options.traceTags || env.Q_TRACE_TAGS || defaults.traceTags,
    statsdServer: options.statsdServer || env.Q_STATSD_SERVER || defaults.statsdServer,
    statsdTags: options.statsdTags || env.Q_STATSD_TAGS || defaults.statsdTags,
    keepAlive: options.keepAlive || env.Q_KEEP_ALIVE || defaults.keepAlive
  };
}

function createConfig(options, env, defaults) {
  const resolvedOptions = resolveOptions(options, env, defaults);
  return {
    server: {
      host: resolvedOptions.host,
      port: Number.parseInt(resolvedOptions.port),
      rpcPort: resolvedOptions.rpcPort,
      keepAlive: Number.parseInt(resolvedOptions.keepAlive)
    },
    requests: {
      mode: resolvedOptions.requestsMode,
      server: resolvedOptions.requestsServer,
      topic: resolvedOptions.requestsTopic
    },
    database: {
      server: resolvedOptions.dbServer,
      name: resolvedOptions.dbName,
      auth: resolvedOptions.dbAuth,
      maxSockets: Number(resolvedOptions.dbMaxSockets)
    },
    slowDatabase: {
      server: resolvedOptions.slowDbServer || resolvedOptions.dbServer,
      name: resolvedOptions.slowDbName || resolvedOptions.dbName,
      auth: resolvedOptions.slowDbAuth || resolvedOptions.dbAuth,
      maxSockets: Number(resolvedOptions.slowDbMaxSockets)
    },
    listener: {
      restartTimeout: 1000
    },
    authorization: {
      endpoint: resolvedOptions.authEndpoint
    },
    jaeger: {
      endpoint: resolvedOptions.jaegerEndpoint,
      service: resolvedOptions.traceService,
      tags: parseTags(resolvedOptions.traceTags)
    },
    statsd: {
      server: resolvedOptions.statsdServer,
      tags: (resolvedOptions.statsdTags || '').split(',').map(x => x.trim()).filter(x => x)
    },
    mamAccessKeys: new Set((resolvedOptions.mamAccessKeys || '').split(','))
  };
}

const INDEXES = {
  blocks: ['seq_no, gen_utime', 'gen_utime', 'workchain_id, shard, seq_no', 'workchain_id, seq_no', 'workchain_id, gen_utime', 'master.min_shard_gen_utime'],
  accounts: ['last_trans_lt', 'balance'],
  messages: ['block_id', 'value, created_at', 'src, value, created_at', 'dst, value, created_at', 'src, created_at', 'dst, created_at', 'src, dst, created_at, _key', 'created_lt', 'created_at'],
  transactions: ['block_id', 'in_msg', 'out_msgs[*]', 'account_addr, now', 'now', 'lt', 'account_addr, orig_status, end_status', 'now, account_addr, lt'],
  blocks_signatures: ['signatures[*].node_id, gen_utime']
};
const BLOCKCHAIN_DB = {
  lastUpdateTime: 0,
  name: 'blockchain',
  collections: {}
};
exports.BLOCKCHAIN_DB = BLOCKCHAIN_DB;
Object.entries(INDEXES).forEach(([name, indexes]) => {
  BLOCKCHAIN_DB.collections[name] = {
    name,
    indexes: ['_key', ...indexes].map(_dbTypes.parseIndex)
  };
});
const STATS = {
  start: 'start',
  prefix: 'qserver.',
  doc: {
    count: 'doc.count'
  },
  post: {
    count: 'post.count',
    failed: 'post.failed'
  },
  query: {
    count: 'query.count',
    time: 'query.time',
    active: 'query.active',
    failed: 'query.failed',
    slow: 'query.slow'
  },
  subscription: {
    active: 'subscription.active'
  },
  waitFor: {
    active: 'waitfor.active'
  }
};
exports.STATS = STATS;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NlcnZlci9jb25maWcuanMiXSwibmFtZXMiOlsiUVJlcXVlc3RzTW9kZSIsImthZmthIiwicmVzdCIsImVuc3VyZVByb3RvY29sIiwiYWRkcmVzcyIsImRlZmF1bHRQcm90b2NvbCIsInRlc3QiLCJnZXRJcCIsImlwdjQiLCJPYmplY3QiLCJ2YWx1ZXMiLCJvcyIsIm5ldHdvcmtJbnRlcmZhY2VzIiwicmVkdWNlIiwiYWNjIiwieCIsImNvbmNhdCIsImZpbmQiLCJmYW1pbHkiLCJpbnRlcm5hbCIsInBhcnNlVGFncyIsInMiLCJ0YWdzIiwic3BsaXQiLCJmb3JFYWNoIiwidCIsImkiLCJpbmRleE9mIiwic3Vic3RyIiwiZGVmYXVsdE9wdGlvbnMiLCJob3N0IiwicG9ydCIsInJwY1BvcnQiLCJyZXF1ZXN0c01vZGUiLCJyZXF1ZXN0c1NlcnZlciIsInJlcXVlc3RzVG9waWMiLCJkYlNlcnZlciIsImRiTmFtZSIsImRiQXV0aCIsImRiTWF4U29ja2V0cyIsInNsb3dEYlNlcnZlciIsInNsb3dEYk5hbWUiLCJzbG93RGJBdXRoIiwic2xvd0RiTWF4U29ja2V0cyIsImF1dGhFbmRwb2ludCIsIm1hbUFjY2Vzc0tleXMiLCJqYWVnZXJFbmRwb2ludCIsInRyYWNlU2VydmljZSIsInRyYWNlVGFncyIsInN0YXRzZFNlcnZlciIsInN0YXRzZFRhZ3MiLCJrZWVwQWxpdmUiLCJyZXNvbHZlT3B0aW9ucyIsIm9wdGlvbnMiLCJlbnYiLCJkZWZhdWx0cyIsIlFfU0VSVkVSX0hPU1QiLCJRX1NFUlZFUl9QT1JUIiwiUV9TRVJWRVJfUlBDX1BPUlQiLCJRX1JFUVVFU1RTX01PREUiLCJRX1JFUVVFU1RTX1NFUlZFUiIsIlFfUkVRVUVTVFNfVE9QSUMiLCJRX0RBVEFCQVNFX1NFUlZFUiIsIlFfREFUQUJBU0VfTkFNRSIsIlFfREFUQUJBU0VfQVVUSCIsIlFfREFUQUJBU0VfTUFYX1NPQ0tFVFMiLCJRX1NMT1dfREFUQUJBU0VfU0VSVkVSIiwiUV9TTE9XX0RBVEFCQVNFX05BTUUiLCJRX1NMT1dfREFUQUJBU0VfQVVUSCIsIlFfU0xPV19EQVRBQkFTRV9NQVhfU09DS0VUUyIsIlFfQVVUSF9FTkRQT0lOVCIsIlFfTUFNX0FDQ0VTU19LRVlTIiwiUV9KQUVHRVJfRU5EUE9JTlQiLCJRX1RSQUNFX1NFUlZJQ0UiLCJRX1RSQUNFX1RBR1MiLCJRX1NUQVRTRF9TRVJWRVIiLCJRX1NUQVRTRF9UQUdTIiwiUV9LRUVQX0FMSVZFIiwiY3JlYXRlQ29uZmlnIiwicmVzb2x2ZWRPcHRpb25zIiwic2VydmVyIiwiTnVtYmVyIiwicGFyc2VJbnQiLCJyZXF1ZXN0cyIsIm1vZGUiLCJ0b3BpYyIsImRhdGFiYXNlIiwibmFtZSIsImF1dGgiLCJtYXhTb2NrZXRzIiwic2xvd0RhdGFiYXNlIiwibGlzdGVuZXIiLCJyZXN0YXJ0VGltZW91dCIsImF1dGhvcml6YXRpb24iLCJlbmRwb2ludCIsImphZWdlciIsInNlcnZpY2UiLCJzdGF0c2QiLCJtYXAiLCJ0cmltIiwiZmlsdGVyIiwiU2V0IiwiSU5ERVhFUyIsImJsb2NrcyIsImFjY291bnRzIiwibWVzc2FnZXMiLCJ0cmFuc2FjdGlvbnMiLCJibG9ja3Nfc2lnbmF0dXJlcyIsIkJMT0NLQ0hBSU5fREIiLCJsYXN0VXBkYXRlVGltZSIsImNvbGxlY3Rpb25zIiwiZW50cmllcyIsImluZGV4ZXMiLCJwYXJzZUluZGV4IiwiU1RBVFMiLCJzdGFydCIsInByZWZpeCIsImRvYyIsImNvdW50IiwicG9zdCIsImZhaWxlZCIsInF1ZXJ5IiwidGltZSIsImFjdGl2ZSIsInNsb3ciLCJzdWJzY3JpcHRpb24iLCJ3YWl0Rm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBa0JBOztBQUNBOzs7O0FBbkJBOzs7Ozs7Ozs7Ozs7Ozs7QUFxQk8sTUFBTUEsYUFBYSxHQUFHO0FBQ3pCQyxFQUFBQSxLQUFLLEVBQUUsT0FEa0I7QUFFekJDLEVBQUFBLElBQUksRUFBRTtBQUZtQixDQUF0Qjs7O0FBK0ZBLFNBQVNDLGNBQVQsQ0FBd0JDLE9BQXhC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QUFFO0FBRE4sR0FIWTtBQU1qQkMsRUFBQUEsSUFBSSxFQUFFO0FBQ0ZELElBQUFBLEtBQUssRUFBRSxZQURMO0FBRUZFLElBQUFBLE1BQU0sRUFBRTtBQUZOLEdBTlc7QUFVakJDLEVBQUFBLEtBQUssRUFBRTtBQUNISCxJQUFBQSxLQUFLLEVBQUUsYUFESjtBQUVISSxJQUFBQSxJQUFJLEVBQUUsWUFGSDtBQUdIQyxJQUFBQSxNQUFNLEVBQUUsY0FITDtBQUlISCxJQUFBQSxNQUFNLEVBQUUsY0FKTDtBQUtISSxJQUFBQSxJQUFJLEVBQUU7QUFMSCxHQVZVO0FBaUJqQkMsRUFBQUEsWUFBWSxFQUFFO0FBQ1ZGLElBQUFBLE1BQU0sRUFBRTtBQURFLEdBakJHO0FBb0JqQkcsRUFBQUEsT0FBTyxFQUFFO0FBQ0xILElBQUFBLE1BQU0sRUFBRTtBQURIO0FBcEJRLENBQWQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTgtMjAyMCBUT04gREVWIFNPTFVUSU9OUyBMVEQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIFNPRlRXQVJFIEVWQUxVQVRJT04gTGljZW5zZSAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlXG4gKiB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcbiAqIExpY2Vuc2UgYXQ6XG4gKlxuICogaHR0cDovL3d3dy50b24uZGV2L2xpY2Vuc2VzXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBUT04gREVWIHNvZnR3YXJlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbi8vIEBmbG93XG5cbmltcG9ydCBvcyBmcm9tIFwib3NcIjtcbmltcG9ydCB7cGFyc2VJbmRleH0gZnJvbSBcIi4vZGItdHlwZXNcIjtcblxuZXhwb3J0IGNvbnN0IFFSZXF1ZXN0c01vZGUgPSB7XG4gICAga2Fma2E6ICdrYWZrYScsXG4gICAgcmVzdDogJ3Jlc3QnLFxufTtcblxuZXhwb3J0IHR5cGUgUURiQ29uZmlnID0ge1xuICAgIHNlcnZlcjogc3RyaW5nLFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBhdXRoOiBzdHJpbmcsXG4gICAgbWF4U29ja2V0czogbnVtYmVyLFxufTtcblxuZXhwb3J0IHR5cGUgUUNvbmZpZyA9IHtcbiAgICBzZXJ2ZXI6IHtcbiAgICAgICAgaG9zdDogc3RyaW5nLFxuICAgICAgICBwb3J0OiBudW1iZXIsXG4gICAgICAgIHJwY1BvcnQ6IHN0cmluZyxcbiAgICAgICAga2VlcEFsaXZlOiBudW1iZXIsXG4gICAgfSxcbiAgICByZXF1ZXN0czoge1xuICAgICAgICBtb2RlOiAna2Fma2EnIHwgJ3Jlc3QnLFxuICAgICAgICBzZXJ2ZXI6IHN0cmluZyxcbiAgICAgICAgdG9waWM6IHN0cmluZyxcbiAgICB9LFxuICAgIGRhdGFiYXNlOiBRRGJDb25maWcsXG4gICAgc2xvd0RhdGFiYXNlOiBRRGJDb25maWcsXG4gICAgbGlzdGVuZXI6IHtcbiAgICAgICAgcmVzdGFydFRpbWVvdXQ6IG51bWJlclxuICAgIH0sXG4gICAgYXV0aG9yaXphdGlvbjoge1xuICAgICAgICBlbmRwb2ludDogc3RyaW5nLFxuICAgIH0sXG4gICAgamFlZ2VyOiB7XG4gICAgICAgIGVuZHBvaW50OiBzdHJpbmcsXG4gICAgICAgIHNlcnZpY2U6IHN0cmluZyxcbiAgICAgICAgdGFnczogeyBbc3RyaW5nXTogc3RyaW5nIH1cbiAgICB9LFxuICAgIHN0YXRzZDoge1xuICAgICAgICBzZXJ2ZXI6IHN0cmluZyxcbiAgICAgICAgdGFnczogc3RyaW5nW10sXG4gICAgfSxcbiAgICBtYW1BY2Nlc3NLZXlzOiBTZXQ8c3RyaW5nPixcbiAgICBpc1Rlc3RzPzogYm9vbGVhbixcbn1cblxuZXhwb3J0IHR5cGUgUHJvZ3JhbU9wdGlvbnMgPSB7XG4gICAgcmVxdWVzdHNNb2RlOiAna2Fma2EnIHwgJ3Jlc3QnLFxuICAgIHJlcXVlc3RzU2VydmVyOiBzdHJpbmcsXG4gICAgcmVxdWVzdHNUb3BpYzogc3RyaW5nLFxuICAgIGRiU2VydmVyOiBzdHJpbmcsXG4gICAgZGJOYW1lOiBzdHJpbmcsXG4gICAgZGJBdXRoOiBzdHJpbmcsXG4gICAgZGJNYXhTb2NrZXRzOiBzdHJpbmcsXG4gICAgc2xvd0RiU2VydmVyOiBzdHJpbmcsXG4gICAgc2xvd0RiTmFtZTogc3RyaW5nLFxuICAgIHNsb3dEYkF1dGg6IHN0cmluZyxcbiAgICBzbG93RGJNYXhTb2NrZXRzOiBzdHJpbmcsXG4gICAgaG9zdDogc3RyaW5nLFxuICAgIHBvcnQ6IHN0cmluZyxcbiAgICBycGNQb3J0OiBzdHJpbmcsXG4gICAgamFlZ2VyRW5kcG9pbnQ6IHN0cmluZyxcbiAgICB0cmFjZVNlcnZpY2U6IHN0cmluZyxcbiAgICB0cmFjZVRhZ3M6IHN0cmluZyxcbiAgICBhdXRoRW5kcG9pbnQ6IHN0cmluZyxcbiAgICBzdGF0c2RTZXJ2ZXI6IHN0cmluZyxcbiAgICBzdGF0c2RUYWdzOiBzdHJpbmcsXG4gICAgbWFtQWNjZXNzS2V5czogc3RyaW5nLFxuICAgIGtlZXBBbGl2ZTogc3RyaW5nLFxufVxuXG50eXBlIFByb2dyYW1FbnYgPSB7XG4gICAgUV9TRVJWRVJfSE9TVDogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1NFUlZFUl9QT1JUOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfU0VSVkVSX1JQQ19QT1JUOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfUkVRVUVTVFNfTU9ERTogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1JFUVVFU1RTX1NFUlZFUjogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1JFUVVFU1RTX1RPUElDOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfREFUQUJBU0VfU0VSVkVSOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfREFUQUJBU0VfTkFNRTogc3RyaW5nIHwgdm9pZCxcbiAgICBRX0RBVEFCQVNFX0FVVEg6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9EQVRBQkFTRV9NQVhfU09DS0VUUzogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1NMT1dfREFUQUJBU0VfU0VSVkVSOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfU0xPV19EQVRBQkFTRV9OQU1FOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfU0xPV19EQVRBQkFTRV9BVVRIOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfU0xPV19EQVRBQkFTRV9NQVhfU09DS0VUUzogc3RyaW5nIHwgdm9pZCxcbiAgICBRX0FVVEhfRU5EUE9JTlQ6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9NQU1fQUNDRVNTX0tFWVM6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9KQUVHRVJfRU5EUE9JTlQ6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9UUkFDRV9TRVJWSUNFOiBzdHJpbmcgfCB2b2lkLFxuICAgIFFfVFJBQ0VfVEFHUzogc3RyaW5nIHwgdm9pZCxcbiAgICBRX1NUQVRTRF9TRVJWRVI6IHN0cmluZyB8IHZvaWQsXG4gICAgUV9TVEFUU0RfVEFHUzogc3RyaW5nIHwgdm9pZCxcbiAgICBRX0tFRVBfQUxJVkU6IHN0cmluZyB8IHZvaWQsXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbnN1cmVQcm90b2NvbChhZGRyZXNzOiBzdHJpbmcsIGRlZmF1bHRQcm90b2NvbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gL15cXHcrOlxcL1xcLy9naS50ZXN0KGFkZHJlc3MpID8gYWRkcmVzcyA6IGAke2RlZmF1bHRQcm90b2NvbH06Ly8ke2FkZHJlc3N9YDtcbn1cblxuZnVuY3Rpb24gZ2V0SXAoKTogc3RyaW5nIHtcbiAgICBjb25zdCBpcHY0ID0gKE9iamVjdC52YWx1ZXMob3MubmV0d29ya0ludGVyZmFjZXMoKSk6IGFueSlcbiAgICAgICAgLnJlZHVjZSgoYWNjLCB4KSA9PiBhY2MuY29uY2F0KHgpLCBbXSlcbiAgICAgICAgLmZpbmQoeCA9PiB4LmZhbWlseSA9PT0gJ0lQdjQnICYmICF4LmludGVybmFsKTtcbiAgICByZXR1cm4gaXB2NCAmJiBpcHY0LmFkZHJlc3M7XG59XG5cbmZ1bmN0aW9uIHBhcnNlVGFncyhzOiBzdHJpbmcpOiB7IFtzdHJpbmddOiBzdHJpbmcgfSB7XG4gICAgY29uc3QgdGFnczogeyBbc3RyaW5nXTogc3RyaW5nIH0gPSB7fTtcbiAgICBzLnNwbGl0KCcsJykuZm9yRWFjaCgodCkgPT4ge1xuICAgICAgICBjb25zdCBpID0gdC5pbmRleE9mKCc9Jyk7XG4gICAgICAgIGlmIChpID49IDApIHtcbiAgICAgICAgICAgIHRhZ3NbdC5zdWJzdHIoMCwgaSldID0gdC5zdWJzdHIoaSArIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFnc1t0XSA9ICcnO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHRhZ3M7XG5cbn1cblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRPcHRpb25zOiBQcm9ncmFtT3B0aW9ucyA9IHtcbiAgICBob3N0OiBnZXRJcCgpLFxuICAgIHBvcnQ6ICc0MDAwJyxcbiAgICBycGNQb3J0OiAnJyxcbiAgICByZXF1ZXN0c01vZGU6ICdrYWZrYScsXG4gICAgcmVxdWVzdHNTZXJ2ZXI6ICdrYWZrYTo5MDkyJyxcbiAgICByZXF1ZXN0c1RvcGljOiAncmVxdWVzdHMnLFxuICAgIGRiU2VydmVyOiAnYXJhbmdvZGI6ODUyOScsXG4gICAgZGJOYW1lOiAnYmxvY2tjaGFpbicsXG4gICAgZGJBdXRoOiAnJyxcbiAgICBkYk1heFNvY2tldHM6ICcxMDAnLFxuICAgIHNsb3dEYlNlcnZlcjogJycsXG4gICAgc2xvd0RiTmFtZTogJycsXG4gICAgc2xvd0RiQXV0aDogJycsXG4gICAgc2xvd0RiTWF4U29ja2V0czogJzMnLFxuICAgIGF1dGhFbmRwb2ludDogJycsXG4gICAgbWFtQWNjZXNzS2V5czogJycsXG4gICAgamFlZ2VyRW5kcG9pbnQ6ICcnLFxuICAgIHRyYWNlU2VydmljZTogJ1EgU2VydmVyJyxcbiAgICB0cmFjZVRhZ3M6ICcnLFxuICAgIHN0YXRzZFNlcnZlcjogJycsXG4gICAgc3RhdHNkVGFnczogJycsXG4gICAga2VlcEFsaXZlOiAnNjAwMDAnLFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVPcHRpb25zKG9wdGlvbnM6ICRTaGFwZTxQcm9ncmFtT3B0aW9ucz4sIGVudjogUHJvZ3JhbUVudiwgZGVmYXVsdHM6IFByb2dyYW1PcHRpb25zKTogUHJvZ3JhbU9wdGlvbnMge1xuICAgIHJldHVybiB7XG4gICAgICAgIGhvc3Q6IG9wdGlvbnMuaG9zdCB8fCBlbnYuUV9TRVJWRVJfSE9TVCB8fCBkZWZhdWx0cy5ob3N0LFxuICAgICAgICBwb3J0OiBvcHRpb25zLnBvcnQgfHwgZW52LlFfU0VSVkVSX1BPUlQgfHwgZGVmYXVsdHMucG9ydCxcbiAgICAgICAgcnBjUG9ydDogb3B0aW9ucy5ycGNQb3J0IHx8IGVudi5RX1NFUlZFUl9SUENfUE9SVCB8fCBkZWZhdWx0cy5ycGNQb3J0LFxuICAgICAgICByZXF1ZXN0c01vZGU6IG9wdGlvbnMucmVxdWVzdHNNb2RlIHx8IChlbnYuUV9SRVFVRVNUU19NT0RFOiBhbnkpIHx8IGRlZmF1bHRzLnJlcXVlc3RzTW9kZSxcbiAgICAgICAgcmVxdWVzdHNTZXJ2ZXI6IG9wdGlvbnMucmVxdWVzdHNTZXJ2ZXIgfHwgZW52LlFfUkVRVUVTVFNfU0VSVkVSIHx8IGRlZmF1bHRzLnJlcXVlc3RzU2VydmVyLFxuICAgICAgICByZXF1ZXN0c1RvcGljOiBvcHRpb25zLnJlcXVlc3RzVG9waWMgfHwgZW52LlFfUkVRVUVTVFNfVE9QSUMgfHwgZGVmYXVsdHMucmVxdWVzdHNUb3BpYyxcbiAgICAgICAgZGJTZXJ2ZXI6IG9wdGlvbnMuZGJTZXJ2ZXIgfHwgZW52LlFfREFUQUJBU0VfU0VSVkVSIHx8IGRlZmF1bHRzLmRiU2VydmVyLFxuICAgICAgICBkYk5hbWU6IG9wdGlvbnMuZGJOYW1lIHx8IGVudi5RX0RBVEFCQVNFX05BTUUgfHwgZGVmYXVsdHMuZGJOYW1lLFxuICAgICAgICBkYkF1dGg6IG9wdGlvbnMuZGJBdXRoIHx8IGVudi5RX0RBVEFCQVNFX0FVVEggfHwgZGVmYXVsdHMuZGJBdXRoLFxuICAgICAgICBkYk1heFNvY2tldHM6IG9wdGlvbnMuZGJNYXhTb2NrZXRzIHx8IGVudi5RX0RBVEFCQVNFX01BWF9TT0NLRVRTIHx8IGRlZmF1bHRzLmRiTWF4U29ja2V0cyxcbiAgICAgICAgc2xvd0RiU2VydmVyOiBvcHRpb25zLnNsb3dEYlNlcnZlciB8fCBlbnYuUV9TTE9XX0RBVEFCQVNFX1NFUlZFUiB8fCBkZWZhdWx0cy5zbG93RGJTZXJ2ZXIsXG4gICAgICAgIHNsb3dEYk5hbWU6IG9wdGlvbnMuc2xvd0RiTmFtZSB8fCBlbnYuUV9TTE9XX0RBVEFCQVNFX05BTUUgfHwgZGVmYXVsdHMuc2xvd0RiTmFtZSxcbiAgICAgICAgc2xvd0RiQXV0aDogb3B0aW9ucy5zbG93RGJBdXRoIHx8IGVudi5RX1NMT1dfREFUQUJBU0VfQVVUSCB8fCBkZWZhdWx0cy5zbG93RGJBdXRoLFxuICAgICAgICBzbG93RGJNYXhTb2NrZXRzOiBvcHRpb25zLnNsb3dEYk1heFNvY2tldHMgfHwgZW52LlFfU0xPV19EQVRBQkFTRV9NQVhfU09DS0VUUyB8fCBkZWZhdWx0cy5zbG93RGJNYXhTb2NrZXRzLFxuICAgICAgICBhdXRoRW5kcG9pbnQ6IG9wdGlvbnMuYXV0aEVuZHBvaW50IHx8IGVudi5RX0FVVEhfRU5EUE9JTlQgfHwgZGVmYXVsdHMuYXV0aEVuZHBvaW50LFxuICAgICAgICBtYW1BY2Nlc3NLZXlzOiBvcHRpb25zLm1hbUFjY2Vzc0tleXMgfHwgZW52LlFfTUFNX0FDQ0VTU19LRVlTIHx8IGRlZmF1bHRzLm1hbUFjY2Vzc0tleXMsXG4gICAgICAgIGphZWdlckVuZHBvaW50OiBvcHRpb25zLmphZWdlckVuZHBvaW50IHx8IGVudi5RX0pBRUdFUl9FTkRQT0lOVCB8fCBkZWZhdWx0cy5qYWVnZXJFbmRwb2ludCxcbiAgICAgICAgdHJhY2VTZXJ2aWNlOiBvcHRpb25zLnRyYWNlU2VydmljZSB8fCBlbnYuUV9UUkFDRV9TRVJWSUNFIHx8IGRlZmF1bHRzLnRyYWNlU2VydmljZSxcbiAgICAgICAgdHJhY2VUYWdzOiBvcHRpb25zLnRyYWNlVGFncyB8fCBlbnYuUV9UUkFDRV9UQUdTIHx8IGRlZmF1bHRzLnRyYWNlVGFncyxcbiAgICAgICAgc3RhdHNkU2VydmVyOiBvcHRpb25zLnN0YXRzZFNlcnZlciB8fCBlbnYuUV9TVEFUU0RfU0VSVkVSIHx8IGRlZmF1bHRzLnN0YXRzZFNlcnZlcixcbiAgICAgICAgc3RhdHNkVGFnczogb3B0aW9ucy5zdGF0c2RUYWdzIHx8IGVudi5RX1NUQVRTRF9UQUdTIHx8IGRlZmF1bHRzLnN0YXRzZFRhZ3MsXG4gICAgICAgIGtlZXBBbGl2ZTogb3B0aW9ucy5rZWVwQWxpdmUgfHwgZW52LlFfS0VFUF9BTElWRSB8fCBkZWZhdWx0cy5rZWVwQWxpdmUsXG4gICAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNvbmZpZyhvcHRpb25zOiAkU2hhcGU8UHJvZ3JhbU9wdGlvbnM+LCBlbnY6IFByb2dyYW1FbnYsIGRlZmF1bHRzOiBQcm9ncmFtT3B0aW9ucyk6IFFDb25maWcge1xuICAgIGNvbnN0IHJlc29sdmVkT3B0aW9ucyA9IHJlc29sdmVPcHRpb25zKG9wdGlvbnMsIGVudiwgZGVmYXVsdHMpO1xuICAgIHJldHVybiB7XG4gICAgICAgIHNlcnZlcjoge1xuICAgICAgICAgICAgaG9zdDogcmVzb2x2ZWRPcHRpb25zLmhvc3QsXG4gICAgICAgICAgICBwb3J0OiBOdW1iZXIucGFyc2VJbnQocmVzb2x2ZWRPcHRpb25zLnBvcnQpLFxuICAgICAgICAgICAgcnBjUG9ydDogcmVzb2x2ZWRPcHRpb25zLnJwY1BvcnQsXG4gICAgICAgICAgICBrZWVwQWxpdmU6IE51bWJlci5wYXJzZUludChyZXNvbHZlZE9wdGlvbnMua2VlcEFsaXZlKSxcbiAgICAgICAgfSxcbiAgICAgICAgcmVxdWVzdHM6IHtcbiAgICAgICAgICAgIG1vZGU6IHJlc29sdmVkT3B0aW9ucy5yZXF1ZXN0c01vZGUsXG4gICAgICAgICAgICBzZXJ2ZXI6IHJlc29sdmVkT3B0aW9ucy5yZXF1ZXN0c1NlcnZlcixcbiAgICAgICAgICAgIHRvcGljOiByZXNvbHZlZE9wdGlvbnMucmVxdWVzdHNUb3BpYyxcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YWJhc2U6IHtcbiAgICAgICAgICAgIHNlcnZlcjogcmVzb2x2ZWRPcHRpb25zLmRiU2VydmVyLFxuICAgICAgICAgICAgbmFtZTogcmVzb2x2ZWRPcHRpb25zLmRiTmFtZSxcbiAgICAgICAgICAgIGF1dGg6IHJlc29sdmVkT3B0aW9ucy5kYkF1dGgsXG4gICAgICAgICAgICBtYXhTb2NrZXRzOiBOdW1iZXIocmVzb2x2ZWRPcHRpb25zLmRiTWF4U29ja2V0cyksXG4gICAgICAgIH0sXG4gICAgICAgIHNsb3dEYXRhYmFzZToge1xuICAgICAgICAgICAgc2VydmVyOiByZXNvbHZlZE9wdGlvbnMuc2xvd0RiU2VydmVyIHx8IHJlc29sdmVkT3B0aW9ucy5kYlNlcnZlcixcbiAgICAgICAgICAgIG5hbWU6IHJlc29sdmVkT3B0aW9ucy5zbG93RGJOYW1lIHx8IHJlc29sdmVkT3B0aW9ucy5kYk5hbWUsXG4gICAgICAgICAgICBhdXRoOiByZXNvbHZlZE9wdGlvbnMuc2xvd0RiQXV0aCB8fCByZXNvbHZlZE9wdGlvbnMuZGJBdXRoLFxuICAgICAgICAgICAgbWF4U29ja2V0czogTnVtYmVyKHJlc29sdmVkT3B0aW9ucy5zbG93RGJNYXhTb2NrZXRzKSxcbiAgICAgICAgfSxcbiAgICAgICAgbGlzdGVuZXI6IHtcbiAgICAgICAgICAgIHJlc3RhcnRUaW1lb3V0OiAxMDAwLFxuICAgICAgICB9LFxuICAgICAgICBhdXRob3JpemF0aW9uOiB7XG4gICAgICAgICAgICBlbmRwb2ludDogcmVzb2x2ZWRPcHRpb25zLmF1dGhFbmRwb2ludCxcbiAgICAgICAgfSxcbiAgICAgICAgamFlZ2VyOiB7XG4gICAgICAgICAgICBlbmRwb2ludDogcmVzb2x2ZWRPcHRpb25zLmphZWdlckVuZHBvaW50LFxuICAgICAgICAgICAgc2VydmljZTogcmVzb2x2ZWRPcHRpb25zLnRyYWNlU2VydmljZSxcbiAgICAgICAgICAgIHRhZ3M6IHBhcnNlVGFncyhyZXNvbHZlZE9wdGlvbnMudHJhY2VUYWdzKSxcbiAgICAgICAgfSxcbiAgICAgICAgc3RhdHNkOiB7XG4gICAgICAgICAgICBzZXJ2ZXI6IHJlc29sdmVkT3B0aW9ucy5zdGF0c2RTZXJ2ZXIsXG4gICAgICAgICAgICB0YWdzOiAocmVzb2x2ZWRPcHRpb25zLnN0YXRzZFRhZ3MgfHwgJycpLnNwbGl0KCcsJykubWFwKHggPT4geC50cmltKCkpLmZpbHRlcih4ID0+IHgpLFxuICAgICAgICB9LFxuICAgICAgICBtYW1BY2Nlc3NLZXlzOiBuZXcgU2V0KChyZXNvbHZlZE9wdGlvbnMubWFtQWNjZXNzS2V5cyB8fCAnJykuc3BsaXQoJywnKSksXG4gICAgfTtcbn1cblxuY29uc3QgSU5ERVhFUzoge1xuICAgIFtzdHJpbmddOiBzdHJpbmdbXSxcbn0gPSB7XG4gICAgYmxvY2tzOiBbXG4gICAgICAgICdzZXFfbm8sIGdlbl91dGltZScsXG4gICAgICAgICdnZW5fdXRpbWUnLFxuICAgICAgICAnd29ya2NoYWluX2lkLCBzaGFyZCwgc2VxX25vJyxcbiAgICAgICAgJ3dvcmtjaGFpbl9pZCwgc2VxX25vJyxcbiAgICAgICAgJ3dvcmtjaGFpbl9pZCwgZ2VuX3V0aW1lJyxcbiAgICAgICAgJ21hc3Rlci5taW5fc2hhcmRfZ2VuX3V0aW1lJyxcbiAgICBdLFxuICAgIGFjY291bnRzOiBbXG4gICAgICAgICdsYXN0X3RyYW5zX2x0JyxcbiAgICAgICAgJ2JhbGFuY2UnLFxuICAgIF0sXG4gICAgbWVzc2FnZXM6IFtcbiAgICAgICAgJ2Jsb2NrX2lkJyxcbiAgICAgICAgJ3ZhbHVlLCBjcmVhdGVkX2F0JyxcbiAgICAgICAgJ3NyYywgdmFsdWUsIGNyZWF0ZWRfYXQnLFxuICAgICAgICAnZHN0LCB2YWx1ZSwgY3JlYXRlZF9hdCcsXG4gICAgICAgICdzcmMsIGNyZWF0ZWRfYXQnLFxuICAgICAgICAnZHN0LCBjcmVhdGVkX2F0JyxcbiAgICAgICAgJ3NyYywgZHN0LCBjcmVhdGVkX2F0LCBfa2V5JyxcbiAgICAgICAgJ2NyZWF0ZWRfbHQnLFxuICAgICAgICAnY3JlYXRlZF9hdCcsXG4gICAgXSxcbiAgICB0cmFuc2FjdGlvbnM6IFtcbiAgICAgICAgJ2Jsb2NrX2lkJyxcbiAgICAgICAgJ2luX21zZycsXG4gICAgICAgICdvdXRfbXNnc1sqXScsXG4gICAgICAgICdhY2NvdW50X2FkZHIsIG5vdycsXG4gICAgICAgICdub3cnLFxuICAgICAgICAnbHQnLFxuICAgICAgICAnYWNjb3VudF9hZGRyLCBvcmlnX3N0YXR1cywgZW5kX3N0YXR1cycsXG4gICAgICAgICdub3csIGFjY291bnRfYWRkciwgbHQnLFxuICAgIF0sXG4gICAgYmxvY2tzX3NpZ25hdHVyZXM6IFtcbiAgICAgICAgJ3NpZ25hdHVyZXNbKl0ubm9kZV9pZCwgZ2VuX3V0aW1lJyxcbiAgICBdLFxufTtcblxuZXhwb3J0IHR5cGUgSW5kZXhJbmZvID0ge1xuICAgIGZpZWxkczogc3RyaW5nW10sXG59XG5cbmV4cG9ydCB0eXBlIENvbGxlY3Rpb25JbmZvID0ge1xuICAgIG5hbWU6IHN0cmluZyxcbiAgICBpbmRleGVzOiBJbmRleEluZm9bXSxcbn07XG5cbmV4cG9ydCB0eXBlIERiSW5mbyA9IHtcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgY29sbGVjdGlvbnM6IHtcbiAgICAgICAgW3N0cmluZ106IENvbGxlY3Rpb25JbmZvLFxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IEJMT0NLQ0hBSU5fREI6IERiSW5mbyA9IHtcbiAgICBsYXN0VXBkYXRlVGltZTogMCxcbiAgICBuYW1lOiAnYmxvY2tjaGFpbicsXG4gICAgY29sbGVjdGlvbnM6IHt9LFxufTtcblxuT2JqZWN0LmVudHJpZXMoSU5ERVhFUykuZm9yRWFjaCgoW25hbWUsIGluZGV4ZXNdKSA9PiB7XG4gICAgQkxPQ0tDSEFJTl9EQi5jb2xsZWN0aW9uc1tuYW1lXSA9IHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgaW5kZXhlczogWydfa2V5JywgLi4uKGluZGV4ZXM6IGFueSldLm1hcChwYXJzZUluZGV4KSxcbiAgICB9XG59KTtcblxuZXhwb3J0IGNvbnN0IFNUQVRTID0ge1xuICAgIHN0YXJ0OiAnc3RhcnQnLFxuICAgIHByZWZpeDogJ3FzZXJ2ZXIuJyxcbiAgICBkb2M6IHtcbiAgICAgICAgY291bnQ6ICdkb2MuY291bnQnLFxuICAgIH0sXG4gICAgcG9zdDoge1xuICAgICAgICBjb3VudDogJ3Bvc3QuY291bnQnLFxuICAgICAgICBmYWlsZWQ6ICdwb3N0LmZhaWxlZCcsXG4gICAgfSxcbiAgICBxdWVyeToge1xuICAgICAgICBjb3VudDogJ3F1ZXJ5LmNvdW50JyxcbiAgICAgICAgdGltZTogJ3F1ZXJ5LnRpbWUnLFxuICAgICAgICBhY3RpdmU6ICdxdWVyeS5hY3RpdmUnLFxuICAgICAgICBmYWlsZWQ6ICdxdWVyeS5mYWlsZWQnLFxuICAgICAgICBzbG93OiAncXVlcnkuc2xvdycsXG4gICAgfSxcbiAgICBzdWJzY3JpcHRpb246IHtcbiAgICAgICAgYWN0aXZlOiAnc3Vic2NyaXB0aW9uLmFjdGl2ZScsXG4gICAgfSxcbiAgICB3YWl0Rm9yOiB7XG4gICAgICAgIGFjdGl2ZTogJ3dhaXRmb3IuYWN0aXZlJyxcbiAgICB9LFxufTtcblxuIl19