"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ensureProtocol = ensureProtocol;
exports.parseArangoConfig = parseArangoConfig;
exports.parseMemCachedConfig = parseMemCachedConfig;
exports.overrideDefs = overrideDefs;
exports.resolveValues = resolveValues;
exports.createConfig = createConfig;
exports.parseDataConfig = parseDataConfig;
exports.STATS = exports.programOptions = exports.slowQueries = exports.requestsMode = void 0;

var _os = _interopRequireDefault(require("os"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
/*
 * Copyright 2018-2020 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at:
 *
 * http://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 */
const DEFAULT_LISTENER_RESTART_TIMEOUT = 1000;
const DEFAULT_ARANGO_MAX_SOCKETS = 100;
const DEFAULT_SLOW_QUERIES_ARANGO_MAX_SOCKETS = 3;
const requestsMode = {
  kafka: "kafka",
  rest: "rest"
};
exports.requestsMode = requestsMode;
const slowQueries = {
  enable: "enable",
  redirect: "redirect",
  disable: "disable"
};
exports.slowQueries = slowQueries;
const programOptions = {};
exports.programOptions = programOptions;

const toPascal = s => `${s[0].toUpperCase()}${s.substr(1).toLowerCase()}`;

const opt = (option, def, description) => {
  const words = option.split("-");
  const name = `${words[0]}${words.slice(1).map(toPascal).join("")}`;
  const env = `Q_${words.map(x => x.toUpperCase()).join("_")}`;
  programOptions[name] = {
    option: `--${option} <value>`,
    env,
    def,
    description: `${description}${def && ` (default: "${def}")`}`
  };
};

const dataOpt = prefix => {
  const o = name => `${prefix.toLowerCase().split(" ").join("-")}-${name}`;

  const d = text => `${toPascal(prefix)} ${text}`;

  opt(o("mut"), "arangodb", d("mutable db config url"));
  opt(o("hot"), "arangodb", d("hot db config url"));
  opt(o("cold"), "", d("cold db config urls (comma separated)"));
  opt(o("cache"), "", d("cache config url"));
  opt(o("counterparties"), "", d("counterparties db config url"));
};

opt("host", getIp(), "Listening address");
opt("port", "4000", "Listening port");
opt("keep-alive", "60000", "GraphQL keep alive ms");
opt("requests-mode", "kafka", "Requests mode (kafka | rest)");
opt("requests-server", "kafka:9092", "Requests server url");
opt("requests-topic", "requests", "Requests topic name");
opt("requests-max-size", "16383", "Maximum request message size in bytes");
opt("slow-queries", "redirect", "Slow queries handling (enable | redirect | disable)");
dataOpt("data");
dataOpt("slow queries");
opt("auth-endpoint", "", "Auth endpoint");
opt("mam-access-keys", "", "Access keys used to authorize mam endpoint access");
opt("jaeger-endpoint", "", "Jaeger endpoint");
opt("trace-service", "Q Server", "Trace service name");
opt("trace-tags", "", "Additional trace tags (comma separated name=value pairs)");
opt("statsd-server", "", "StatsD server (host:port)");
opt("statsd-tags", "", "Additional StatsD tags (comma separated name=value pairs)");
opt("statsd-reset-interval", "", "Interval in ms between recreations of the StatsD socket");
opt("network-name", "cinet.tonlabs.io", "Define the name of the network q-server is working with");
opt("cache-key-prefix", "Q_", "Prefix string to identify q-server keys in datacache");
opt("endpoints", "", "Alternative endpoints of q-server (comma separated addresses)"); // Stats Schema

const STATS = {
  start: "start",
  prefix: "qserver.",
  doc: {
    count: "doc.count"
  },
  post: {
    count: "post.count",
    failed: "post.failed"
  },
  query: {
    count: "query.count",
    time: "query.time",
    active: "query.active",
    failed: "query.failed",
    slow: "query.slow"
  },
  subscription: {
    count: "subscription.count",
    active: "subscription.active"
  },
  waitFor: {
    active: "waitfor.active"
  }
};
exports.STATS = STATS;

function ensureProtocol(address, defaultProtocol) {
  return /^\w+:\/\//gi.test(address) ? address : `${defaultProtocol}://${address}`;
}

function parseArangoEndpoint(config, defMaxSockets) {
  const lowerCased = config.toLowerCase().trim();
  const hasProtocol = lowerCased.startsWith("http:") || lowerCased.startsWith("https:");
  const url = new URL(hasProtocol ? config : `https://${config}`);
  const protocol = url.protocol || "https:";
  const host = url.port || protocol.toLowerCase() === "https:" ? url.host : `${url.host}:8529`;
  const path = url.pathname !== "/" ? url.pathname : "";

  const param = name => url.searchParams.get(name) || "";

  return {
    server: `${protocol}//${host}${path}`,
    auth: url.username && `${url.username}:${url.password}`,
    name: param("name") || "blockchain",
    maxSockets: Number.parseInt(param("maxSockets")) || defMaxSockets,
    listenerRestartTimeout: Number.parseInt(param("listenerRestartTimeout")) || DEFAULT_LISTENER_RESTART_TIMEOUT
  };
}

function parseArangoEndpointList(config, defMaxSockets) {
  return config.split(",").filter(x => x.trim() !== "").map(x => parseArangoEndpoint(x, defMaxSockets));
}

function parseArangoConfig(config, defMaxSockets) {
  return parseArangoEndpointList(config, defMaxSockets)[0] || parseArangoEndpoint("", defMaxSockets);
}

function parseMemCachedConfig(config) {
  return {
    server: config
  };
}

function overrideDefs(options, defs) {
  const resolved = {};
  Object.entries(options).forEach(([name, value]) => {
    const opt = value;
    resolved[name] = { ...opt,
      def: defs[name] || opt.def
    };
  });
  return resolved;
}

function resolveValues(values, env, def) {
  const resolved = {};
  Object.entries(def).forEach(([name, value]) => {
    const opt = value;
    resolved[name] = values[name] || env[opt.env] || def[name].def;
  });
  return resolved;
}

function createConfig(values, env, def) {
  const resolved = resolveValues(values, env, def);
  const {
    data,
    slowQueriesData,
    networkName,
    cacheKeyPrefix
  } = parseDataConfig(resolved);
  return {
    server: {
      host: resolved.host,
      port: Number.parseInt(resolved.port),
      keepAlive: Number.parseInt(resolved.keepAlive)
    },
    requests: {
      mode: resolved.requestsMode,
      server: resolved.requestsServer,
      topic: resolved.requestsTopic,
      maxSize: Number.parseInt(resolved.requestsMaxSize)
    },
    data,
    slowQueries: resolved.slowQueries,
    slowQueriesData,
    authorization: {
      endpoint: resolved.authEndpoint
    },
    mamAccessKeys: new Set((resolved.mamAccessKeys || "").split(",")),
    jaeger: {
      endpoint: resolved.jaegerEndpoint,
      service: resolved.traceService,
      tags: parseTags(resolved.traceTags)
    },
    statsd: {
      resetInterval: Number.parseInt(resolved.statsdResetInterval) || 0,
      server: resolved.statsdServer,
      tags: (resolved.statsdTags || "").split(",").map(x => x.trim()).filter(x => x)
    },
    networkName,
    cacheKeyPrefix,
    endpoints: (resolved.endpoints || "").split(",").map(x => x.trim()).filter(x => x)
  };
} // Internals


function getIp() {
  const ipv4 = Object.values(_os.default.networkInterfaces()).reduce((acc, x) => acc.concat(x), []).find(x => x.family === "IPv4" && !x.internal);
  return ipv4 && ipv4.address;
}

function parseTags(s) {
  const tags = {};
  s.split(",").forEach(t => {
    const i = t.indexOf("=");

    if (i >= 0) {
      tags[t.substr(0, i)] = t.substr(i + 1);
    } else {
      tags[t] = "";
    }
  });
  return tags;
}

function parseDataConfig(values) {
  function parse(prefix, defMaxSockets) {
    const opt = suffix => values[`${prefix}${suffix}`] || "";

    const mut = parseArangoConfig(opt("Mut"), defMaxSockets);
    const hot = parseArangoConfig(opt("Hot"), defMaxSockets);
    const cold = parseArangoEndpointList(opt("Cold"), defMaxSockets);
    const cache = parseMemCachedConfig(opt("Cache"));
    const counterpartiesOpt = opt("Counterparties");
    const counterparties = counterpartiesOpt ? parseArangoConfig(counterpartiesOpt, defMaxSockets) : mut;
    return {
      mut,
      hot,
      cold,
      cache,
      counterparties
    };
  }

  const {
    networkName,
    cacheKeyPrefix
  } = values;
  return {
    data: parse("data", DEFAULT_ARANGO_MAX_SOCKETS),
    slowQueriesData: parse("slowQueries", DEFAULT_SLOW_QUERIES_ARANGO_MAX_SOCKETS),
    networkName,
    cacheKeyPrefix
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2ZXIvY29uZmlnLmpzIl0sIm5hbWVzIjpbIkRFRkFVTFRfTElTVEVORVJfUkVTVEFSVF9USU1FT1VUIiwiREVGQVVMVF9BUkFOR09fTUFYX1NPQ0tFVFMiLCJERUZBVUxUX1NMT1dfUVVFUklFU19BUkFOR09fTUFYX1NPQ0tFVFMiLCJyZXF1ZXN0c01vZGUiLCJrYWZrYSIsInJlc3QiLCJzbG93UXVlcmllcyIsImVuYWJsZSIsInJlZGlyZWN0IiwiZGlzYWJsZSIsInByb2dyYW1PcHRpb25zIiwidG9QYXNjYWwiLCJzIiwidG9VcHBlckNhc2UiLCJzdWJzdHIiLCJ0b0xvd2VyQ2FzZSIsIm9wdCIsIm9wdGlvbiIsImRlZiIsImRlc2NyaXB0aW9uIiwid29yZHMiLCJzcGxpdCIsIm5hbWUiLCJzbGljZSIsIm1hcCIsImpvaW4iLCJlbnYiLCJ4IiwiZGF0YU9wdCIsInByZWZpeCIsIm8iLCJkIiwidGV4dCIsImdldElwIiwiU1RBVFMiLCJzdGFydCIsImRvYyIsImNvdW50IiwicG9zdCIsImZhaWxlZCIsInF1ZXJ5IiwidGltZSIsImFjdGl2ZSIsInNsb3ciLCJzdWJzY3JpcHRpb24iLCJ3YWl0Rm9yIiwiZW5zdXJlUHJvdG9jb2wiLCJhZGRyZXNzIiwiZGVmYXVsdFByb3RvY29sIiwidGVzdCIsInBhcnNlQXJhbmdvRW5kcG9pbnQiLCJjb25maWciLCJkZWZNYXhTb2NrZXRzIiwibG93ZXJDYXNlZCIsInRyaW0iLCJoYXNQcm90b2NvbCIsInN0YXJ0c1dpdGgiLCJ1cmwiLCJVUkwiLCJwcm90b2NvbCIsImhvc3QiLCJwb3J0IiwicGF0aCIsInBhdGhuYW1lIiwicGFyYW0iLCJzZWFyY2hQYXJhbXMiLCJnZXQiLCJzZXJ2ZXIiLCJhdXRoIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsIm1heFNvY2tldHMiLCJOdW1iZXIiLCJwYXJzZUludCIsImxpc3RlbmVyUmVzdGFydFRpbWVvdXQiLCJwYXJzZUFyYW5nb0VuZHBvaW50TGlzdCIsImZpbHRlciIsInBhcnNlQXJhbmdvQ29uZmlnIiwicGFyc2VNZW1DYWNoZWRDb25maWciLCJvdmVycmlkZURlZnMiLCJvcHRpb25zIiwiZGVmcyIsInJlc29sdmVkIiwiT2JqZWN0IiwiZW50cmllcyIsImZvckVhY2giLCJ2YWx1ZSIsInJlc29sdmVWYWx1ZXMiLCJ2YWx1ZXMiLCJjcmVhdGVDb25maWciLCJkYXRhIiwic2xvd1F1ZXJpZXNEYXRhIiwibmV0d29ya05hbWUiLCJjYWNoZUtleVByZWZpeCIsInBhcnNlRGF0YUNvbmZpZyIsImtlZXBBbGl2ZSIsInJlcXVlc3RzIiwibW9kZSIsInJlcXVlc3RzU2VydmVyIiwidG9waWMiLCJyZXF1ZXN0c1RvcGljIiwibWF4U2l6ZSIsInJlcXVlc3RzTWF4U2l6ZSIsImF1dGhvcml6YXRpb24iLCJlbmRwb2ludCIsImF1dGhFbmRwb2ludCIsIm1hbUFjY2Vzc0tleXMiLCJTZXQiLCJqYWVnZXIiLCJqYWVnZXJFbmRwb2ludCIsInNlcnZpY2UiLCJ0cmFjZVNlcnZpY2UiLCJ0YWdzIiwicGFyc2VUYWdzIiwidHJhY2VUYWdzIiwic3RhdHNkIiwicmVzZXRJbnRlcnZhbCIsInN0YXRzZFJlc2V0SW50ZXJ2YWwiLCJzdGF0c2RTZXJ2ZXIiLCJzdGF0c2RUYWdzIiwiZW5kcG9pbnRzIiwiaXB2NCIsIm9zIiwibmV0d29ya0ludGVyZmFjZXMiLCJyZWR1Y2UiLCJhY2MiLCJjb25jYXQiLCJmaW5kIiwiZmFtaWx5IiwiaW50ZXJuYWwiLCJ0IiwiaSIsImluZGV4T2YiLCJwYXJzZSIsInN1ZmZpeCIsIm11dCIsImhvdCIsImNvbGQiLCJjYWNoZSIsImNvdW50ZXJwYXJ0aWVzT3B0IiwiY291bnRlcnBhcnRpZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBbUJBOzs7O0FBbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBd0VBLE1BQU1BLGdDQUFnQyxHQUFHLElB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SSx1Q0FBaEIsQ0FGbkI7QUFHSDBGLElBQUFBLFdBSEc7QUFJSEMsSUFBQUE7QUFKRyxHQUFQO0FBTUgiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuLypcbiAqIENvcHlyaWdodCAyMDE4LTIwMjAgVE9OIERFViBTT0xVVElPTlMgTFRELlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBTT0ZUV0FSRSBFVkFMVUFUSU9OIExpY2Vuc2UgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxuICogdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlXG4gKiBMaWNlbnNlIGF0OlxuICpcbiAqIGh0dHA6Ly93d3cudG9uLmRldi9saWNlbnNlc1xuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgVE9OIERFViBzb2Z0d2FyZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vLyBAZmxvd1xuXG5pbXBvcnQgb3MgZnJvbSBcIm9zXCI7XG5cbi8vIENvbmZpZyBTY2hlbWFcblxuZXhwb3J0IHR5cGUgUUFyYW5nb0NvbmZpZyA9IHtcbiAgICBzZXJ2ZXI6IHN0cmluZyxcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgYXV0aDogc3RyaW5nLFxuICAgIG1heFNvY2tldHM6IG51bWJlcixcbiAgICBsaXN0ZW5lclJlc3RhcnRUaW1lb3V0OiBudW1iZXI7XG59O1xuXG5leHBvcnQgdHlwZSBRTWVtQ2FjaGVkQ29uZmlnID0ge1xuICAgIHNlcnZlcjogc3RyaW5nLFxufTtcblxuZXhwb3J0IHR5cGUgUURhdGFQcm92aWRlcnNDb25maWcgPSB7XG4gICAgbXV0OiBRQXJhbmdvQ29uZmlnO1xuICAgIGhvdDogUUFyYW5nb0NvbmZpZztcbiAgICBjb2xkOiBRQXJhbmdvQ29uZmlnW107XG4gICAgY2FjaGU6IFFNZW1DYWNoZWRDb25maWc7XG4gICAgY291bnRlcnBhcnRpZXM6IFFBcmFuZ29Db25maWc7XG59O1xuXG5leHBvcnQgdHlwZSBTbG93UXVlcmllc01vZGUgPSBcImVuYWJsZVwiIHwgXCJyZWRpcmVjdFwiIHwgXCJkaXNhYmxlXCI7XG5leHBvcnQgdHlwZSBRQ29uZmlnID0ge1xuICAgIHNlcnZlcjoge1xuICAgICAgICBob3N0OiBzdHJpbmcsXG4gICAgICAgIHBvcnQ6IG51bWJlcixcbiAgICAgICAga2VlcEFsaXZlOiBudW1iZXIsXG4gICAgfSxcbiAgICByZXF1ZXN0czoge1xuICAgICAgICBtb2RlOiBcImthZmthXCIgfCBcInJlc3RcIixcbiAgICAgICAgc2VydmVyOiBzdHJpbmcsXG4gICAgICAgIHRvcGljOiBzdHJpbmcsXG4gICAgICAgIG1heFNpemU6IG51bWJlcixcbiAgICB9LFxuICAgIGRhdGE6IFFEYXRhUHJvdmlkZXJzQ29uZmlnLFxuICAgIHNsb3dRdWVyaWVzOiBTbG93UXVlcmllc01vZGUsXG4gICAgc2xvd1F1ZXJpZXNEYXRhOiBRRGF0YVByb3ZpZGVyc0NvbmZpZyxcbiAgICBhdXRob3JpemF0aW9uOiB7XG4gICAgICAgIGVuZHBvaW50OiBzdHJpbmcsXG4gICAgfSxcbiAgICBqYWVnZXI6IHtcbiAgICAgICAgZW5kcG9pbnQ6IHN0cmluZyxcbiAgICAgICAgc2VydmljZTogc3RyaW5nLFxuICAgICAgICB0YWdzOiB7IFtzdHJpbmddOiBzdHJpbmcgfVxuICAgIH0sXG4gICAgc3RhdHNkOiB7XG4gICAgICAgIHNlcnZlcjogc3RyaW5nLFxuICAgICAgICB0YWdzOiBzdHJpbmdbXSxcbiAgICAgICAgcmVzZXRJbnRlcnZhbDogbnVtYmVyLFxuICAgIH0sXG4gICAgbWFtQWNjZXNzS2V5czogU2V0PHN0cmluZz4sXG4gICAgaXNUZXN0cz86IGJvb2xlYW4sXG4gICAgbmV0d29ya05hbWU6IHN0cmluZyxcbiAgICBjYWNoZUtleVByZWZpeDogc3RyaW5nLFxuICAgIGVuZHBvaW50czogc3RyaW5nW10sXG59XG5cbmV4cG9ydCB0eXBlIFByb2dyYW1PcHRpb24gPSB7XG4gICAgb3B0aW9uOiBzdHJpbmcsXG4gICAgZW52OiBzdHJpbmcsXG4gICAgZGVmOiBzdHJpbmcsXG4gICAgZGVzY3JpcHRpb246IHN0cmluZyxcbn07XG5leHBvcnQgdHlwZSBQcm9ncmFtT3B0aW9ucyA9IHsgW3N0cmluZ106IFByb2dyYW1PcHRpb24gfTtcblxuY29uc3QgREVGQVVMVF9MSVNURU5FUl9SRVNUQVJUX1RJTUVPVVQgPSAxMDAwO1xuY29uc3QgREVGQVVMVF9BUkFOR09fTUFYX1NPQ0tFVFMgPSAxMDA7XG5jb25zdCBERUZBVUxUX1NMT1dfUVVFUklFU19BUkFOR09fTUFYX1NPQ0tFVFMgPSAzO1xuXG5leHBvcnQgY29uc3QgcmVxdWVzdHNNb2RlID0ge1xuICAgIGthZmthOiBcImthZmthXCIsXG4gICAgcmVzdDogXCJyZXN0XCIsXG59O1xuXG5leHBvcnQgY29uc3Qgc2xvd1F1ZXJpZXMgPSB7XG4gICAgZW5hYmxlOiBcImVuYWJsZVwiLFxuICAgIHJlZGlyZWN0OiBcInJlZGlyZWN0XCIsXG4gICAgZGlzYWJsZTogXCJkaXNhYmxlXCIsXG59O1xuXG5leHBvcnQgY29uc3QgcHJvZ3JhbU9wdGlvbnM6IFByb2dyYW1PcHRpb25zID0ge307XG5cbmNvbnN0IHRvUGFzY2FsID0gcyA9PiBgJHtzWzBdLnRvVXBwZXJDYXNlKCl9JHtzLnN1YnN0cigxKS50b0xvd2VyQ2FzZSgpfWA7XG5cbmNvbnN0IG9wdCA9IChvcHRpb246IHN0cmluZywgZGVmOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCB3b3JkcyA9IG9wdGlvbi5zcGxpdChcIi1cIik7XG4gICAgY29uc3QgbmFtZSA9IGAke3dvcmRzWzBdfSR7d29yZHMuc2xpY2UoMSkubWFwKHRvUGFzY2FsKS5qb2luKFwiXCIpfWA7XG4gICAgY29uc3QgZW52ID0gYFFfJHt3b3Jkcy5tYXAoeCA9PiB4LnRvVXBwZXJDYXNlKCkpLmpvaW4oXCJfXCIpfWA7XG4gICAgcHJvZ3JhbU9wdGlvbnNbbmFtZV0gPSB7XG4gICAgICAgIG9wdGlvbjogYC0tJHtvcHRpb259IDx2YWx1ZT5gLFxuICAgICAgICBlbnYsXG4gICAgICAgIGRlZixcbiAgICAgICAgZGVzY3JpcHRpb246IGAke2Rlc2NyaXB0aW9ufSR7ZGVmICYmIGAgKGRlZmF1bHQ6IFwiJHtkZWZ9XCIpYH1gLFxuICAgIH07XG59O1xuXG5jb25zdCBkYXRhT3B0ID0gKHByZWZpeDogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgbyA9IG5hbWUgPT4gYCR7cHJlZml4LnRvTG93ZXJDYXNlKCkuc3BsaXQoXCIgXCIpLmpvaW4oXCItXCIpfS0ke25hbWV9YDtcbiAgICBjb25zdCBkID0gdGV4dCA9PiBgJHt0b1Bhc2NhbChwcmVmaXgpfSAke3RleHR9YDtcblxuICAgIG9wdChvKFwibXV0XCIpLCBcImFyYW5nb2RiXCIsIGQoXCJtdXRhYmxlIGRiIGNvbmZpZyB1cmxcIikpO1xuICAgIG9wdChvKFwiaG90XCIpLCBcImFyYW5nb2RiXCIsIGQoXCJob3QgZGIgY29uZmlnIHVybFwiKSk7XG4gICAgb3B0KG8oXCJjb2xkXCIpLCBcIlwiLCBkKFwiY29sZCBkYiBjb25maWcgdXJscyAoY29tbWEgc2VwYXJhdGVkKVwiKSk7XG4gICAgb3B0KG8oXCJjYWNoZVwiKSwgXCJcIiwgZChcImNhY2hlIGNvbmZpZyB1cmxcIikpO1xuICAgIG9wdChvKFwiY291bnRlcnBhcnRpZXNcIiksIFwiXCIsIGQoXCJjb3VudGVycGFydGllcyBkYiBjb25maWcgdXJsXCIpKTtcbn07XG5cbm9wdChcImhvc3RcIiwgZ2V0SXAoKSwgXCJMaXN0ZW5pbmcgYWRkcmVzc1wiKTtcbm9wdChcInBvcnRcIiwgXCI0MDAwXCIsIFwiTGlzdGVuaW5nIHBvcnRcIik7XG5vcHQoXCJrZWVwLWFsaXZlXCIsIFwiNjAwMDBcIiwgXCJHcmFwaFFMIGtlZXAgYWxpdmUgbXNcIik7XG5cbm9wdChcInJlcXVlc3RzLW1vZGVcIiwgXCJrYWZrYVwiLCBcIlJlcXVlc3RzIG1vZGUgKGthZmthIHwgcmVzdClcIik7XG5vcHQoXCJyZXF1ZXN0cy1zZXJ2ZXJcIiwgXCJrYWZrYTo5MDkyXCIsIFwiUmVxdWVzdHMgc2VydmVyIHVybFwiKTtcbm9wdChcInJlcXVlc3RzLXRvcGljXCIsIFwicmVxdWVzdHNcIiwgXCJSZXF1ZXN0cyB0b3BpYyBuYW1lXCIpO1xub3B0KFwicmVxdWVzdHMtbWF4LXNpemVcIiwgXCIxNjM4M1wiLCBcIk1heGltdW0gcmVxdWVzdCBtZXNzYWdlIHNpemUgaW4gYnl0ZXNcIik7XG5cbm9wdChcInNsb3ctcXVlcmllc1wiLCBcInJlZGlyZWN0XCIsIFwiU2xvdyBxdWVyaWVzIGhhbmRsaW5nIChlbmFibGUgfCByZWRpcmVjdCB8IGRpc2FibGUpXCIpO1xuXG5kYXRhT3B0KFwiZGF0YVwiKTtcbmRhdGFPcHQoXCJzbG93IHF1ZXJpZXNcIik7XG5cbm9wdChcImF1dGgtZW5kcG9pbnRcIiwgXCJcIiwgXCJBdXRoIGVuZHBvaW50XCIpO1xub3B0KFwibWFtLWFjY2Vzcy1rZXlzXCIsIFwiXCIsIFwiQWNjZXNzIGtleXMgdXNlZCB0byBhdXRob3JpemUgbWFtIGVuZHBvaW50IGFjY2Vzc1wiKTtcblxub3B0KFwiamFlZ2VyLWVuZHBvaW50XCIsIFwiXCIsIFwiSmFlZ2VyIGVuZHBvaW50XCIpO1xub3B0KFwidHJhY2Utc2VydmljZVwiLCBcIlEgU2VydmVyXCIsIFwiVHJhY2Ugc2VydmljZSBuYW1lXCIpO1xub3B0KFwidHJhY2UtdGFnc1wiLCBcIlwiLCBcIkFkZGl0aW9uYWwgdHJhY2UgdGFncyAoY29tbWEgc2VwYXJhdGVkIG5hbWU9dmFsdWUgcGFpcnMpXCIpO1xuXG5vcHQoXCJzdGF0c2Qtc2VydmVyXCIsIFwiXCIsIFwiU3RhdHNEIHNlcnZlciAoaG9zdDpwb3J0KVwiKTtcbm9wdChcInN0YXRzZC10YWdzXCIsIFwiXCIsIFwiQWRkaXRpb25hbCBTdGF0c0QgdGFncyAoY29tbWEgc2VwYXJhdGVkIG5hbWU9dmFsdWUgcGFpcnMpXCIpO1xub3B0KFwic3RhdHNkLXJlc2V0LWludGVydmFsXCIsIFwiXCIsIFwiSW50ZXJ2YWwgaW4gbXMgYmV0d2VlbiByZWNyZWF0aW9ucyBvZiB0aGUgU3RhdHNEIHNvY2tldFwiKTtcblxub3B0KFwibmV0d29yay1uYW1lXCIsIFwiY2luZXQudG9ubGFicy5pb1wiLCBcIkRlZmluZSB0aGUgbmFtZSBvZiB0aGUgbmV0d29yayBxLXNlcnZlciBpcyB3b3JraW5nIHdpdGhcIik7XG5cbm9wdChcImNhY2hlLWtleS1wcmVmaXhcIiwgXCJRX1wiLCBcIlByZWZpeCBzdHJpbmcgdG8gaWRlbnRpZnkgcS1zZXJ2ZXIga2V5cyBpbiBkYXRhY2FjaGVcIik7XG5cbm9wdChcImVuZHBvaW50c1wiLCBcIlwiLCBcIkFsdGVybmF0aXZlIGVuZHBvaW50cyBvZiBxLXNlcnZlciAoY29tbWEgc2VwYXJhdGVkIGFkZHJlc3NlcylcIik7XG5cbi8vIFN0YXRzIFNjaGVtYVxuXG5leHBvcnQgY29uc3QgU1RBVFMgPSB7XG4gICAgc3RhcnQ6IFwic3RhcnRcIixcbiAgICBwcmVmaXg6IFwicXNlcnZlci5cIixcbiAgICBkb2M6IHtcbiAgICAgICAgY291bnQ6IFwiZG9jLmNvdW50XCIsXG4gICAgfSxcbiAgICBwb3N0OiB7XG4gICAgICAgIGNvdW50OiBcInBvc3QuY291bnRcIixcbiAgICAgICAgZmFpbGVkOiBcInBvc3QuZmFpbGVkXCIsXG4gICAgfSxcbiAgICBxdWVyeToge1xuICAgICAgICBjb3VudDogXCJxdWVyeS5jb3VudFwiLFxuICAgICAgICB0aW1lOiBcInF1ZXJ5LnRpbWVcIixcbiAgICAgICAgYWN0aXZlOiBcInF1ZXJ5LmFjdGl2ZVwiLFxuICAgICAgICBmYWlsZWQ6IFwicXVlcnkuZmFpbGVkXCIsXG4gICAgICAgIHNsb3c6IFwicXVlcnkuc2xvd1wiLFxuICAgIH0sXG4gICAgc3Vic2NyaXB0aW9uOiB7XG4gICAgICAgIGNvdW50OiBcInN1YnNjcmlwdGlvbi5jb3VudFwiLFxuICAgICAgICBhY3RpdmU6IFwic3Vic2NyaXB0aW9uLmFjdGl2ZVwiLFxuICAgIH0sXG4gICAgd2FpdEZvcjoge1xuICAgICAgICBhY3RpdmU6IFwid2FpdGZvci5hY3RpdmVcIixcbiAgICB9LFxufTtcblxuXG5leHBvcnQgZnVuY3Rpb24gZW5zdXJlUHJvdG9jb2woYWRkcmVzczogc3RyaW5nLCBkZWZhdWx0UHJvdG9jb2w6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIC9eXFx3KzpcXC9cXC8vZ2kudGVzdChhZGRyZXNzKSA/IGFkZHJlc3MgOiBgJHtkZWZhdWx0UHJvdG9jb2x9Oi8vJHthZGRyZXNzfWA7XG59XG5cbmZ1bmN0aW9uIHBhcnNlQXJhbmdvRW5kcG9pbnQoY29uZmlnOiBzdHJpbmcsIGRlZk1heFNvY2tldHM6IG51bWJlcik6IFFBcmFuZ29Db25maWcge1xuICAgIGNvbnN0IGxvd2VyQ2FzZWQgPSBjb25maWcudG9Mb3dlckNhc2UoKS50cmltKCk7XG4gICAgY29uc3QgaGFzUHJvdG9jb2wgPSBsb3dlckNhc2VkLnN0YXJ0c1dpdGgoXCJodHRwOlwiKSB8fCBsb3dlckNhc2VkLnN0YXJ0c1dpdGgoXCJodHRwczpcIik7XG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChoYXNQcm90b2NvbCA/IGNvbmZpZyA6IGBodHRwczovLyR7Y29uZmlnfWApO1xuICAgIGNvbnN0IHByb3RvY29sID0gdXJsLnByb3RvY29sIHx8IFwiaHR0cHM6XCI7XG4gICAgY29uc3QgaG9zdCA9ICh1cmwucG9ydCB8fCBwcm90b2NvbC50b0xvd2VyQ2FzZSgpID09PSBcImh0dHBzOlwiKSA/IHVybC5ob3N0IDogYCR7dXJsLmhvc3R9Ojg1MjlgO1xuICAgIGNvbnN0IHBhdGggPSB1cmwucGF0aG5hbWUgIT09IFwiL1wiID8gdXJsLnBhdGhuYW1lIDogXCJcIjtcbiAgICBjb25zdCBwYXJhbSA9IG5hbWUgPT4gdXJsLnNlYXJjaFBhcmFtcy5nZXQobmFtZSkgfHwgXCJcIjtcbiAgICByZXR1cm4ge1xuICAgICAgICBzZXJ2ZXI6IGAke3Byb3RvY29sfS8vJHtob3N0fSR7cGF0aH1gLFxuICAgICAgICBhdXRoOiB1cmwudXNlcm5hbWUgJiYgYCR7dXJsLnVzZXJuYW1lfToke3VybC5wYXNzd29yZH1gLFxuICAgICAgICBuYW1lOiBwYXJhbShcIm5hbWVcIikgfHwgXCJibG9ja2NoYWluXCIsXG4gICAgICAgIG1heFNvY2tldHM6IE51bWJlci5wYXJzZUludChwYXJhbShcIm1heFNvY2tldHNcIikpIHx8IGRlZk1heFNvY2tldHMsXG4gICAgICAgIGxpc3RlbmVyUmVzdGFydFRpbWVvdXQ6IE51bWJlci5wYXJzZUludChwYXJhbShcImxpc3RlbmVyUmVzdGFydFRpbWVvdXRcIikpIHx8IERFRkFVTFRfTElTVEVORVJfUkVTVEFSVF9USU1FT1VULFxuICAgIH07XG59XG5cbmZ1bmN0aW9uIHBhcnNlQXJhbmdvRW5kcG9pbnRMaXN0KGNvbmZpZzogc3RyaW5nLCBkZWZNYXhTb2NrZXRzOiBudW1iZXIpOiBRQXJhbmdvQ29uZmlnW10ge1xuICAgIHJldHVybiBjb25maWdcbiAgICAgICAgLnNwbGl0KFwiLFwiKVxuICAgICAgICAuZmlsdGVyKHggPT4geC50cmltKCkgIT09IFwiXCIpXG4gICAgICAgIC5tYXAoeCA9PiBwYXJzZUFyYW5nb0VuZHBvaW50KHgsIGRlZk1heFNvY2tldHMpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQXJhbmdvQ29uZmlnKGNvbmZpZzogc3RyaW5nLCBkZWZNYXhTb2NrZXRzOiBudW1iZXIpOiBRQXJhbmdvQ29uZmlnIHtcbiAgICByZXR1cm4gcGFyc2VBcmFuZ29FbmRwb2ludExpc3QoY29uZmlnLCBkZWZNYXhTb2NrZXRzKVswXVxuICAgICAgICB8fCBwYXJzZUFyYW5nb0VuZHBvaW50KFwiXCIsIGRlZk1heFNvY2tldHMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VNZW1DYWNoZWRDb25maWcoY29uZmlnOiBzdHJpbmcpOiBRTWVtQ2FjaGVkQ29uZmlnIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBzZXJ2ZXI6IGNvbmZpZyxcbiAgICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb3ZlcnJpZGVEZWZzKG9wdGlvbnM6IFByb2dyYW1PcHRpb25zLCBkZWZzOiBhbnkpOiBQcm9ncmFtT3B0aW9ucyB7XG4gICAgY29uc3QgcmVzb2x2ZWQgPSB7fTtcbiAgICBPYmplY3QuZW50cmllcyhvcHRpb25zKS5mb3JFYWNoKChbbmFtZSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIGNvbnN0IG9wdCA9ICgodmFsdWU6IGFueSk6IFByb2dyYW1PcHRpb24pO1xuICAgICAgICByZXNvbHZlZFtuYW1lXSA9IHtcbiAgICAgICAgICAgIC4uLm9wdCxcbiAgICAgICAgICAgIGRlZjogZGVmc1tuYW1lXSB8fCBvcHQuZGVmLFxuICAgICAgICB9O1xuICAgIH0pO1xuICAgIHJldHVybiByZXNvbHZlZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVWYWx1ZXModmFsdWVzOiBhbnksIGVudjogYW55LCBkZWY6IFByb2dyYW1PcHRpb25zKTogYW55IHtcbiAgICBjb25zdCByZXNvbHZlZCA9IHt9O1xuICAgIE9iamVjdC5lbnRyaWVzKGRlZikuZm9yRWFjaCgoW25hbWUsIHZhbHVlXSkgPT4ge1xuICAgICAgICBjb25zdCBvcHQgPSAoKHZhbHVlOiBhbnkpOiBQcm9ncmFtT3B0aW9uKTtcbiAgICAgICAgcmVzb2x2ZWRbbmFtZV0gPSB2YWx1ZXNbbmFtZV0gfHwgZW52W29wdC5lbnZdIHx8IGRlZltuYW1lXS5kZWY7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc29sdmVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ29uZmlnKFxuICAgIHZhbHVlczogYW55LFxuICAgIGVudjogYW55LFxuICAgIGRlZjogUHJvZ3JhbU9wdGlvbnMsXG4pOiBRQ29uZmlnIHtcbiAgICBjb25zdCByZXNvbHZlZCA9IHJlc29sdmVWYWx1ZXModmFsdWVzLCBlbnYsIGRlZik7XG4gICAgY29uc3QgeyBkYXRhLCBzbG93UXVlcmllc0RhdGEsIG5ldHdvcmtOYW1lLCBjYWNoZUtleVByZWZpeCB9ID0gcGFyc2VEYXRhQ29uZmlnKHJlc29sdmVkKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBzZXJ2ZXI6IHtcbiAgICAgICAgICAgIGhvc3Q6IHJlc29sdmVkLmhvc3QsXG4gICAgICAgICAgICBwb3J0OiBOdW1iZXIucGFyc2VJbnQocmVzb2x2ZWQucG9ydCksXG4gICAgICAgICAgICBrZWVwQWxpdmU6IE51bWJlci5wYXJzZUludChyZXNvbHZlZC5rZWVwQWxpdmUpLFxuICAgICAgICB9LFxuICAgICAgICByZXF1ZXN0czoge1xuICAgICAgICAgICAgbW9kZTogcmVzb2x2ZWQucmVxdWVzdHNNb2RlLFxuICAgICAgICAgICAgc2VydmVyOiByZXNvbHZlZC5yZXF1ZXN0c1NlcnZlcixcbiAgICAgICAgICAgIHRvcGljOiByZXNvbHZlZC5yZXF1ZXN0c1RvcGljLFxuICAgICAgICAgICAgbWF4U2l6ZTogTnVtYmVyLnBhcnNlSW50KHJlc29sdmVkLnJlcXVlc3RzTWF4U2l6ZSksXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGEsXG4gICAgICAgIHNsb3dRdWVyaWVzOiByZXNvbHZlZC5zbG93UXVlcmllcyxcbiAgICAgICAgc2xvd1F1ZXJpZXNEYXRhLFxuICAgICAgICBhdXRob3JpemF0aW9uOiB7XG4gICAgICAgICAgICBlbmRwb2ludDogcmVzb2x2ZWQuYXV0aEVuZHBvaW50LFxuICAgICAgICB9LFxuICAgICAgICBtYW1BY2Nlc3NLZXlzOiBuZXcgU2V0KChyZXNvbHZlZC5tYW1BY2Nlc3NLZXlzIHx8IFwiXCIpLnNwbGl0KFwiLFwiKSksXG4gICAgICAgIGphZWdlcjoge1xuICAgICAgICAgICAgZW5kcG9pbnQ6IHJlc29sdmVkLmphZWdlckVuZHBvaW50LFxuICAgICAgICAgICAgc2VydmljZTogcmVzb2x2ZWQudHJhY2VTZXJ2aWNlLFxuICAgICAgICAgICAgdGFnczogcGFyc2VUYWdzKHJlc29sdmVkLnRyYWNlVGFncyksXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXRzZDoge1xuICAgICAgICAgICAgcmVzZXRJbnRlcnZhbDogTnVtYmVyLnBhcnNlSW50KHJlc29sdmVkLnN0YXRzZFJlc2V0SW50ZXJ2YWwpIHx8IDAsXG4gICAgICAgICAgICBzZXJ2ZXI6IHJlc29sdmVkLnN0YXRzZFNlcnZlcixcbiAgICAgICAgICAgIHRhZ3M6IChyZXNvbHZlZC5zdGF0c2RUYWdzIHx8IFwiXCIpLnNwbGl0KFwiLFwiKS5tYXAoeCA9PiB4LnRyaW0oKSkuZmlsdGVyKHggPT4geCksXG4gICAgICAgIH0sXG4gICAgICAgIG5ldHdvcmtOYW1lLFxuICAgICAgICBjYWNoZUtleVByZWZpeCxcbiAgICAgICAgZW5kcG9pbnRzOiAocmVzb2x2ZWQuZW5kcG9pbnRzIHx8IFwiXCIpLnNwbGl0KFwiLFwiKS5tYXAoeCA9PiB4LnRyaW0oKSkuZmlsdGVyKHggPT4geCksXG4gICAgfTtcbn1cblxuLy8gSW50ZXJuYWxzXG5cbmZ1bmN0aW9uIGdldElwKCk6IHN0cmluZyB7XG4gICAgY29uc3QgaXB2NCA9IChPYmplY3QudmFsdWVzKG9zLm5ldHdvcmtJbnRlcmZhY2VzKCkpOiBhbnkpXG4gICAgICAgIC5yZWR1Y2UoKGFjYywgeCkgPT4gYWNjLmNvbmNhdCh4KSwgW10pXG4gICAgICAgIC5maW5kKHggPT4geC5mYW1pbHkgPT09IFwiSVB2NFwiICYmICF4LmludGVybmFsKTtcbiAgICByZXR1cm4gaXB2NCAmJiBpcHY0LmFkZHJlc3M7XG59XG5cblxuZnVuY3Rpb24gcGFyc2VUYWdzKHM6IHN0cmluZyk6IHsgW3N0cmluZ106IHN0cmluZyB9IHtcbiAgICBjb25zdCB0YWdzOiB7IFtzdHJpbmddOiBzdHJpbmcgfSA9IHt9O1xuICAgIHMuc3BsaXQoXCIsXCIpLmZvckVhY2goKHQpID0+IHtcbiAgICAgICAgY29uc3QgaSA9IHQuaW5kZXhPZihcIj1cIik7XG4gICAgICAgIGlmIChpID49IDApIHtcbiAgICAgICAgICAgIHRhZ3NbdC5zdWJzdHIoMCwgaSldID0gdC5zdWJzdHIoaSArIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFnc1t0XSA9IFwiXCI7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gdGFncztcblxufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZURhdGFDb25maWcodmFsdWVzOiBhbnkpOiB7XG4gICAgZGF0YTogUURhdGFQcm92aWRlcnNDb25maWcsXG4gICAgc2xvd1F1ZXJpZXNEYXRhOiBRRGF0YVByb3ZpZGVyc0NvbmZpZyxcbiAgICBuZXR3b3JrTmFtZTogc3RyaW5nLFxuICAgIGNhY2hlS2V5UHJlZml4OiBzdHJpbmcsXG59IHtcbiAgICBmdW5jdGlvbiBwYXJzZShwcmVmaXg6IHN0cmluZywgZGVmTWF4U29ja2V0czogbnVtYmVyKTogUURhdGFQcm92aWRlcnNDb25maWcge1xuICAgICAgICBjb25zdCBvcHQgPSAoc3VmZml4OiBzdHJpbmcpOiBzdHJpbmcgPT4gdmFsdWVzW2Ake3ByZWZpeH0ke3N1ZmZpeH1gXSB8fCBcIlwiO1xuICAgICAgICBjb25zdCBtdXQgPSBwYXJzZUFyYW5nb0NvbmZpZyhvcHQoXCJNdXRcIiksIGRlZk1heFNvY2tldHMpO1xuICAgICAgICBjb25zdCBob3QgPSBwYXJzZUFyYW5nb0NvbmZpZyhvcHQoXCJIb3RcIiksIGRlZk1heFNvY2tldHMpO1xuICAgICAgICBjb25zdCBjb2xkID0gcGFyc2VBcmFuZ29FbmRwb2ludExpc3Qob3B0KFwiQ29sZFwiKSwgZGVmTWF4U29ja2V0cyk7XG4gICAgICAgIGNvbnN0IGNhY2hlID0gcGFyc2VNZW1DYWNoZWRDb25maWcob3B0KFwiQ2FjaGVcIikpO1xuICAgICAgICBjb25zdCBjb3VudGVycGFydGllc09wdCA9IG9wdChcIkNvdW50ZXJwYXJ0aWVzXCIpO1xuICAgICAgICBjb25zdCBjb3VudGVycGFydGllcyA9IGNvdW50ZXJwYXJ0aWVzT3B0XG4gICAgICAgICAgICA/IHBhcnNlQXJhbmdvQ29uZmlnKGNvdW50ZXJwYXJ0aWVzT3B0LCBkZWZNYXhTb2NrZXRzKVxuICAgICAgICAgICAgOiBtdXQ7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtdXQsXG4gICAgICAgICAgICBob3QsXG4gICAgICAgICAgICBjb2xkLFxuICAgICAgICAgICAgY2FjaGUsXG4gICAgICAgICAgICBjb3VudGVycGFydGllcyxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCB7IG5ldHdvcmtOYW1lLCBjYWNoZUtleVByZWZpeCB9ID0gdmFsdWVzO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZGF0YTogcGFyc2UoXCJkYXRhXCIsIERFRkFVTFRfQVJBTkdPX01BWF9TT0NLRVRTKSxcbiAgICAgICAgc2xvd1F1ZXJpZXNEYXRhOiBwYXJzZShcInNsb3dRdWVyaWVzXCIsIERFRkFVTFRfU0xPV19RVUVSSUVTX0FSQU5HT19NQVhfU09DS0VUUyksXG4gICAgICAgIG5ldHdvcmtOYW1lLFxuICAgICAgICBjYWNoZUtleVByZWZpeCxcbiAgICB9O1xufVxuIl19