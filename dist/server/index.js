"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.main = main;

var _server = _interopRequireDefault(require("./server"));

var _logs = _interopRequireDefault(require("./logs"));

var _os = _interopRequireDefault(require("os"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
 * Copyright 2018-2020 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at:
 *
 * http://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 */
const program = require('commander');

function getIp() {
  const ipv4 = Object.values(_os.default.networkInterfaces()).flatMap(x => x).find(x => x.family === 'IPv4' && !x.internal);
  return ipv4 && ipv4.address;
}

program.option('-h, --host <host>', 'listening address', process.env.Q_SERVER_HOST || getIp()).option('-p, --port <port>', 'listening port', process.env.Q_SERVER_PORT || '4000').option('-m, --requests-mode <mode>', 'Requests mode (kafka | rest)', process.env.Q_REQUESTS_MODE || 'kafka').option('-r, --requests-server <url>', 'Requests server url', process.env.Q_REQUESTS_SERVER || 'kafka:9092').option('-t, --requests-topic <name>', 'Requests topic name', process.env.Q_REQUESTS_TOPIC || 'requests').option('-d, --db-server <address>', 'database server:port', process.env.Q_DATABASE_SERVER || 'arangodb:8529').option('-n, --db-name <name>', 'database name', process.env.Q_DATABASE_NAME || 'blockchain').option('-a, --db-auth <name>', 'database auth in form "user:password', process.env.Q_DATABASE_AUTH || '').option('--db-max-sockets <number>', 'database max sockets', process.env.Q_DATABASE_MAX_SOCKETS || '100').option('--slow-db-server <address>', 'slow queries database server:port', process.env.Q_SLOW_DATABASE_SERVER || '').option('--slow-db-name <name>', 'slow database name', process.env.Q_SLOW_DATABASE_NAME || '').option('--slow-db-auth <name>', 'slow database auth in form "user:password', process.env.Q_SLOW_DATABASE_AUTH || '').option('--slow-db-max-sockets <number>', 'slow database max sockets', process.env.Q_SLOW_DATABASE_MAX_SOCKETS || '3').option('--auth-endpoint <url>', 'auth endpoint', process.env.AUTH_ENDPOINT || '').option('--mam-access-keys <keys>', 'Access keys used to authorize mam endpoint access', process.env.MAM_ACCESS_KEYS || '').option('-j, --jaeger-endpoint <url>', 'jaeger endpoint', process.env.JAEGER_ENDPOINT || '').option('--trace-service <name>', 'trace service name', process.env.Q_TRACE_SERVICE || 'Q Server').option('--trace-tags <tags>', 'additional trace tags (comma separated name=value pairs)', process.env.Q_TRACE_TAGS || '').parse(process.argv);
const options = program;

function parseTags(s) {
  const tags = {};
  s.split(',').forEach(t => {
    const i = t.indexOf('=');

    if (i >= 0) {
      tags[t.substr(0, i)] = t.substr(i + 1);
    } else {
      tags[t] = '';
    }
  });
  return tags;
}

const config = {
  server: {
    host: options.host,
    port: Number.parseInt(options.port)
  },
  requests: {
    mode: options.requestsMode,
    server: options.requestsServer,
    topic: options.requestsTopic
  },
  database: {
    server: options.dbServer,
    name: options.dbName,
    auth: options.dbAuth,
    maxSockets: Number(options.dbMaxSockets)
  },
  slowDatabase: {
    server: options.slowDbServer || options.dbServer,
    name: options.slowDbName || options.dbName,
    auth: options.slowDbAuth || options.dbAuth,
    maxSockets: Number(options.slowDbMaxSockets)
  },
  listener: {
    restartTimeout: 1000
  },
  authorization: {
    endpoint: options.authEndpoint
  },
  jaeger: {
    endpoint: options.jaegerEndpoint,
    service: options.traceService,
    tags: parseTags(options.traceTags)
  },
  mamAccessKeys: new Set((options.mamAccessKeys || '').split(','))
};
const logs = new _logs.default();
const configLog = logs.create('config');
configLog.debug('USE', config);
const server = new _server.default({
  config,
  logs
});

function main() {
  (async () => {
    try {
      await server.start();
    } catch (error) {
      server.log.error('FAILED', 'START', error);
      process.exit(1);
    }
  })();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NlcnZlci9pbmRleC5qcyJdLCJuYW1lcyI6WyJwcm9ncmFtIiwicmVxdWlyZSIsImdldElwIiwiaXB2NCIsIk9iamVjdCIsInZhbHVlcyIsIm9zIiwibmV0d29ya0ludGVyZmFjZXMiLCJmbGF0TWFwIiwieCIsImZpbmQiLCJmYW1pbHkiLCJpbnRlcm5hbCIsImFkZHJlc3MiLCJvcHRpb24iLCJwcm9jZXNzIiwiZW52IiwiUV9TRVJWRVJfSE9TVCIsIlFfU0VSVkVSX1BPUlQiLCJRX1JFUVVFU1RTX01PREUiLCJRX1JFUVVFU1RTX1NFUlZFUiIsIlFfUkVRVUVTVFNfVE9QSUMiLCJRX0RBVEFCQVNFX1NFUlZFUiIsIlFfREFUQUJBU0VfTkFNRSIsIlFfREFUQUJBU0VfQVVUSCIsIlFfREFUQUJBU0VfTUFYX1NPQ0tFVFMiLCJRX1NMT1dfREFUQUJBU0VfU0VSVkVSIiwiUV9TTE9XX0RBVEFCQVNFX05BTUUiLCJRX1NMT1dfREFUQUJBU0VfQVVUSCIsIlFfU0xPV19EQVRBQkFTRV9NQVhfU09DS0VUUyIsIkFVVEhfRU5EUE9JTlQiLCJNQU1fQUNDRVNTX0tFWVMiLCJKQUVHRVJfRU5EUE9JTlQiLCJRX1RSQUNFX1NFUlZJQ0UiLCJRX1RSQUNFX1RBR1MiLCJwYXJzZSIsImFyZ3YiLCJvcHRpb25zIiwicGFyc2VUYWdzIiwicyIsInRhZ3MiLCJzcGxpdCIsImZvckVhY2giLCJ0IiwiaSIsImluZGV4T2YiLCJzdWJzdHIiLCJjb25maWciLCJzZXJ2ZXIiLCJob3N0IiwicG9ydCIsIk51bWJlciIsInBhcnNlSW50IiwicmVxdWVzdHMiLCJtb2RlIiwicmVxdWVzdHNNb2RlIiwicmVxdWVzdHNTZXJ2ZXIiLCJ0b3BpYyIsInJlcXVlc3RzVG9waWMiLCJkYXRhYmFzZSIsImRiU2VydmVyIiwibmFtZSIsImRiTmFtZSIsImF1dGgiLCJkYkF1dGgiLCJtYXhTb2NrZXRzIiwiZGJNYXhTb2NrZXRzIiwic2xvd0RhdGFiYXNlIiwic2xvd0RiU2VydmVyIiwic2xvd0RiTmFtZSIsInNsb3dEYkF1dGgiLCJzbG93RGJNYXhTb2NrZXRzIiwibGlzdGVuZXIiLCJyZXN0YXJ0VGltZW91dCIsImF1dGhvcml6YXRpb24iLCJlbmRwb2ludCIsImF1dGhFbmRwb2ludCIsImphZWdlciIsImphZWdlckVuZHBvaW50Iiwic2VydmljZSIsInRyYWNlU2VydmljZSIsInRyYWNlVGFncyIsIm1hbUFjY2Vzc0tleXMiLCJTZXQiLCJsb2dzIiwiUUxvZ3MiLCJjb25maWdMb2ciLCJjcmVhdGUiLCJkZWJ1ZyIsIlRPTlFTZXJ2ZXIiLCJtYWluIiwic3RhcnQiLCJlcnJvciIsImxvZyIsImV4aXQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFtQkE7O0FBQ0E7O0FBRUE7Ozs7QUF0QkE7Ozs7Ozs7Ozs7Ozs7OztBQXdCQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxXQUFELENBQXZCOztBQUVBLFNBQVNDLEtBQVQsR0FBeUI7QUFDckIsUUFBTUMsSUFBSSxHQUFJQyxNQUFNLENBQUNDLE1BQVAsQ0FBY0MsWUFBR0MsaUJBQUgsRUFBZCxDQUFELENBQ1JDLE9BRFEsQ0FDQUMsQ0FBQyxJQUFJQSxDQURMLEVBRVJDLElBRlEsQ0FFSEQsQ0FBQyxJQUFJQSxDQUFDLENBQUNFLE1BQUYsS0FBYSxNQUFiLElBQXVCLENBQUNGLENBQUMsQ0FBQ0csUUFGNUIsQ0FBYjtBQUdBLFNBQU9ULElBQUksSUFBSUEsSUFBSSxDQUFDVSxPQUFwQjtBQUNIOztBQXVCRGIsT0FBTyxDQUNGYyxNQURMLENBQ1ksbUJBRFosRUFDaUMsbUJBRGpDLEVBRVFDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxhQUFaLElBQTZCZixLQUFLLEVBRjFDLEVBR0tZLE1BSEwsQ0FHWSxtQkFIWixFQUdpQyxnQkFIakMsRUFJUUMsT0FBTyxDQUFDQyxHQUFSLENBQVlFLGFBQVosSUFBNkIsTUFKckMsRUFNS0osTUFOTCxDQU1ZLDRCQU5aLEVBTTBDLDhCQU4xQyxFQU9RQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUcsZUFBWixJ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QUNYQyxJQUFBQSxRQUFRLEVBQUV0QyxPQUFPLENBQUN1QztBQURQLEdBekJLO0FBNEJwQkMsRUFBQUEsTUFBTSxFQUFFO0FBQ0pGLElBQUFBLFFBQVEsRUFBRXRDLE9BQU8sQ0FBQ3lDLGNBRGQ7QUFFSkMsSUFBQUEsT0FBTyxFQUFFMUMsT0FBTyxDQUFDMkMsWUFGYjtBQUdKeEMsSUFBQUEsSUFBSSxFQUFFRixTQUFTLENBQUNELE9BQU8sQ0FBQzRDLFNBQVQ7QUFIWCxHQTVCWTtBQWlDcEJDLEVBQUFBLGFBQWEsRUFBRSxJQUFJQyxHQUFKLENBQVEsQ0FBQzlDLE9BQU8sQ0FBQzZDLGFBQVIsSUFBeUIsRUFBMUIsRUFBOEJ6QyxLQUE5QixDQUFvQyxHQUFwQyxDQUFSO0FBakNLLENBQXhCO0FBb0NBLE1BQU0yQyxJQUFJLEdBQUcsSUFBSUMsYUFBSixFQUFiO0FBQ0EsTUFBTUMsU0FBUyxHQUFHRixJQUFJLENBQUNHLE1BQUwsQ0FBWSxRQUFaLENBQWxCO0FBQ0FELFNBQVMsQ0FBQ0UsS0FBVixDQUFnQixLQUFoQixFQUF1QnpDLE1BQXZCO0FBRUEsTUFBTUMsTUFBTSxHQUFHLElBQUl5QyxlQUFKLENBQWU7QUFDMUIxQyxFQUFBQSxNQUQwQjtBQUUxQnFDLEVBQUFBO0FBRjBCLENBQWYsQ0FBZjs7QUFLTyxTQUFTTSxJQUFULEdBQWdCO0FBQ25CLEdBQUMsWUFBWTtBQUNULFFBQUk7QUFDQSxZQUFNMUMsTUFBTSxDQUFDMkMsS0FBUCxFQUFOO0FBQ0gsS0FGRCxDQUVFLE9BQU9DLEtBQVAsRUFBYztBQUNaNUMsTUFBQUEsTUFBTSxDQUFDNkMsR0FBUCxDQUFXRCxLQUFYLENBQWlCLFFBQWpCLEVBQTJCLE9BQTNCLEVBQW9DQSxLQUFwQztBQUNBN0UsTUFBQUEsT0FBTyxDQUFDK0UsSUFBUixDQUFhLENBQWI7QUFDSDtBQUNKLEdBUEQ7QUFRSCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxOC0yMDIwIFRPTiBERVYgU09MVVRJT05TIExURC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgU09GVFdBUkUgRVZBTFVBVElPTiBMaWNlbnNlICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcbiAqIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZVxuICogTGljZW5zZSBhdDpcbiAqXG4gKiBodHRwOi8vd3d3LnRvbi5kZXYvbGljZW5zZXNcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIFRPTiBERVYgc29mdHdhcmUgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuLy8gQGZsb3dcblxuaW1wb3J0IHR5cGUgeyBRQ29uZmlnIH0gZnJvbSBcIi4vY29uZmlnXCI7XG5pbXBvcnQgVE9OUVNlcnZlciBmcm9tICcuL3NlcnZlcic7XG5pbXBvcnQgUUxvZ3MgZnJvbSAnLi9sb2dzJztcblxuaW1wb3J0IG9zIGZyb20gJ29zJztcblxuY29uc3QgcHJvZ3JhbSA9IHJlcXVpcmUoJ2NvbW1hbmRlcicpO1xuXG5mdW5jdGlvbiBnZXRJcCgpOiBzdHJpbmcge1xuICAgIGNvbnN0IGlwdjQgPSAoT2JqZWN0LnZhbHVlcyhvcy5uZXR3b3JrSW50ZXJmYWNlcygpKTogYW55KVxuICAgICAgICAuZmxhdE1hcCh4ID0+IHgpXG4gICAgICAgIC5maW5kKHggPT4geC5mYW1pbHkgPT09ICdJUHY0JyAmJiAheC5pbnRlcm5hbCk7XG4gICAgcmV0dXJuIGlwdjQgJiYgaXB2NC5hZGRyZXNzO1xufVxuXG50eXBlIFByb2dyYW1PcHRpb25zID0ge1xuICAgIHJlcXVlc3RzTW9kZTogJ2thZmthJyB8ICdyZXN0JyxcbiAgICByZXF1ZXN0c1NlcnZlcjogc3RyaW5nLFxuICAgIHJlcXVlc3RzVG9waWM6IHN0cmluZyxcbiAgICBkYlNlcnZlcjogc3RyaW5nLFxuICAgIGRiTmFtZTogc3RyaW5nLFxuICAgIGRiQXV0aDogc3RyaW5nLFxuICAgIGRiTWF4U29ja2V0czogc3RyaW5nLFxuICAgIHNsb3dEYlNlcnZlcjogc3RyaW5nLFxuICAgIHNsb3dEYk5hbWU6IHN0cmluZyxcbiAgICBzbG93RGJBdXRoOiBzdHJpbmcsXG4gICAgc2xvd0RiTWF4U29ja2V0czogc3RyaW5nLFxuICAgIGhvc3Q6IHN0cmluZyxcbiAgICBwb3J0OiBzdHJpbmcsXG4gICAgamFlZ2VyRW5kcG9pbnQ6IHN0cmluZyxcbiAgICB0cmFjZVNlcnZpY2U6IHN0cmluZyxcbiAgICB0cmFjZVRhZ3M6IHN0cmluZyxcbiAgICBhdXRoRW5kcG9pbnQ6IHN0cmluZyxcbiAgICBtYW1BY2Nlc3NLZXlzOiBzdHJpbmcsXG59XG5cbnByb2dyYW1cbiAgICAub3B0aW9uKCctaCwgLS1ob3N0IDxob3N0PicsICdsaXN0ZW5pbmcgYWRkcmVzcycsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfU0VSVkVSX0hPU1QgfHwgZ2V0SXAoKSlcbiAgICAub3B0aW9uKCctcCwgLS1wb3J0IDxwb3J0PicsICdsaXN0ZW5pbmcgcG9ydCcsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfU0VSVkVSX1BPUlQgfHwgJzQwMDAnKVxuXG4gICAgLm9wdGlvbignLW0sIC0tcmVxdWVzdHMtbW9kZSA8bW9kZT4nLCAnUmVxdWVzdHMgbW9kZSAoa2Fma2EgfCByZXN0KScsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfUkVRVUVTVFNfTU9ERSB8fCAna2Fma2EnKVxuICAgIC5vcHRpb24oJy1yLCAtLXJlcXVlc3RzLXNlcnZlciA8dXJsPicsICdSZXF1ZXN0cyBzZXJ2ZXIgdXJsJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9SRVFVRVNUU19TRVJWRVIgfHwgJ2thZmthOjkwOTInKVxuICAgIC5vcHRpb24oJy10LCAtLXJlcXVlc3RzLXRvcGljIDxuYW1lPicsICdSZXF1ZXN0cyB0b3BpYyBuYW1lJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9SRVFVRVNUU19UT1BJQyB8fCAncmVxdWVzdHMnKVxuXG4gICAgLm9wdGlvbignLWQsIC0tZGItc2VydmVyIDxhZGRyZXNzPicsICdkYXRhYmFzZSBzZXJ2ZXI6cG9ydCcsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfREFUQUJBU0VfU0VSVkVSIHx8ICdhcmFuZ29kYjo4NTI5JylcbiAgICAub3B0aW9uKCctbiwgLS1kYi1uYW1lIDxuYW1lPicsICdkYXRhYmFzZSBuYW1lJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9EQVRBQkFTRV9OQU1FIHx8ICdibG9ja2NoYWluJylcbiAgICAub3B0aW9uKCctYSwgLS1kYi1hdXRoIDxuYW1lPicsICdkYXRhYmFzZSBhdXRoIGluIGZvcm0gXCJ1c2VyOnBhc3N3b3JkJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9EQVRBQkFTRV9BVVRIIHx8ICcnKVxuICAgIC5vcHRpb24oJy0tZGItbWF4LXNvY2tldHMgPG51bWJlcj4nLCAnZGF0YWJhc2UgbWF4IHNvY2tldHMnLFxuICAgICAgICBwcm9jZXNzLmVudi5RX0RBVEFCQVNFX01BWF9TT0NLRVRTIHx8ICcxMDAnKVxuXG4gICAgLm9wdGlvbignLS1zbG93LWRiLXNlcnZlciA8YWRkcmVzcz4nLCAnc2xvdyBxdWVyaWVzIGRhdGFiYXNlIHNlcnZlcjpwb3J0JyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9TTE9XX0RBVEFCQVNFX1NFUlZFUiB8fCAnJylcbiAgICAub3B0aW9uKCctLXNsb3ctZGItbmFtZSA8bmFtZT4nLCAnc2xvdyBkYXRhYmFzZSBuYW1lJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9TTE9XX0RBVEFCQVNFX05BTUUgfHwgJycpXG4gICAgLm9wdGlvbignLS1zbG93LWRiLWF1dGggPG5hbWU+JywgJ3Nsb3cgZGF0YWJhc2UgYXV0aCBpbiBmb3JtIFwidXNlcjpwYXNzd29yZCcsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfU0xPV19EQVRBQkFTRV9BVVRIIHx8ICcnKVxuICAgIC5vcHRpb24oJy0tc2xvdy1kYi1tYXgtc29ja2V0cyA8bnVtYmVyPicsICdzbG93IGRhdGFiYXNlIG1heCBzb2NrZXRzJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9TTE9XX0RBVEFCQVNFX01BWF9TT0NLRVRTIHx8ICczJylcblxuICAgIC5vcHRpb24oJy0tYXV0aC1lbmRwb2ludCA8dXJsPicsICdhdXRoIGVuZHBvaW50JyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuQVVUSF9FTkRQT0lOVCB8fCAnJylcbiAgICAub3B0aW9uKCctLW1hbS1hY2Nlc3Mta2V5cyA8a2V5cz4nLCAnQWNjZXNzIGtleXMgdXNlZCB0byBhdXRob3JpemUgbWFtIGVuZHBvaW50IGFjY2VzcycsXG4gICAgICAgIHByb2Nlc3MuZW52Lk1BTV9BQ0NFU1NfS0VZUyB8fCAnJylcblxuICAgIC5vcHRpb24oJy1qLCAtLWphZWdlci1lbmRwb2ludCA8dXJsPicsICdqYWVnZXIgZW5kcG9pbnQnLFxuICAgICAgICBwcm9jZXNzLmVudi5KQUVHRVJfRU5EUE9JTlQgfHwgJycpXG4gICAgLm9wdGlvbignLS10cmFjZS1zZXJ2aWNlIDxuYW1lPicsICd0cmFjZSBzZXJ2aWNlIG5hbWUnLFxuICAgICAgICBwcm9jZXNzLmVudi5RX1RSQUNFX1NFUlZJQ0UgfHwgJ1EgU2VydmVyJylcbiAgICAub3B0aW9uKCctLXRyYWNlLXRhZ3MgPHRhZ3M+JywgJ2FkZGl0aW9uYWwgdHJhY2UgdGFncyAoY29tbWEgc2VwYXJhdGVkIG5hbWU9dmFsdWUgcGFpcnMpJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9UUkFDRV9UQUdTIHx8ICcnKVxuICAgIC5wYXJzZShwcm9jZXNzLmFyZ3YpO1xuXG5jb25zdCBvcHRpb25zOiBQcm9ncmFtT3B0aW9ucyA9IHByb2dyYW07XG5cbmZ1bmN0aW9uIHBhcnNlVGFncyhzOiBzdHJpbmcpOiB7IFtzdHJpbmddOiBzdHJpbmcgfSB7XG4gICAgY29uc3QgdGFnczogeyBbc3RyaW5nXTogc3RyaW5nIH0gPSB7fTtcbiAgICBzLnNwbGl0KCcsJykuZm9yRWFjaCgodCkgPT4ge1xuICAgICAgICBjb25zdCBpID0gdC5pbmRleE9mKCc9Jyk7XG4gICAgICAgIGlmIChpID49IDApIHtcbiAgICAgICAgICAgIHRhZ3NbdC5zdWJzdHIoMCwgaSldID0gdC5zdWJzdHIoaSArIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFnc1t0XSA9ICcnO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHRhZ3M7XG5cbn1cbmNvbnN0IGNvbmZpZzogUUNvbmZpZyA9IHtcbiAgICBzZXJ2ZXI6IHtcbiAgICAgICAgaG9zdDogb3B0aW9ucy5ob3N0LFxuICAgICAgICBwb3J0OiBOdW1iZXIucGFyc2VJbnQob3B0aW9ucy5wb3J0KSxcbiAgICB9LFxuICAgIHJlcXVlc3RzOiB7XG4gICAgICAgIG1vZGU6IG9wdGlvbnMucmVxdWVzdHNNb2RlLFxuICAgICAgICBzZXJ2ZXI6IG9wdGlvbnMucmVxdWVzdHNTZXJ2ZXIsXG4gICAgICAgIHRvcGljOiBvcHRpb25zLnJlcXVlc3RzVG9waWMsXG4gICAgfSxcbiAgICBkYXRhYmFzZToge1xuICAgICAgICBzZXJ2ZXI6IG9wdGlvbnMuZGJTZXJ2ZXIsXG4gICAgICAgIG5hbWU6IG9wdGlvbnMuZGJOYW1lLFxuICAgICAgICBhdXRoOiBvcHRpb25zLmRiQXV0aCxcbiAgICAgICAgbWF4U29ja2V0czogTnVtYmVyKG9wdGlvbnMuZGJNYXhTb2NrZXRzKSxcbiAgICB9LFxuICAgIHNsb3dEYXRhYmFzZToge1xuICAgICAgICBzZXJ2ZXI6IG9wdGlvbnMuc2xvd0RiU2VydmVyIHx8IG9wdGlvbnMuZGJTZXJ2ZXIsXG4gICAgICAgIG5hbWU6IG9wdGlvbnMuc2xvd0RiTmFtZSB8fCBvcHRpb25zLmRiTmFtZSxcbiAgICAgICAgYXV0aDogb3B0aW9ucy5zbG93RGJBdXRoIHx8IG9wdGlvbnMuZGJBdXRoLFxuICAgICAgICBtYXhTb2NrZXRzOiBOdW1iZXIob3B0aW9ucy5zbG93RGJNYXhTb2NrZXRzKSxcbiAgICB9LFxuICAgIGxpc3RlbmVyOiB7XG4gICAgICAgIHJlc3RhcnRUaW1lb3V0OiAxMDAwXG4gICAgfSxcbiAgICBhdXRob3JpemF0aW9uOiB7XG4gICAgICAgIGVuZHBvaW50OiBvcHRpb25zLmF1dGhFbmRwb2ludCxcbiAgICB9LFxuICAgIGphZWdlcjoge1xuICAgICAgICBlbmRwb2ludDogb3B0aW9ucy5qYWVnZXJFbmRwb2ludCxcbiAgICAgICAgc2VydmljZTogb3B0aW9ucy50cmFjZVNlcnZpY2UsXG4gICAgICAgIHRhZ3M6IHBhcnNlVGFncyhvcHRpb25zLnRyYWNlVGFncyksXG4gICAgfSxcbiAgICBtYW1BY2Nlc3NLZXlzOiBuZXcgU2V0KChvcHRpb25zLm1hbUFjY2Vzc0tleXMgfHwgJycpLnNwbGl0KCcsJykpLFxufTtcblxuY29uc3QgbG9ncyA9IG5ldyBRTG9ncygpO1xuY29uc3QgY29uZmlnTG9nID0gbG9ncy5jcmVhdGUoJ2NvbmZpZycpO1xuY29uZmlnTG9nLmRlYnVnKCdVU0UnLCBjb25maWcpO1xuXG5jb25zdCBzZXJ2ZXIgPSBuZXcgVE9OUVNlcnZlcih7XG4gICAgY29uZmlnLFxuICAgIGxvZ3MsXG59KTtcblxuZXhwb3J0IGZ1bmN0aW9uIG1haW4oKSB7XG4gICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHNlcnZlci5zdGFydCgpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgc2VydmVyLmxvZy5lcnJvcignRkFJTEVEJywgJ1NUQVJUJywgZXJyb3IpO1xuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgICAgICB9XG4gICAgfSkoKTtcbn1cbiJdfQ==