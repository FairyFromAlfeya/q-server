"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.main = main;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _server = _interopRequireDefault(require("./server"));

var _logs = _interopRequireDefault(require("./logs"));

var _os = _interopRequireDefault(require("os"));

/*
 * Copyright 2018-2019 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at:
 *
 * http://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 */
var program = require('commander');

function getIp() {
  var ipv4 = Object.values(_os["default"].networkInterfaces()).flatMap(function (x) {
    return x;
  }).find(function (x) {
    return x.family === 'IPv4' && !x.internal;
  });
  return ipv4 && ipv4.address;
}

program.option('-h, --host <host>', 'listening address', process.env.Q_SERVER_HOST || getIp()).option('-p, --port <port>', 'listening port', process.env.Q_SERVER_PORT || '4000').option('-m, --requests-mode <mode>', 'Requests mode (kafka | rest)', process.env.Q_REQUESTS_MODE || 'kafka').option('-r, --requests-server <url>', 'Requests server url', process.env.Q_REQUESTS_SERVER || 'kafka:9092').option('-t, --requests-topic <name>', 'Requests topic name', process.env.Q_REQUESTS_TOPIC || 'requests').option('-d, --db-server <address>', 'database server:port', process.env.Q_DATABASE_SERVER || 'arangodb:8529').option('-n, --db-name <name>', 'database name', process.env.Q_DATABASE_NAME || 'blockchain').option('-a, --db-auth <name>', 'database auth in form "user:password', process.env.Q_DATABASE_AUTH || '').option('--db-max-sockets <number>', 'database max sockets', process.env.Q_DATABASE_MAX_SOCKETS || '100').option('--slow-db-server <address>', 'slow queries database server:port', process.env.Q_SLOW_DATABASE_SERVER || '').option('--slow-db-name <name>', 'slow database name', process.env.Q_SLOW_DATABASE_NAME || '').option('--slow-db-auth <name>', 'slow database auth in form "user:password', process.env.Q_SLOW_DATABASE_AUTH || '').option('--slow-db-max-sockets <number>', 'slow database max sockets', process.env.Q_SLOW_DATABASE_MAX_SOCKETS || '3').option('-j, --jaeger-endpoint <host>', 'jaeger collector host', process.env.JAEGER_ENDPOINT || '').parse(process.argv);
var options = program;
var config = {
  server: {
    host: options.host,
    port: Number.parseInt(options.port)
  },
  requests: {
    mode: options.requestsMode,
    server: options.requestsServer,
    topic: options.requestsTopic
  },
  database: {
    server: options.dbServer,
    name: options.dbName,
    auth: options.dbAuth,
    maxSockets: Number(options.dbMaxSockets)
  },
  slowDatabase: {
    server: options.slowDbServer || options.dbServer,
    name: options.slowDbName || options.dbName,
    auth: options.slowDbAuth || options.dbAuth,
    maxSockets: Number(options.slowDbMaxSockets)
  },
  listener: {
    restartTimeout: 1000
  },
  jaeger: {
    endpoint: options.jaegerEndpoint
  }
};
var logs = new _logs["default"]();
var configLog = logs.create('config');
configLog.debug('USE', config);
var server = new _server["default"]({
  config: config,
  logs: logs
});

function main() {
  (0, _asyncToGenerator2["default"])(
  /*#__PURE__*/
  _regenerator["default"].mark(function _callee() {
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.prev = 0;
            _context.next = 3;
            return server.start();

          case 3:
            _context.next = 9;
            break;

          case 5:
            _context.prev = 5;
            _context.t0 = _context["catch"](0);
            server.log.error('FAILED', 'START', _context.t0);
            process.exit(1);

          case 9:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, null, [[0, 5]]);
  }))();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NlcnZlci9pbmRleC5qcyJdLCJuYW1lcyI6WyJwcm9ncmFtIiwicmVxdWlyZSIsImdldElwIiwiaXB2NCIsIk9iamVjdCIsInZhbHVlcyIsIm9zIiwibmV0d29ya0ludGVyZmFjZXMiLCJmbGF0TWFwIiwieCIsImZpbmQiLCJmYW1pbHkiLCJpbnRlcm5hbCIsImFkZHJlc3MiLCJvcHRpb24iLCJwcm9jZXNzIiwiZW52IiwiUV9TRVJWRVJfSE9TVCIsIlFfU0VSVkVSX1BPUlQiLCJRX1JFUVVFU1RTX01PREUiLCJRX1JFUVVFU1RTX1NFUlZFUiIsIlFfUkVRVUVTVFNfVE9QSUMiLCJRX0RBVEFCQVNFX1NFUlZFUiIsIlFfREFUQUJBU0VfTkFNRSIsIlFfREFUQUJBU0VfQVVUSCIsIlFfREFUQUJBU0VfTUFYX1NPQ0tFVFMiLCJRX1NMT1dfREFUQUJBU0VfU0VSVkVSIiwiUV9TTE9XX0RBVEFCQVNFX05BTUUiLCJRX1NMT1dfREFUQUJBU0VfQVVUSCIsIlFfU0xPV19EQVRBQkFTRV9NQVhfU09DS0VUUyIsIkpBRUdFUl9FTkRQT0lOVCIsInBhcnNlIiwiYXJndiIsIm9wdGlvbnMiLCJjb25maWciLCJzZXJ2ZXIiLCJob3N0IiwicG9ydCIsIk51bWJlciIsInBhcnNlSW50IiwicmVxdWVzdHMiLCJtb2RlIiwicmVxdWVzdHNNb2RlIiwicmVxdWVzdHNTZXJ2ZXIiLCJ0b3BpYyIsInJlcXVlc3RzVG9waWMiLCJkYXRhYmFzZSIsImRiU2VydmVyIiwibmFtZSIsImRiTmFtZSIsImF1dGgiLCJkYkF1dGgiLCJtYXhTb2NrZXRzIiwiZGJNYXhTb2NrZXRzIiwic2xvd0RhdGFiYXNlIiwic2xvd0RiU2VydmVyIiwic2xvd0RiTmFtZSIsInNsb3dEYkF1dGgiLCJzbG93RGJNYXhTb2NrZXRzIiwibGlzdGVuZXIiLCJyZXN0YXJ0VGltZW91dCIsImphZWdlciIsImVuZHBvaW50IiwiamFlZ2VyRW5kcG9pbnQiLCJsb2dzIiwiUUxvZ3MiLCJjb25maWdMb2ciLCJjcmVhdGUiLCJkZWJ1ZyIsIlRPTlFTZXJ2ZXIiLCJtYWluIiwic3RhcnQiLCJsb2ciLCJlcnJvciIsImV4aXQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFtQkE7O0FBQ0E7O0FBRUE7O0FBdEJBOzs7Ozs7Ozs7Ozs7Ozs7QUF3QkEsSUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsV0FBRCxDQUF2Qjs7QUFFQSxTQUFTQyxLQUFULEdBQXlCO0FBQ3JCLE1BQU1DLElBQUksR0FBSUMsTUFBTSxDQUFDQyxNQUFQLENBQWNDLGVBQUdDLGlCQUFILEVBQWQsQ0FBRCxDQUNSQyxPQURRLENBQ0EsVUFBQUMsQ0FBQztBQUFBLFdBQUlBLENBQUo7QUFBQSxHQURELEVBRVJDLElBRlEsQ0FFSCxVQUFBRCxDQUFDO0FBQUEsV0FBSUEsQ0FBQyxDQUFDRSxNQUFGLEtBQWEsTUFBYixJQUF1QixDQUFDRixDQUFDLENBQUNHLFFBQTlCO0FBQUEsR0FGRSxDQUFiO0FBR0EsU0FBT1QsSUFBSSxJQUFJQSxJQUFJLENBQUNVLE9BQXBCO0FBQ0g7O0FBbUJEYixPQUFPLENBQ0ZjLE1BREwsQ0FDWSxtQkFEWixFQUNpQyxtQkFEakMsRUFFUUMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLGFBQVosSUFBNkJmLEtBQUssRUFGMUMsRUFHS1ksTUFITCxDQUdZLG1CQUhaLEVBR2lDLGdCQUhqQyxFQUlRQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUUsYUFBWixJQUE2QixNQUpyQyxFQU1LSixNQU5MLENBTVksNEJBTlosRUFNMEMsOEJBTjFDLEVBT1FDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRyxlQUFaLElBQStCLE9BUHZDLEVBUUtMLE1BUkwsQ0FRWSw2QkFSWixFQVEyQyxxQkFSM0MsRUFTUUMsT0FBTyxDQUFDQyxHQUFSLENBQVlJLGlCQUFaLElBQWlDLFlBVHpDLEVBVUtOLE1BVkwsQ0FVWSw2QkFWWixFQVUyQyxxQkFWM0MsRUFXUUMsT0FBTyxDQUFDQyxHQUFSLENBQVlLLGdCQUFaLElBQWdDLFVBWHhDLEVBYUtQLE1B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Z0JBQUosRUFBYjtBQUNBLElBQU1DLFNBQVMsR0FBR0YsSUFBSSxDQUFDRyxNQUFMLENBQVksUUFBWixDQUFsQjtBQUNBRCxTQUFTLENBQUNFLEtBQVYsQ0FBZ0IsS0FBaEIsRUFBdUJsQyxNQUF2QjtBQUVBLElBQU1DLE1BQU0sR0FBRyxJQUFJa0Msa0JBQUosQ0FBZTtBQUMxQm5DLEVBQUFBLE1BQU0sRUFBTkEsTUFEMEI7QUFFMUI4QixFQUFBQSxJQUFJLEVBQUpBO0FBRjBCLENBQWYsQ0FBZjs7QUFLTyxTQUFTTSxJQUFULEdBQWdCO0FBQ25CO0FBQUE7QUFBQSwrQkFBQztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLG1CQUVhbkMsTUFBTSxDQUFDb0MsS0FBUCxFQUZiOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUE7QUFJT3BDLFlBQUFBLE1BQU0sQ0FBQ3FDLEdBQVAsQ0FBV0MsS0FBWCxDQUFpQixRQUFqQixFQUEyQixPQUEzQjtBQUNBMUQsWUFBQUEsT0FBTyxDQUFDMkQsSUFBUixDQUFhLENBQWI7O0FBTFA7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsR0FBRDtBQVFIIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE4LTIwMTkgVE9OIERFViBTT0xVVElPTlMgTFRELlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBTT0ZUV0FSRSBFVkFMVUFUSU9OIExpY2Vuc2UgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxuICogdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlXG4gKiBMaWNlbnNlIGF0OlxuICpcbiAqIGh0dHA6Ly93d3cudG9uLmRldi9saWNlbnNlc1xuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgVE9OIERFViBzb2Z0d2FyZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vLyBAZmxvd1xuXG5pbXBvcnQgdHlwZSB7IFFDb25maWcgfSBmcm9tIFwiLi9jb25maWdcIjtcbmltcG9ydCBUT05RU2VydmVyIGZyb20gJy4vc2VydmVyJztcbmltcG9ydCBRTG9ncyBmcm9tICcuL2xvZ3MnO1xuXG5pbXBvcnQgb3MgZnJvbSAnb3MnO1xuXG5jb25zdCBwcm9ncmFtID0gcmVxdWlyZSgnY29tbWFuZGVyJyk7XG5cbmZ1bmN0aW9uIGdldElwKCk6IHN0cmluZyB7XG4gICAgY29uc3QgaXB2NCA9IChPYmplY3QudmFsdWVzKG9zLm5ldHdvcmtJbnRlcmZhY2VzKCkpOiBhbnkpXG4gICAgICAgIC5mbGF0TWFwKHggPT4geClcbiAgICAgICAgLmZpbmQoeCA9PiB4LmZhbWlseSA9PT0gJ0lQdjQnICYmICF4LmludGVybmFsKTtcbiAgICByZXR1cm4gaXB2NCAmJiBpcHY0LmFkZHJlc3M7XG59XG5cbnR5cGUgUHJvZ3JhbU9wdGlvbnMgPSB7XG4gICAgcmVxdWVzdHNNb2RlOiAna2Fma2EnIHwgJ3Jlc3QnLFxuICAgIHJlcXVlc3RzU2VydmVyOiBzdHJpbmcsXG4gICAgcmVxdWVzdHNUb3BpYzogc3RyaW5nLFxuICAgIGRiU2VydmVyOiBzdHJpbmcsXG4gICAgZGJOYW1lOiBzdHJpbmcsXG4gICAgZGJBdXRoOiBzdHJpbmcsXG4gICAgZGJNYXhTb2NrZXRzOiBzdHJpbmcsXG4gICAgc2xvd0RiU2VydmVyOiBzdHJpbmcsXG4gICAgc2xvd0RiTmFtZTogc3RyaW5nLFxuICAgIHNsb3dEYkF1dGg6IHN0cmluZyxcbiAgICBzbG93RGJNYXhTb2NrZXRzOiBzdHJpbmcsXG4gICAgaG9zdDogc3RyaW5nLFxuICAgIHBvcnQ6IHN0cmluZyxcbiAgICBqYWVnZXJFbmRwb2ludDogc3RyaW5nLFxufVxuXG5wcm9ncmFtXG4gICAgLm9wdGlvbignLWgsIC0taG9zdCA8aG9zdD4nLCAnbGlzdGVuaW5nIGFkZHJlc3MnLFxuICAgICAgICBwcm9jZXNzLmVudi5RX1NFUlZFUl9IT1NUIHx8IGdldElwKCkpXG4gICAgLm9wdGlvbignLXAsIC0tcG9ydCA8cG9ydD4nLCAnbGlzdGVuaW5nIHBvcnQnLFxuICAgICAgICBwcm9jZXNzLmVudi5RX1NFUlZFUl9QT1JUIHx8ICc0MDAwJylcblxuICAgIC5vcHRpb24oJy1tLCAtLXJlcXVlc3RzLW1vZGUgPG1vZGU+JywgJ1JlcXVlc3RzIG1vZGUgKGthZmthIHwgcmVzdCknLFxuICAgICAgICBwcm9jZXNzLmVudi5RX1JFUVVFU1RTX01PREUgfHwgJ2thZmthJylcbiAgICAub3B0aW9uKCctciwgLS1yZXF1ZXN0cy1zZXJ2ZXIgPHVybD4nLCAnUmVxdWVzdHMgc2VydmVyIHVybCcsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfUkVRVUVTVFNfU0VSVkVSIHx8ICdrYWZrYTo5MDkyJylcbiAgICAub3B0aW9uKCctdCwgLS1yZXF1ZXN0cy10b3BpYyA8bmFtZT4nLCAnUmVxdWVzdHMgdG9waWMgbmFtZScsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfUkVRVUVTVFNfVE9QSUMgfHwgJ3JlcXVlc3RzJylcblxuICAgIC5vcHRpb24oJy1kLCAtLWRiLXNlcnZlciA8YWRkcmVzcz4nLCAnZGF0YWJhc2Ugc2VydmVyOnBvcnQnLFxuICAgICAgICBwcm9jZXNzLmVudi5RX0RBVEFCQVNFX1NFUlZFUiB8fCAnYXJhbmdvZGI6ODUyOScpXG4gICAgLm9wdGlvbignLW4sIC0tZGItbmFtZSA8bmFtZT4nLCAnZGF0YWJhc2UgbmFtZScsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfREFUQUJBU0VfTkFNRSB8fCAnYmxvY2tjaGFpbicpXG4gICAgLm9wdGlvbignLWEsIC0tZGItYXV0aCA8bmFtZT4nLCAnZGF0YWJhc2UgYXV0aCBpbiBmb3JtIFwidXNlcjpwYXNzd29yZCcsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfREFUQUJBU0VfQVVUSCB8fCAnJylcbiAgICAub3B0aW9uKCctLWRiLW1heC1zb2NrZXRzIDxudW1iZXI+JywgJ2RhdGFiYXNlIG1heCBzb2NrZXRzJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9EQVRBQkFTRV9NQVhfU09DS0VUUyB8fCAnMTAwJylcblxuICAgIC5vcHRpb24oJy0tc2xvdy1kYi1zZXJ2ZXIgPGFkZHJlc3M+JywgJ3Nsb3cgcXVlcmllcyBkYXRhYmFzZSBzZXJ2ZXI6cG9ydCcsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfU0xPV19EQVRBQkFTRV9TRVJWRVIgfHwgJycpXG4gICAgLm9wdGlvbignLS1zbG93LWRiLW5hbWUgPG5hbWU+JywgJ3Nsb3cgZGF0YWJhc2UgbmFtZScsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfU0xPV19EQVRBQkFTRV9OQU1FIHx8ICcnKVxuICAgIC5vcHRpb24oJy0tc2xvdy1kYi1hdXRoIDxuYW1lPicsICdzbG93IGRhdGFiYXNlIGF1dGggaW4gZm9ybSBcInVzZXI6cGFzc3dvcmQnLFxuICAgICAgICBwcm9jZXNzLmVudi5RX1NMT1dfREFUQUJBU0VfQVVUSCB8fCAnJylcbiAgICAub3B0aW9uKCctLXNsb3ctZGItbWF4LXNvY2tldHMgPG51bWJlcj4nLCAnc2xvdyBkYXRhYmFzZSBtYXggc29ja2V0cycsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfU0xPV19EQVRBQkFTRV9NQVhfU09DS0VUUyB8fCAnMycpXG5cbiAgICAub3B0aW9uKCctaiwgLS1qYWVnZXItZW5kcG9pbnQgPGhvc3Q+JywgJ2phZWdlciBjb2xsZWN0b3IgaG9zdCcsXG4gICAgICAgIHByb2Nlc3MuZW52LkpBRUdFUl9FTkRQT0lOVCB8fCAnJylcbiAgICAucGFyc2UocHJvY2Vzcy5hcmd2KTtcblxuY29uc3Qgb3B0aW9uczogUHJvZ3JhbU9wdGlvbnMgPSBwcm9ncmFtO1xuXG5jb25zdCBjb25maWc6IFFDb25maWcgPSB7XG4gICAgc2VydmVyOiB7XG4gICAgICAgIGhvc3Q6IG9wdGlvbnMuaG9zdCxcbiAgICAgICAgcG9ydDogTnVtYmVyLnBhcnNlSW50KG9wdGlvbnMucG9ydCksXG4gICAgfSxcbiAgICByZXF1ZXN0czoge1xuICAgICAgICBtb2RlOiBvcHRpb25zLnJlcXVlc3RzTW9kZSxcbiAgICAgICAgc2VydmVyOiBvcHRpb25zLnJlcXVlc3RzU2VydmVyLFxuICAgICAgICB0b3BpYzogb3B0aW9ucy5yZXF1ZXN0c1RvcGljLFxuICAgIH0sXG4gICAgZGF0YWJhc2U6IHtcbiAgICAgICAgc2VydmVyOiBvcHRpb25zLmRiU2VydmVyLFxuICAgICAgICBuYW1lOiBvcHRpb25zLmRiTmFtZSxcbiAgICAgICAgYXV0aDogb3B0aW9ucy5kYkF1dGgsXG4gICAgICAgIG1heFNvY2tldHM6IE51bWJlcihvcHRpb25zLmRiTWF4U29ja2V0cyksXG4gICAgfSxcbiAgICBzbG93RGF0YWJhc2U6IHtcbiAgICAgICAgc2VydmVyOiBvcHRpb25zLnNsb3dEYlNlcnZlciB8fCBvcHRpb25zLmRiU2VydmVyLFxuICAgICAgICBuYW1lOiBvcHRpb25zLnNsb3dEYk5hbWUgfHwgb3B0aW9ucy5kYk5hbWUsXG4gICAgICAgIGF1dGg6IG9wdGlvbnMuc2xvd0RiQXV0aCB8fCBvcHRpb25zLmRiQXV0aCxcbiAgICAgICAgbWF4U29ja2V0czogTnVtYmVyKG9wdGlvbnMuc2xvd0RiTWF4U29ja2V0cyksXG4gICAgfSxcbiAgICBsaXN0ZW5lcjoge1xuICAgICAgICByZXN0YXJ0VGltZW91dDogMTAwMFxuICAgIH0sXG4gICAgamFlZ2VyOiB7XG4gICAgICAgIGVuZHBvaW50OiBvcHRpb25zLmphZWdlckVuZHBvaW50XG4gICAgfVxufTtcblxuY29uc3QgbG9ncyA9IG5ldyBRTG9ncygpO1xuY29uc3QgY29uZmlnTG9nID0gbG9ncy5jcmVhdGUoJ2NvbmZpZycpO1xuY29uZmlnTG9nLmRlYnVnKCdVU0UnLCBjb25maWcpO1xuXG5jb25zdCBzZXJ2ZXIgPSBuZXcgVE9OUVNlcnZlcih7XG4gICAgY29uZmlnLFxuICAgIGxvZ3MsXG59KTtcblxuZXhwb3J0IGZ1bmN0aW9uIG1haW4oKSB7XG4gICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHNlcnZlci5zdGFydCgpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgc2VydmVyLmxvZy5lcnJvcignRkFJTEVEJywgJ1NUQVJUJywgZXJyb3IpO1xuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgICAgICB9XG4gICAgfSkoKTtcbn1cbiJdfQ==