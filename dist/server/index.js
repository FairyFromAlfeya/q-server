"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.main = main;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _server = _interopRequireDefault(require("./server"));

var _logs = _interopRequireDefault(require("./logs"));

var _os = _interopRequireDefault(require("os"));

/*
 * Copyright 2018-2020 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at:
 *
 * http://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 */
var program = require('commander');

function getIp() {
  var ipv4 = Object.values(_os["default"].networkInterfaces()).flatMap(function (x) {
    return x;
  }).find(function (x) {
    return x.family === 'IPv4' && !x.internal;
  });
  return ipv4 && ipv4.address;
}

program.option('-h, --host <host>', 'listening address', process.env.Q_SERVER_HOST || getIp()).option('-p, --port <port>', 'listening port', process.env.Q_SERVER_PORT || '4000').option('-m, --requests-mode <mode>', 'Requests mode (kafka | rest)', process.env.Q_REQUESTS_MODE || 'kafka').option('-r, --requests-server <url>', 'Requests server url', process.env.Q_REQUESTS_SERVER || 'kafka:9092').option('-t, --requests-topic <name>', 'Requests topic name', process.env.Q_REQUESTS_TOPIC || 'requests').option('-d, --db-server <address>', 'database server:port', process.env.Q_DATABASE_SERVER || 'arangodb:8529').option('-n, --db-name <name>', 'database name', process.env.Q_DATABASE_NAME || 'blockchain').option('-a, --db-auth <name>', 'database auth in form "user:password', process.env.Q_DATABASE_AUTH || '').option('--db-max-sockets <number>', 'database max sockets', process.env.Q_DATABASE_MAX_SOCKETS || '100').option('--slow-db-server <address>', 'slow queries database server:port', process.env.Q_SLOW_DATABASE_SERVER || '').option('--slow-db-name <name>', 'slow database name', process.env.Q_SLOW_DATABASE_NAME || '').option('--slow-db-auth <name>', 'slow database auth in form "user:password', process.env.Q_SLOW_DATABASE_AUTH || '').option('--slow-db-max-sockets <number>', 'slow database max sockets', process.env.Q_SLOW_DATABASE_MAX_SOCKETS || '3').option('--auth-endpoint <url>', 'auth endpoint', process.env.AUTH_ENDPOINT || '').option('-j, --jaeger-endpoint <url>', 'jaeger endpoint', process.env.JAEGER_ENDPOINT || '').parse(process.argv);
var options = program;
var config = {
  server: {
    host: options.host,
    port: Number.parseInt(options.port)
  },
  requests: {
    mode: options.requestsMode,
    server: options.requestsServer,
    topic: options.requestsTopic
  },
  database: {
    server: options.dbServer,
    name: options.dbName,
    auth: options.dbAuth,
    maxSockets: Number(options.dbMaxSockets)
  },
  slowDatabase: {
    server: options.slowDbServer || options.dbServer,
    name: options.slowDbName || options.dbName,
    auth: options.slowDbAuth || options.dbAuth,
    maxSockets: Number(options.slowDbMaxSockets)
  },
  listener: {
    restartTimeout: 1000
  },
  authorization: {
    endpoint: options.authEndpoint
  },
  jaeger: {
    endpoint: options.jaegerEndpoint
  }
};
var logs = new _logs["default"]();
var configLog = logs.create('config');
configLog.debug('USE', config);
var server = new _server["default"]({
  config: config,
  logs: logs
});

function main() {
  (0, _asyncToGenerator2["default"])(
  /*#__PURE__*/
  _regenerator["default"].mark(function _callee() {
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.prev = 0;
            _context.next = 3;
            return server.start();

          case 3:
            _context.next = 9;
            break;

          case 5:
            _context.prev = 5;
            _context.t0 = _context["catch"](0);
            server.log.error('FAILED', 'START', _context.t0);
            process.exit(1);

          case 9:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, null, [[0, 5]]);
  }))();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NlcnZlci9pbmRleC5qcyJdLCJuYW1lcyI6WyJwcm9ncmFtIiwicmVxdWlyZSIsImdldElwIiwiaXB2NCIsIk9iamVjdCIsInZhbHVlcyIsIm9zIiwibmV0d29ya0ludGVyZmFjZXMiLCJmbGF0TWFwIiwieCIsImZpbmQiLCJmYW1pbHkiLCJpbnRlcm5hbCIsImFkZHJlc3MiLCJvcHRpb24iLCJwcm9jZXNzIiwiZW52IiwiUV9TRVJWRVJfSE9TVCIsIlFfU0VSVkVSX1BPUlQiLCJRX1JFUVVFU1RTX01PREUiLCJRX1JFUVVFU1RTX1NFUlZFUiIsIlFfUkVRVUVTVFNfVE9QSUMiLCJRX0RBVEFCQVNFX1NFUlZFUiIsIlFfREFUQUJBU0VfTkFNRSIsIlFfREFUQUJBU0VfQVVUSCIsIlFfREFUQUJBU0VfTUFYX1NPQ0tFVFMiLCJRX1NMT1dfREFUQUJBU0VfU0VSVkVSIiwiUV9TTE9XX0RBVEFCQVNFX05BTUUiLCJRX1NMT1dfREFUQUJBU0VfQVVUSCIsIlFfU0xPV19EQVRBQkFTRV9NQVhfU09DS0VUUyIsIkFVVEhfRU5EUE9JTlQiLCJKQUVHRVJfRU5EUE9JTlQiLCJwYXJzZSIsImFyZ3YiLCJvcHRpb25zIiwiY29uZmlnIiwic2VydmVyIiwiaG9zdCIsInBvcnQiLCJOdW1iZXIiLCJwYXJzZUludCIsInJlcXVlc3RzIiwibW9kZSIsInJlcXVlc3RzTW9kZSIsInJlcXVlc3RzU2VydmVyIiwidG9waWMiLCJyZXF1ZXN0c1RvcGljIiwiZGF0YWJhc2UiLCJkYlNlcnZlciIsIm5hbWUiLCJkYk5hbWUiLCJhdXRoIiwiZGJBdXRoIiwibWF4U29ja2V0cyIsImRiTWF4U29ja2V0cyIsInNsb3dEYXRhYmFzZSIsInNsb3dEYlNlcnZlciIsInNsb3dEYk5hbWUiLCJzbG93RGJBdXRoIiwic2xvd0RiTWF4U29ja2V0cyIsImxpc3RlbmVyIiwicmVzdGFydFRpbWVvdXQiLCJhdXRob3JpemF0aW9uIiwiZW5kcG9pbnQiLCJhdXRoRW5kcG9pbnQiLCJqYWVnZXIiLCJqYWVnZXJFbmRwb2ludCIsImxvZ3MiLCJRTG9ncyIsImNvbmZpZ0xvZyIsImNyZWF0ZSIsImRlYnVnIiwiVE9OUVNlcnZlciIsIm1haW4iLCJzdGFydCIsImxvZyIsImVycm9yIiwiZXhpdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQW1CQTs7QUFDQTs7QUFFQTs7QUF0QkE7Ozs7Ozs7Ozs7Ozs7OztBQXdCQSxJQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxXQUFELENBQXZCOztBQUVBLFNBQVNDLEtBQVQsR0FBeUI7QUFDckIsTUFBTUMsSUFBSSxHQUFJQyxNQUFNLENBQUNDLE1BQVAsQ0FBY0MsZUFBR0MsaUJBQUgsRUFBZCxDQUFELENBQ1JDLE9BRFEsQ0FDQSxVQUFBQyxDQUFDO0FBQUEsV0FBSUEsQ0FBSjtBQUFBLEdBREQsRUFFUkMsSUFGUSxDQUVILFVBQUFELENBQUM7QUFBQSxXQUFJQSxDQUFDLENBQUNFLE1BQUYsS0FBYSxNQUFiLElBQXVCLENBQUNGLENBQUMsQ0FBQ0csUUFBOUI7QUFBQSxHQUZFLENBQWI7QUFHQSxTQUFPVCxJQUFJLElBQUlBLElBQUksQ0FBQ1UsT0FBcEI7QUFDSDs7QUFvQkRiLE9BQU8sQ0FDRmMsTUFETCxDQUNZLG1CQURaLEVBQ2lDLG1CQURqQyxFQUVRQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsYUFBWixJQUE2QmYsS0FBSyxFQUYxQyxFQUdLWSxNQUhMLENBR1ksbUJBSFosRUFHaUMsZ0JBSGpDLEVBSVFDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRSxhQUFaLElBQTZCLE1BSnJDLEVBTUtKLE1BTkwsQ0FNWSw0QkFOWixFQU0wQyw4QkFOMUMsRUFPUUMsT0FBTyxDQUFDQyxHQUFSLENBQVlHLGVBQVosSUFBK0IsT0FQdkMsRUFRS0wsTUFSTCxDQVFZLDZCQVJaLEVBUTJDLHFCQVIzQyxFQVNRQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUksaUJBQVosSUFBaUMsWUFUekMsRUFVS04sTUFWTCxDQVVZLDZCQVZaLEVBVTJDLHFCQVYzQyxFQVdRQyxP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TkMsSUFBQUEsY0FBYyxFQUFFO0FBRFYsR0F0QlU7QUF5QnBCQyxFQUFBQSxhQUFhLEVBQUU7QUFDWEMsSUFBQUEsUUFBUSxFQUFFN0IsT0FBTyxDQUFDOEI7QUFEUCxHQXpCSztBQTRCcEJDLEVBQUFBLE1BQU0sRUFBRTtBQUNKRixJQUFBQSxRQUFRLEVBQUU3QixPQUFPLENBQUNnQztBQURkO0FBNUJZLENBQXhCO0FBaUNBLElBQU1DLElBQUksR0FBRyxJQUFJQyxnQkFBSixFQUFiO0FBQ0EsSUFBTUMsU0FBUyxHQUFHRixJQUFJLENBQUNHLE1BQUwsQ0FBWSxRQUFaLENBQWxCO0FBQ0FELFNBQVMsQ0FBQ0UsS0FBVixDQUFnQixLQUFoQixFQUF1QnBDLE1BQXZCO0FBRUEsSUFBTUMsTUFBTSxHQUFHLElBQUlvQyxrQkFBSixDQUFlO0FBQzFCckMsRUFBQUEsTUFBTSxFQUFOQSxNQUQwQjtBQUUxQmdDLEVBQUFBLElBQUksRUFBSkE7QUFGMEIsQ0FBZixDQUFmOztBQUtPLFNBQVNNLElBQVQsR0FBZ0I7QUFDbkI7QUFBQTtBQUFBLCtCQUFDO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsbUJBRWFyQyxNQUFNLENBQUNzQyxLQUFQLEVBRmI7O0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTtBQUlPdEMsWUFBQUEsTUFBTSxDQUFDdUMsR0FBUCxDQUFXQyxLQUFYLENBQWlCLFFBQWpCLEVBQTJCLE9BQTNCO0FBQ0E3RCxZQUFBQSxPQUFPLENBQUM4RCxJQUFSLENBQWEsQ0FBYjs7QUFMUDtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxHQUFEO0FBUUgiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTgtMjAyMCBUT04gREVWIFNPTFVUSU9OUyBMVEQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIFNPRlRXQVJFIEVWQUxVQVRJT04gTGljZW5zZSAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlXG4gKiB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcbiAqIExpY2Vuc2UgYXQ6XG4gKlxuICogaHR0cDovL3d3dy50b24uZGV2L2xpY2Vuc2VzXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBUT04gREVWIHNvZnR3YXJlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbi8vIEBmbG93XG5cbmltcG9ydCB0eXBlIHsgUUNvbmZpZyB9IGZyb20gXCIuL2NvbmZpZ1wiO1xuaW1wb3J0IFRPTlFTZXJ2ZXIgZnJvbSAnLi9zZXJ2ZXInO1xuaW1wb3J0IFFMb2dzIGZyb20gJy4vbG9ncyc7XG5cbmltcG9ydCBvcyBmcm9tICdvcyc7XG5cbmNvbnN0IHByb2dyYW0gPSByZXF1aXJlKCdjb21tYW5kZXInKTtcblxuZnVuY3Rpb24gZ2V0SXAoKTogc3RyaW5nIHtcbiAgICBjb25zdCBpcHY0ID0gKE9iamVjdC52YWx1ZXMob3MubmV0d29ya0ludGVyZmFjZXMoKSk6IGFueSlcbiAgICAgICAgLmZsYXRNYXAoeCA9PiB4KVxuICAgICAgICAuZmluZCh4ID0+IHguZmFtaWx5ID09PSAnSVB2NCcgJiYgIXguaW50ZXJuYWwpO1xuICAgIHJldHVybiBpcHY0ICYmIGlwdjQuYWRkcmVzcztcbn1cblxudHlwZSBQcm9ncmFtT3B0aW9ucyA9IHtcbiAgICByZXF1ZXN0c01vZGU6ICdrYWZrYScgfCAncmVzdCcsXG4gICAgcmVxdWVzdHNTZXJ2ZXI6IHN0cmluZyxcbiAgICByZXF1ZXN0c1RvcGljOiBzdHJpbmcsXG4gICAgZGJTZXJ2ZXI6IHN0cmluZyxcbiAgICBkYk5hbWU6IHN0cmluZyxcbiAgICBkYkF1dGg6IHN0cmluZyxcbiAgICBkYk1heFNvY2tldHM6IHN0cmluZyxcbiAgICBzbG93RGJTZXJ2ZXI6IHN0cmluZyxcbiAgICBzbG93RGJOYW1lOiBzdHJpbmcsXG4gICAgc2xvd0RiQXV0aDogc3RyaW5nLFxuICAgIHNsb3dEYk1heFNvY2tldHM6IHN0cmluZyxcbiAgICBob3N0OiBzdHJpbmcsXG4gICAgcG9ydDogc3RyaW5nLFxuICAgIGphZWdlckVuZHBvaW50OiBzdHJpbmcsXG4gICAgYXV0aEVuZHBvaW50OiBzdHJpbmcsXG59XG5cbnByb2dyYW1cbiAgICAub3B0aW9uKCctaCwgLS1ob3N0IDxob3N0PicsICdsaXN0ZW5pbmcgYWRkcmVzcycsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfU0VSVkVSX0hPU1QgfHwgZ2V0SXAoKSlcbiAgICAub3B0aW9uKCctcCwgLS1wb3J0IDxwb3J0PicsICdsaXN0ZW5pbmcgcG9ydCcsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfU0VSVkVSX1BPUlQgfHwgJzQwMDAnKVxuXG4gICAgLm9wdGlvbignLW0sIC0tcmVxdWVzdHMtbW9kZSA8bW9kZT4nLCAnUmVxdWVzdHMgbW9kZSAoa2Fma2EgfCByZXN0KScsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfUkVRVUVTVFNfTU9ERSB8fCAna2Fma2EnKVxuICAgIC5vcHRpb24oJy1yLCAtLXJlcXVlc3RzLXNlcnZlciA8dXJsPicsICdSZXF1ZXN0cyBzZXJ2ZXIgdXJsJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9SRVFVRVNUU19TRVJWRVIgfHwgJ2thZmthOjkwOTInKVxuICAgIC5vcHRpb24oJy10LCAtLXJlcXVlc3RzLXRvcGljIDxuYW1lPicsICdSZXF1ZXN0cyB0b3BpYyBuYW1lJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9SRVFVRVNUU19UT1BJQyB8fCAncmVxdWVzdHMnKVxuXG4gICAgLm9wdGlvbignLWQsIC0tZGItc2VydmVyIDxhZGRyZXNzPicsICdkYXRhYmFzZSBzZXJ2ZXI6cG9ydCcsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfREFUQUJBU0VfU0VSVkVSIHx8ICdhcmFuZ29kYjo4NTI5JylcbiAgICAub3B0aW9uKCctbiwgLS1kYi1uYW1lIDxuYW1lPicsICdkYXRhYmFzZSBuYW1lJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9EQVRBQkFTRV9OQU1FIHx8ICdibG9ja2NoYWluJylcbiAgICAub3B0aW9uKCctYSwgLS1kYi1hdXRoIDxuYW1lPicsICdkYXRhYmFzZSBhdXRoIGluIGZvcm0gXCJ1c2VyOnBhc3N3b3JkJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9EQVRBQkFTRV9BVVRIIHx8ICcnKVxuICAgIC5vcHRpb24oJy0tZGItbWF4LXNvY2tldHMgPG51bWJlcj4nLCAnZGF0YWJhc2UgbWF4IHNvY2tldHMnLFxuICAgICAgICBwcm9jZXNzLmVudi5RX0RBVEFCQVNFX01BWF9TT0NLRVRTIHx8ICcxMDAnKVxuXG4gICAgLm9wdGlvbignLS1zbG93LWRiLXNlcnZlciA8YWRkcmVzcz4nLCAnc2xvdyBxdWVyaWVzIGRhdGFiYXNlIHNlcnZlcjpwb3J0JyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9TTE9XX0RBVEFCQVNFX1NFUlZFUiB8fCAnJylcbiAgICAub3B0aW9uKCctLXNsb3ctZGItbmFtZSA8bmFtZT4nLCAnc2xvdyBkYXRhYmFzZSBuYW1lJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9TTE9XX0RBVEFCQVNFX05BTUUgfHwgJycpXG4gICAgLm9wdGlvbignLS1zbG93LWRiLWF1dGggPG5hbWU+JywgJ3Nsb3cgZGF0YWJhc2UgYXV0aCBpbiBmb3JtIFwidXNlcjpwYXNzd29yZCcsXG4gICAgICAgIHByb2Nlc3MuZW52LlFfU0xPV19EQVRBQkFTRV9BVVRIIHx8ICcnKVxuICAgIC5vcHRpb24oJy0tc2xvdy1kYi1tYXgtc29ja2V0cyA8bnVtYmVyPicsICdzbG93IGRhdGFiYXNlIG1heCBzb2NrZXRzJyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuUV9TTE9XX0RBVEFCQVNFX01BWF9TT0NLRVRTIHx8ICczJylcblxuICAgIC5vcHRpb24oJy0tYXV0aC1lbmRwb2ludCA8dXJsPicsICdhdXRoIGVuZHBvaW50JyxcbiAgICAgICAgcHJvY2Vzcy5lbnYuQVVUSF9FTkRQT0lOVCB8fCAnJylcblxuICAgIC5vcHRpb24oJy1qLCAtLWphZWdlci1lbmRwb2ludCA8dXJsPicsICdqYWVnZXIgZW5kcG9pbnQnLFxuICAgICAgICBwcm9jZXNzLmVudi5KQUVHRVJfRU5EUE9JTlQgfHwgJycpXG4gICAgLnBhcnNlKHByb2Nlc3MuYXJndik7XG5cbmNvbnN0IG9wdGlvbnM6IFByb2dyYW1PcHRpb25zID0gcHJvZ3JhbTtcblxuY29uc3QgY29uZmlnOiBRQ29uZmlnID0ge1xuICAgIHNlcnZlcjoge1xuICAgICAgICBob3N0OiBvcHRpb25zLmhvc3QsXG4gICAgICAgIHBvcnQ6IE51bWJlci5wYXJzZUludChvcHRpb25zLnBvcnQpLFxuICAgIH0sXG4gICAgcmVxdWVzdHM6IHtcbiAgICAgICAgbW9kZTogb3B0aW9ucy5yZXF1ZXN0c01vZGUsXG4gICAgICAgIHNlcnZlcjogb3B0aW9ucy5yZXF1ZXN0c1NlcnZlcixcbiAgICAgICAgdG9waWM6IG9wdGlvbnMucmVxdWVzdHNUb3BpYyxcbiAgICB9LFxuICAgIGRhdGFiYXNlOiB7XG4gICAgICAgIHNlcnZlcjogb3B0aW9ucy5kYlNlcnZlcixcbiAgICAgICAgbmFtZTogb3B0aW9ucy5kYk5hbWUsXG4gICAgICAgIGF1dGg6IG9wdGlvbnMuZGJBdXRoLFxuICAgICAgICBtYXhTb2NrZXRzOiBOdW1iZXIob3B0aW9ucy5kYk1heFNvY2tldHMpLFxuICAgIH0sXG4gICAgc2xvd0RhdGFiYXNlOiB7XG4gICAgICAgIHNlcnZlcjogb3B0aW9ucy5zbG93RGJTZXJ2ZXIgfHwgb3B0aW9ucy5kYlNlcnZlcixcbiAgICAgICAgbmFtZTogb3B0aW9ucy5zbG93RGJOYW1lIHx8IG9wdGlvbnMuZGJOYW1lLFxuICAgICAgICBhdXRoOiBvcHRpb25zLnNsb3dEYkF1dGggfHwgb3B0aW9ucy5kYkF1dGgsXG4gICAgICAgIG1heFNvY2tldHM6IE51bWJlcihvcHRpb25zLnNsb3dEYk1heFNvY2tldHMpLFxuICAgIH0sXG4gICAgbGlzdGVuZXI6IHtcbiAgICAgICAgcmVzdGFydFRpbWVvdXQ6IDEwMDBcbiAgICB9LFxuICAgIGF1dGhvcml6YXRpb246IHtcbiAgICAgICAgZW5kcG9pbnQ6IG9wdGlvbnMuYXV0aEVuZHBvaW50LFxuICAgIH0sXG4gICAgamFlZ2VyOiB7XG4gICAgICAgIGVuZHBvaW50OiBvcHRpb25zLmphZWdlckVuZHBvaW50XG4gICAgfVxufTtcblxuY29uc3QgbG9ncyA9IG5ldyBRTG9ncygpO1xuY29uc3QgY29uZmlnTG9nID0gbG9ncy5jcmVhdGUoJ2NvbmZpZycpO1xuY29uZmlnTG9nLmRlYnVnKCdVU0UnLCBjb25maWcpO1xuXG5jb25zdCBzZXJ2ZXIgPSBuZXcgVE9OUVNlcnZlcih7XG4gICAgY29uZmlnLFxuICAgIGxvZ3MsXG59KTtcblxuZXhwb3J0IGZ1bmN0aW9uIG1haW4oKSB7XG4gICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHNlcnZlci5zdGFydCgpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgc2VydmVyLmxvZy5lcnJvcignRkFJTEVEJywgJ1NUQVJUJywgZXJyb3IpO1xuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgICAgICB9XG4gICAgfSkoKTtcbn1cbiJdfQ==