"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.u8enum = u8enum;
exports.isBigInt = isBigInt;
exports.unresolvedType = unresolvedType;
exports.toEnumStyle = toEnumStyle;
exports.stringifyEnumValues = stringifyEnumValues;
exports.getDocMD = getDocMD;
exports.parseDbSchema = parseDbSchema;
exports.scalarTypes = exports.DbTypeCategory = exports.otherCurrencyCollection = exports.OtherCurrency = exports.grams = exports.unixSeconds = exports.u32WithFormatter = exports.u128 = exports.u64 = exports.u32 = exports.u16 = exports.u8 = exports.i32 = exports.i8 = exports.required = exports.withDoc = exports.join = void 0;

var _gen = require("ton-labs-dev-ops/dist/src/gen");

var _schema = require("ton-labs-dev-ops/dist/src/schema");

const {
  ref,
  arrayOf
} = _schema.Def;
const ToStringFormatter = {
  unixMillisecondsToString: 'unixMillisecondsToString',
  unixSecondsToString: 'unixSecondsToString'
};

const join = (refDef, on, refOn, preCondition) => {
  return { ...ref(refDef),
    _: {
      join: {
        on,
        refOn,
        preCondition: preCondition || ''
      }
    }
  };
};

exports.join = join;

const withDoc = (def, doc) => ({ ...def,
  ...(doc ? {
    _doc: doc
  } : {})
});

exports.withDoc = withDoc;

const required = def => def;

exports.required = required;

const uint = (size, doc) => withDoc({
  _int: {
    unsigned: true,
    size
  }
}, doc);

const int = (size, doc) => withDoc({
  _int: {
    unsigned: false,
    size
  }
}, doc);

const i8 = doc => int(8, doc);

exports.i8 = i8;

const i32 = doc => int(32, doc);

exports.i32 = i32;

const u8 = doc => uint(8, doc);

exports.u8 = u8;

const u16 = doc => uint(16, doc);

exports.u16 = u16;

const u32 = doc => uint(32, doc);

exports.u32 = u32;

const u64 = doc => uint(64, doc);

exports.u64 = u64;

const u128 = doc => uint(128, doc);

exports.u128 = u128;

const u256 = doc => uint(256, doc);

const u32WithFormatter = (formatter, doc) => withDoc({
  _int: {
    unsigned: true,
    size: 32
  },
  _: {
    formatter
  }
}, doc);

exports.u32WithFormatter = u32WithFormatter;

const unixSeconds = doc => u32WithFormatter(ToStringFormatter.unixSecondsToString, doc);

exports.unixSeconds = unixSeconds;
const grams = u128;
exports.grams = grams;

function u8enum(name, values) {
  return doc => {
    const valuesDoc = Object.entries(values).map(([name, value]) => {
      return `- ${value} â€“ ${name}`;
    }).join('\n');
    const effectiveDoc = `${doc ? `${doc}\n` : ''}${valuesDoc}`;
    return withDoc({
      _int: {
        unsigned: true,
        size: 8
      },
      _: {
        enum: {
          name,
          values
        }
      }
    }, effectiveDoc);
  };
}

const OtherCurrency = {
  currency: u32(),
  value: u256()
};
exports.OtherCurrency = OtherCurrency;

const otherCurrencyCollection = doc => arrayOf(ref({
  OtherCurrency
}), doc);

exports.otherCurrencyCollection = otherCurrencyCollection;
const DbTypeCategory = {
  unresolved: 'unresolved',
  scalar: 'scalar',
  union: 'union',
  struct: 'struct'
};
exports.DbTypeCategory = DbTypeCategory;

function scalarType(name) {
  return {
    name,
    category: DbTypeCategory.scalar,
    fields: [],
    doc: ''
  };
}

const scalarTypes = {
  int: scalarType('Int'),
  uint64: scalarType('String'),
  uint1024: scalarType('String'),
  float: scalarType('Float'),
  boolean: scalarType('Boolean'),
  string: scalarType('String')
};
exports.scalarTypes = scalarTypes;

function isBigInt(type) {
  return type === scalarTypes.uint1024 || type === scalarTypes.uint64;
}

function unresolvedType(name) {
  return {
    name,
    category: DbTypeCategory.unresolved,
    fields: [],
    doc: ''
  };
}

function toEnumStyle(s) {
  return `${s.substr(0, 1).toUpperCase()}${s.substr(1)}`;
}

function stringifyEnumValues(values) {
  const fields = Object.entries(values).map(([name, value]) => {
    return `${toEnumStyle(name)}: ${value}`;
  });
  return `{ ${fields.join(', ')} }`;
}

function getDocMD(schema) {
  const doc = schema.doc;

  if (!doc) {
    return '';
  }

  if (typeof doc === 'string') {
    return doc;
  }

  if (doc.md) {
    return doc.md;
  }

  return '';
}

function parseDbSchema(schemaDef) {
  const dbTypes = [];
  const enumTypes = new Map();

  function parseDbField(typeName, schemaField) {
    let schemaType = schemaField;
    const field = {
      name: schemaField.name,
      arrayDepth: 0,
      type: scalarTypes.string,
      doc: getDocMD(schemaField)
    };

    while (schemaType.array) {
      field.arrayDepth += 1;
      schemaType = schemaType.array;
    }

    const ex = schemaType._;
    const enumDef = ex && ex.enum || null;

    if (enumDef) {
      field.enumDef = enumDef;
      enumTypes.set(enumDef.name, enumDef);
    }

    const join = ex && ex.join;

    if (join) {
      field.join = join;
    }

    if (ex && ex.formatter) {
      field.formatter = ex.formatter;
    }

    if (schemaType.union || schemaType.struct) {
      field.type = unresolvedType((0, _gen.makeFieldTypeName)(typeName, schemaField.name));
    } else if (schemaType.ref) {
      field.type = unresolvedType(schemaType.ref.name);
    } else if (schemaType.bool) {
      field.type = scalarTypes.boolean;
    } else if (schemaType.int) {
      const unsigned = schemaType.int && schemaType.int.unsigned || false;
      const size = schemaType.int && schemaType.int.size || 32;

      if (unsigned) {
        if (size >= 128) {
          field.type = scalarTypes.uint1024;
        } else if (size >= 64) {
          field.type = scalarTypes.uint64;
        } else if (size >= 32) {
          field.type = scalarTypes.float;
        } else {
          field.type = scalarTypes.int;
        }
      } else {
        if (size > 32) {
          throw new Error(`Integer type with size ${size} bit does not supported`);
        } else {
          field.type = scalarTypes.int;
        }
      }
    } else if (schemaType.float) {
      field.type = scalarTypes.float;
    } else if (schemaType.string) {
      field.type = scalarTypes.string;
    } else {
      field.type = scalarTypes.string;
      console.log('Invalid field type: ', JSON.stringify(schemaType));
      process.exit(1);
    }

    return field;
  }

  function unwrapArrays(type) {
    if (type.array) {
      return unwrapArrays(type.array);
    }

    return type;
  }

  function parseDbType(name, schemaType) {
    const struct = schemaType.union || schemaType.struct;

    if (!struct) {
      console.log(`?? ${name}: ${JSON.stringify(schemaType).substr(0, 200)}`);
      return;
    }

    const type = {
      name,
      category: schemaType.union ? DbTypeCategory.union : DbTypeCategory.struct,
      fields: [],
      collection: schemaType._.collection,
      doc: getDocMD(schemaType)
    };

    if (type.collection) {
      type.fields.push({
        name: 'id',
        arrayDepth: 0,
        type: scalarTypes.string,
        doc: ''
      });
    }

    struct.forEach(field => {
      type.fields.push(parseDbField(name, field));
      const unwrapped = unwrapArrays(field);
      const ownType = unwrapped.struct || unwrapped.union ? unwrapped : null;

      if (ownType) {
        parseDbType((0, _gen.makeFieldTypeName)(name, field.name), ownType);
      }
    });
    dbTypes.push(type);
  }

  const schema = (0, _schema.parseTypeDef)(schemaDef);

  if (schema.class) {
    schema.class.types.forEach(type => {
      parseDbType(type.name, type);
    });
  }

  const unresolved = new Map();
  const resolving = new Set();
  const resolved = new Map();
  const orderedResolved = [];
  dbTypes.forEach(t => unresolved.set(t.name, t));

  const resolveType = type => {
    if (resolved.has(type.name)) {
      return;
    }

    if (resolving.has(type.name)) {
      console.log(`WARNING: Circular reference to type ${type.name}`);
      return;
    }

    resolving.add(type.name);
    type.fields.forEach(field => {
      if (field.type.category === DbTypeCategory.unresolved) {
        let type = resolved.get(field.type.name);

        if (!type) {
          type = unresolved.get(field.type.name);

          if (type) {
            resolveType(type);
          } else {
            console.log(`Referenced type not found: ${field.type.name}`);
            process.exit(1);
          }
        }

        if (type) {
          field.type = type;
        }
      }
    });
    resolving.delete(type.name);
    orderedResolved.push(type);
    unresolved.delete(type.name);
    resolved.set(type.name, type);
  };

  dbTypes.forEach(resolveType);
  return {
    types: orderedResolved,
    enumTypes
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NlcnZlci9zY2hlbWEvZGItc2NoZW1hLXR5cGVzLmpzIl0sIm5hbWVzIjpbInJlZiIsImFycmF5T2YiLCJEZWYiLCJUb1N0cmluZ0Zvcm1hdHRlciIsInVuaXhNaWxsaXNlY29uZHNUb1N0cmluZyIsInVuaXhTZWNvbmRzVG9TdHJpbmciLCJqb2luIiwicmVmRGVmIiwib24iLCJyZWZPbiIsInByZUNvbmRpdGlvbiIsIl8iLCJ3aXRoRG9jIiwiZGVmIiwiZG9jIiwiX2RvYyIsInJlcXVpcmVkIiwidWludCIsInNpemUiLCJfaW50IiwidW5zaWduZWQiLCJpbnQiLCJpOCIsImkzMiIsInU4IiwidTE2IiwidTMyIiwidTY0IiwidTEyOCIsInUyNTYiLCJ1MzJXaXRoRm9ybWF0dGVyIiwiZm9ybWF0dGVyIiwidW5peFNlY29uZHMiLCJncmFtcyIsInU4ZW51bSIsIm5hbWUiLCJ2YWx1ZXMiLCJ2YWx1ZXNEb2MiLCJPYmplY3QiLCJlbnRyaWVzIiwibWFwIiwidmFsdWUiLCJlZmZlY3RpdmVEb2MiLCJlbnVtIiwiT3RoZXJDdXJyZW5jeSIsImN1cnJlbmN5Iiwib3RoZXJDdXJyZW5jeUNvbGxlY3Rpb24iLCJEYlR5cGVDYXRlZ29yeSIsInVucmVzb2x2ZWQiLCJzY2FsYXIiLCJ1bmlvbiIsInN0cnVjdCIsInNjYWxhclR5cGUiLCJjYXRlZ29yeSIsImZpZWxkcyIsInNjYWxhclR5cGVzIiwidWludDY0IiwidWludDEwMjQiLCJmbG9hdCIsImJvb2xlYW4iLCJzdHJpbmciLCJpc0JpZ0ludCIsInR5cGUiLCJ1bnJlc29sdmVkVHlwZSIsInRvRW51bVN0eWxlIiwicyIsInN1YnN0ciIsInRvVXBwZXJDYXNlIiwic3RyaW5naWZ5RW51bVZhbHVlcyIsImdldERvY01EIiwic2NoZW1hIiwibWQiLCJwYXJzZURiU2NoZW1hIiwic2NoZW1hRGVmIiwiZGJUeXBlcyIsImVudW1UeXBlcyIsIk1hcCIsInBhcnNlRGJGaWVsZCIsInR5cGVOYW1lIiwic2NoZW1hRmllbGQiLCJzY2hlbWFUeXBlIiwiZmllbGQiLCJhcnJheURlcHRoIiwiYXJyYXkiLCJleCIsImVudW1EZWYiLCJzZXQiLCJib29sIiwiRXJyb3IiLCJjb25zb2xlIiwibG9nIiwiSlNPTiIsInN0cmluZ2lmeSIsInByb2Nlc3MiLCJleGl0IiwidW53cmFwQXJyYXlzIiwicGFyc2VEYlR5cGUiLCJjb2xsZWN0aW9uIiwicHVzaCIsImZvckVhY2giLCJ1bndyYXBwZWQiLCJvd25UeXBlIiwiY2xhc3MiLCJ0eXBlcyIsInJlc29sdmluZyIsIlNldCIsInJlc29sdmVkIiwib3JkZXJlZFJlc29sdmVkIiwidCIsInJlc29sdmVUeXBlIiwiaGFzIiwiYWRkIiwiZ2V0IiwiZGVsZXRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUNBOztBQUNBOztBQVNBLE1BQU07QUFBRUEsRUFBQUEsR0FBRjtBQUFPQyxFQUFBQTtBQUFQLElBQW1CQyxXQUF6QjtBQUVBLE1BQU1DLGlCQUFpQixHQUFHO0FBQ3RCQyxFQUFBQSx3QkFBd0IsRUFBRSwwQkFESjtBQUV0QkMsRUFBQUEsbUJBQW1CLEVBQUU7QUFGQyxDQUExQjs7QUFRTyxNQUFNQyxJQUFJLEdBQUcsQ0FDaEJDLE1BRGdCLEVBRWhCQyxFQUZnQixFQUdoQkMsS0FIZ0IsRUFJaEJDLFlBSmdCLEtBS047QUFDVixTQUFPLEVBQ0gsR0FBR1YsR0FBRyxDQUFDTyxNQUFELENBREg7QUFFSEksSUFBQUEsQ0FBQyxFQUFFO0FBQ0NMLE1BQUFBLElBQUksRUFBRTtBQUNGRSxRQUFBQSxFQURFO0FBRUZDLFFBQUFBLEtBRkU7QUFHRkMsUUFBQUEsWUFBWSxFQUFHQSxZQUFZLElBQUk7QUFIN0I7QUFEUDtBQUZBLEdBQVA7QUFVSCxDQWhCTTs7OztBQWtCQSxNQUFNRSxPQUFPLEdBQUcsQ0FBQ0MsR0FBRCxFQUFlQyxHQUFmLE1BQWlDLEVBQ3BELEdBQUdELEdBRGlEO0FBRXBELE1BQUlDLEdBQUcsR0FBRztBQUFFQyxJQUFBQSxJQUFJLEVBQUVEO0FBQVIsR0FBSCxHQUFtQixFQUExQjtBQUZvRCxDQUFqQyxDQUFoQjs7OztBQUtBLE1BQU1FLFFBQVEsR0FBSUgsR0FBRCxJQUFrQkEsR0FBbkM7Ozs7QUFFUCxNQUFNSSxJQUFJLEdBQUcsQ0FBQ0MsSUFBRCxFQUFvQkosR0FBcEIsS0FBcUNGLE9BQU8sQ0FBQztBQUN0RE8sRUFBQUEsSUFBSSxFQUFFO0FBQ0ZDLElBQUFBLFFBQVEsRUFBRSxJQURSO0FBRUZGLElBQUFBO0FBRkU7QUFEZ0QsQ0FBRCxFQUt0REosR0FMc0QsQ0FBekQ7O0FBT0EsTUFBTU8sR0FBRyxHQUFHLENBQUNILElBQUQsRUFBb0JKLEdBQXBCLEtBQXFDRixPQUFPLENBQUM7QUFDckRPLEVBQUFBLElBQUksRUFBRTtBQUNGQyxJQUFBQSxRQUFRLEVBQUUsS0FEUjtBQUVGRixJQUFBQTtBQUZFO0FBRCtDLENBQUQsRUFLckRKLEdBTHFELENBQXhEOztBQU9PLE1BQU1RLEVBQUUsR0FBSVIsR0FBRCxJQUFrQk8sR0FBRyxDQUFDLENBQUQsRUFBSVAsR0FBSixDQUFoQzs7OztBQUNBLE1BQU1TLEdBQUcsR0FBSVQsR0FBRCxJQUFrQk8sR0FBRyxDQUFDLEVBQUQsRUFBS1AsR0FBTCxDQUFqQzs7OztBQUNBLE1BQU1VLEVBQUUsR0FBSVYsR0FBRCxJQUFrQkcsSUFBSSxDQUFDLENBQUQsRUFBSUgsR0FBSixDQUFqQzs7OztBQUNBLE1BQU1XLEdBQUcsR0FBSVgsR0FBRCxJQUFrQkcsSUFBSSxDQUFDLEVBQUQsRUFBS0gsR0FBTCxDQUFsQzs7OztBQUNBLE1BQU1ZLEdBQUcsR0FBSVosR0FBRCxJQUFrQkcsSUFBSSxDQUFDLEVBQUQsRUFBS0gsR0FBTCxDQUFsQzs7OztBQUNBLE1BQU1hLEdBQUcsR0FBSWIsR0FBRCxJQUFrQkcsSUFBSSxDQUFDLEVBQUQsRUFBS0gsR0FBTCxDQUFsQzs7OztBQUNBLE1BQU1jLElBQUksR0FBSWQsR0FBRCxJQUFrQkcsSUFBSSxDQUFDLEdBQUQsRUFBTUgsR0FBTixDQUFuQzs7OztBQUNQLE1BQU1lLElBQUksR0FBSWYsR0FBRCxJQUFrQkcsSUFBSSxDQUFDLEdBQUQsRUFBTUgsR0FBTixDQUFuQzs7QUFFTyxNQUFNZ0IsZ0JBQWdCLEdBQUcsQ0FBQ0MsU0FBRCxFQUFtQ2pCLEdBQW5DLEtBQW9ERixPQUFPLENBQUM7QUFDeEZPLEVBQUFBLElBQUksRUFBRTtBQUNGQyxJQUFBQSxRQUFRLEVBQUUsSUFEUjtBQUVGRixJQUFBQSxJQUFJLEVBQUU7QUFGSixHQURrRjtBQUt4RlAsRUFBQUEsQ0FBQyxFQUFFO0FBQ0NvQixJQUFBQTtBQUREO0FBTHFGLENBQUQsRUFReEZqQixHQVJ3RixDQUFwRjs7OztBQVVBLE1BQU1rQixXQUFXLEdBQUlsQixHQUFELElBQWtCZ0IsZ0JBQWdCLENBQUMzQixpQkFBaUIsQ0FBQ0UsbUJBQW5CLEVBQXdDUyxHQUF4QyxDQUF0RDs7O0FBRUEsTUFBTW1CLEtBQUssR0FBR0wsSUFBZDs7O0FBTUEsU0FBU00sTUFBVCxDQUFnQkMsSUFBaEIsRUFBOEJDLE1BQTlCLEVBQXFEO0FBQ3hELFNBQVF0QixHQUFELElBQTJCO0FBQzlCLFVBQU11QixTQUFTLEdBQUdDLE1BQU0sQ0FBQ0MsT0FBUCxDQUFlSCxNQUFmLEVBQXVCSSxHQUF2QixDQUEyQixDQUFDLENBQUNMLElBQUQsRUFBT00sS0FBUCxDQUFELEtBQW1CO0FBQzVELGFBQVEsS0FBS0EsS0FBWSxNQUFLTixJQUFLLEVBQW5DO0FBQ0gsS0FGaUIsRUFFZjdCLElBRmUsQ0FFVixJQUZVLENBQWxCO0FBR0EsVUFBTW9DLFlBQVksR0FBSSxHQUFFNUIsR0FBRyxHQUFJLEdBQUVBLEdBQUksSUFBVixHQUFnQixFQUFHLEdBQUV1QixTQUFVLEVBQTFEO0FBQ0EsV0FBT3pCLE9BQU8sQ0FBQztBQUNYTyxNQUFBQSxJQUFJLEVBQUU7QUFDRkMsUUFBQUEsUUFBUSxFQUFFLElBRFI7QUFFRkYsUUFBQUEsSUFBSSxFQUFFO0FBRkosT0FESztBQUtYUCxNQUFBQSxDQUFDLEVBQUU7QUFDQ2dDLFFBQUFBLElBQUksRUFBRTtBQUNGUixVQUFBQSxJQURFO0FBRUZDLFVBQUFBO0FBRkU7QUFEUDtBQUxRLEtBQUQsRUFXWE0sWUFYVyxDQUFkO0FBWUgsR0FqQkQ7QUFrQkg7O0FBRU0sTUFBTUUsYUFBc0IsR0FBRztBQUNsQ0MsRUFBQUEsUUFBUSxFQUFFbkIsR0FBRyxFQURxQjtBQUVsQ2UsRUFBQUEsS0FBSyxFQUFFWixJQUFJO0FBRnVCLENBQS9COzs7QUFLQSxNQUFNaUIsdUJBQXVCLEdBQUloQyxHQUFELElBQTJCYixPQUFPLENBQUNELEdBQUcsQ0FBQztBQUFFNEMsRUFBQUE7QUFBRixDQUFELENBQUosRUFBeUI5QixHQUF6QixDQUFsRTs7O0FBQ0EsTUFBTWlDLGNBQWMsR0FBRztBQUMxQkMsRUFBQUEsVUFBVSxFQUFFLFlBRGM7QUFFMUJDLEVBQUFBLE1BQU0sRUFBRSxRQUZrQjtBQUcxQkMsRUFBQUEsS0FBSyxFQUFFLE9BSG1CO0FBSTFCQyxFQUFBQSxNQUFNLEVBQUU7QUFKa0IsQ0FBdkI7OztBQW1DUCxTQUFTQyxVQUFULENBQW9CakIsSUFBcEIsRUFBMEM7QUFDdEMsU0FBTztBQUNIQSxJQUFBQSxJQURHO0FBRUhrQixJQUFBQSxRQUFRLEVBQUVOLGNBQWMsQ0FBQ0UsTUFGdEI7QUFHSEssSUFBQUEsTUFBTSxFQUFFLEVBSEw7QUFJSHhDLElBQUFBLEdBQUcsRUFBRTtBQUpGLEdBQVA7QUFNSDs7QUFFTSxNQUFNeUMsV0FBVyxHQUFHO0FBQ3ZCbEMsRUFBQUEsR0FBRyxFQUFFK0IsVUFBVSxDQUFDLEtBQUQsQ0FEUTtBQUV2QkksRUFBQUEsTUFBTSxFQUFFSixVQUFVLENBQUMsUUFBRCxDQUZLO0FBR3ZCSyxFQUFBQSxRQUFRLEVBQUVMLFVBQVUsQ0FBQyxRQUFELENBSEc7QUFJdkJNLEVBQUFBLEtBQUssRUFBRU4sVUFBVSxDQUFDLE9BQUQsQ0FKTTtBQUt2Qk8sRUFBQUEsT0FBTyxFQUFFUCxVQUFVLENBQUMsU0FBRCxDQUxJO0FBTXZCUSxFQUFBQSxNQUFNLEVBQUVSLFVBQVUsQ0FBQyxRQUFEO0FBTkssQ0FBcEI7OztBQVNBLFNBQVNTLFFBQVQsQ0FBa0JDLElBQWxCLEVBQXlDO0FBQzVDLFNBQU9BLElBQUksS0FBS1AsV0FBVyxDQUFDRSxRQUFyQixJQUFpQ0ssSUFBSSxLQUFLUCxXQUFXLENBQUNDLE1BQTdEO0FBQ0g7O0FBRU0sU0FBU08sY0FBVCxDQUF3QjVCLElBQXhCLEVBQThDO0FBQ2pELFNBQU87QUFDSEEsSUFBQUEsSUFERztBQUVIa0IsSUFBQUEsUUFBUSxFQUFFTixjQUFjLENBQUNDLFVBRnRCO0FBR0hNLElBQUFBLE1BQU0sRUFBRSxFQUhMO0FBSUh4QyxJQUFBQSxHQUFHLEVBQUU7QUFKRixHQUFQO0FBTUg7O0FBRU0sU0FBU2tELFdBQVQsQ0FBcUJDLENBQXJCLEVBQXdDO0FBQzNDLFNBQVEsR0FBRUEsQ0FBQyxDQUFDQyxNQUFGLENBQVMsQ0FBVCxFQUFZLENBQVosRUFBZUMsV0FBZixFQUE2QixHQUFFRixDQUFDLENBQUNDLE1BQUYsQ0FBUyxDQUFULENBQVksRUFBckQ7QUFDSDs7QUFFTSxTQUFTRSxtQkFBVCxDQUE2QmhDLE1BQTdCLEVBQW1FO0FBQ3RFLFFBQU1rQixNQUFNLEdBQUdoQixNQUFNLENBQUNDLE9BQVAsQ0FBZUgsTUFBZixFQUF1QkksR0FBdkIsQ0FBMkIsQ0FBQyxDQUFDTCxJQUFELEVBQU9NLEtBQVAsQ0FBRCxLQUFtQjtBQUN6RCxXQUFRLEdBQUV1QixXQUFXLENBQUM3QixJQUFELENBQU8sS0FBS00sS0FBWSxFQUE3QztBQUNILEdBRmMsQ0FBZjtBQUdBLFNBQVEsS0FBSWEsTUFBTSxDQUFDaEQsSUFBUCxDQUFZLElBQVosQ0FBa0IsSUFBOUI7QUFDSDs7QUFFTSxTQUFTK0QsUUFBVCxDQUFrQkMsTUFBbEIsRUFBNkM7QUFDaEQsUUFBTXhELEdBQUcsR0FBR3dELE1BQU0sQ0FBQ3hELEdBQW5COztBQUNBLE1BQUksQ0FBQ0EsR0FBTCxFQUFVO0FBQ04sV0FBTyxFQUFQO0FBQ0g7O0FBQ0QsTUFBSSxPQUFPQSxHQUFQLEtBQWUsUUFBbkIsRUFBNkI7QUFDekIsV0FBT0EsR0FBUDtBQUNIOztBQUNELE1BQUlBLEdBQUcsQ0FBQ3lELEVBQVIsRUFBWTtBQUNSLFdBQVF6RCxHQUFHLENBQUN5RCxFQUFaO0FBQ0g7O0FBQ0QsU0FBTyxFQUFQO0FBQ0g7O0FBT00sU0FBU0MsYUFBVCxDQUF1QkMsU0FBdkIsRUFBcUQ7QUFDeEQsUUFBTUMsT0FBaUIsR0FBRyxFQUExQjtBQUNBLFFBQU1DLFNBQWtDLEdBQUcsSUFBSUMsR0FBSixFQUEzQzs7QUFFQSxXQUFTQyxZQUFULENBQ0lDLFFBREosRUFFSUMsV0FGSixFQUdXO0FBQ1AsUUFBSUMsVUFBVSxHQUFHRCxXQUFqQjtBQUNBLFVBQU1FLEtBQWMsR0FBRztBQUNuQjlDLE1BQUFBLElBQUksRUFBRTRDLFdBQVcsQ0FBQzVDLElBREM7QUFFbkIrQyxNQUFBQSxVQUFVLEVBQUUsQ0FGTztBQUduQnBCLE1BQUFBLElBQUksRUFBRVAsV0FBVyxDQUFDSyxNQUhDO0FBSW5COUMsTUFBQUEsR0FBRyxFQUFFdUQsUUFBUSxDQUFDVSxXQUFEO0FBSk0sS0FBdkI7O0FBTUEsV0FBT0MsVUFBVSxDQUFDRyxLQUFsQixFQUF5QjtBQUNyQkYsTUFBQUEsS0FBSyxDQUFDQyxVQUFOLElBQW9CLENBQXBCO0FBQ0FGLE1BQUFBLFVBQVUsR0FBR0EsVUFBVSxDQUFDRyxLQUF4QjtBQUNIOztBQUNELFVBQU1DLEVBQUUsR0FBSUosVUFBRCxDQUFrQnJFLENBQTdCO0FBQ0EsVUFBTTBFLE9BQW9CLEdBQUlELEVBQUUsSUFBSUEsRUFBRSxDQUFDekMsSUFBVixJQUFtQixJQUFoRDs7QUFDQSxRQUFJMEMsT0FBSixFQUFhO0FBQ1RKLE1BQUFBLEtBQUssQ0FBQ0ksT0FBTixHQUFnQkEsT0FBaEI7QUFDQVYsTUFBQUEsU0FBUyxDQUFDVyxHQUFWLENBQWNELE9BQU8sQ0FBQ2xELElBQXRCLEVBQTRCa0QsT0FBNUI7QUFDSDs7QUFDRCxVQUFNL0UsSUFBSSxHQUFHOEUsRUFBRSxJQUFJQSxFQUFFLENBQUM5RSxJQUF0Qjs7QUFDQSxRQUFJQSxJQUFKLEVBQVU7QUFDTjJFLE1BQUFBLEtBQUssQ0FBQzNFLElBQU4sR0FBYUEsSUFBYjtBQUNIOztBQUNELFFBQUk4RSxFQUFFLElBQUlBLEVBQUUsQ0FBQ3JELFNBQWIsRUFBd0I7QUFDcEJrRCxNQUFBQSxLQUFLLENBQUNsRCxTQUFOLEdBQWtCcUQsRUFBRSxDQUFDckQsU0FBckI7QUFDSDs7QUFDRCxRQUFJaUQsVUFBVSxDQUFDOUIsS0FBWCxJQUFvQjhCLFVBQVUsQ0FBQzdCLE1BQW5DLEVBQTJDO0FBQ3ZDOEIsTUFBQUEsS0FBSyxDQUFDbkIsSUFBTixHQUFhQyxjQUFjLENBQUMsNEJBQWtCZSxRQUFsQixFQUE0QkMsV0FBVyxDQUFDNUMsSUFBeEMsQ0FBRCxDQUEzQjtBQUNILEtBRkQsTUFFTyxJQUFJNkMsVUFBVSxDQUFDaEYsR0FBZixFQUFvQjtBQUN2QmlGLE1BQUFBLEtBQUssQ0FBQ25CLElBQU4sR0FBYUMsY0FBYyxDQUFDaUIsVUFBVSxDQUFDaEYsR0FBWCxDQUFlbUMsSUFBaEIsQ0FBM0I7QUFDSCxLQUZNLE1BRUEsSUFBSTZDLFVBQVUsQ0FBQ08sSUFBZixFQUFxQjtBQUN4Qk4sTUFBQUEsS0FBSyxDQUFDbkIsSUFBTixHQUFhUCxXQUFXLENBQUNJLE9BQXpCO0FBQ0gsS0FGTSxNQUVBLElBQUlxQixVQUFVLENBQUMzRCxHQUFmLEVBQW9CO0FBQ3ZCLFlBQU1ELFFBQWlCLEdBQUk0RCxVQUFVLENBQUMzRCxHQUFYLElBQWtCMkQsVUFBVSxDQUFDM0QsR0FBWCxDQUFlRCxRQUFsQyxJQUErQyxLQUF6RTtBQUNBLFlBQU1GLElBQVksR0FBSThELFVBQVUsQ0FBQzNELEdBQVgsSUFBa0IyRCxVQUFVLENBQUMzRCxHQUFYLENBQWVILElBQWxDLElBQTJDLEVBQWhFOztBQUNBLFVBQUlFLFFBQUosRUFBYztBQUNWLFlBQUlGLElBQUksSUFBSSxHQUFaLEVBQWlCO0FBQ2IrRCxVQUFBQSxLQUFLLENBQUNuQixJQUFOLEdBQWFQLFdBQVcsQ0FBQ0UsUUFBekI7QUFDSCxTQUZELE1BRU8sSUFBSXZDLElBQUksSUFBSSxFQUFaLEVBQWdCO0FBQ25CK0QsVUFBQUEsS0FBSyxDQUFDbkIsSUFBTixHQUFhUCxXQUFXLENBQUNDLE1BQXpCO0FBQ0gsU0FGTSxNQUVBLElBQUl0QyxJQUFJLElBQUksRUFBWixFQUFnQjtBQUNuQitELFVBQUFBLEtBQUssQ0FBQ25CLElBQU4sR0FBYVAsV0FBVyxDQUFDRyxLQUF6QjtBQUNILFNBRk0sTUFFQTtBQUNIdUIsVUFBQUEsS0FBSyxDQUFDbkIsSUFBTixHQUFhUCxXQUFXLENBQUNsQyxHQUF6QjtBQUNIO0FBQ0osT0FWRCxNQVVPO0FBQ0gsWUFBSUgsSUFBSSxHQUFHLEVBQVgsRUFBZTtBQUNYLGdCQUFNLElBQUlzRSxLQUFKLENBQVcsMEJBQXlCdEUsSUFBSyx5QkFBekMsQ0FBTjtBQUNILFNBRkQsTUFFTztBQUNIK0QsVUFBQUEsS0FBSyxDQUFDbkIsSUFBTixHQUFhUCxXQUFXLENBQUNsQyxHQUF6QjtBQUNIO0FBQ0o7QUFDSixLQXBCTSxNQW9CQSxJQUFJMkQsVUFBVSxDQUFDdEIsS0FBZixFQUFzQjtBQUN6QnVCLE1BQUFBLEtBQUssQ0FBQ25CLElBQU4sR0FBYVAsV0FBVyxDQUFDRyxLQUF6QjtBQUNILEtBRk0sTUFFQSxJQUFJc0IsVUFBVSxDQUFDcEIsTUFBZixFQUF1QjtBQUMxQnFCLE1BQUFBLEtBQUssQ0FBQ25CLElBQU4sR0FBYVAsV0FBVyxDQUFDSyxNQUF6QjtBQUNILEtBRk0sTUFFQTtBQUNIcUIsTUFBQUEsS0FBSyxDQUFDbkIsSUFBTixHQUFhUCxXQUFXLENBQUNLLE1BQXpCO0FBQ0E2QixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxzQkFBWixFQUFvQ0MsSUFBSSxDQUFDQyxTQUFMLENBQWVaLFVBQWYsQ0FBcEM7QUFDQWEsTUFBQUEsT0FBTyxDQUFDQyxJQUFSLENBQWEsQ0FBYjtBQUNIOztBQUNELFdBQU9iLEtBQVA7QUFDSDs7QUFFRCxXQUFTYyxZQUFULENBQXNCakMsSUFBdEIsRUFBb0Q7QUFDaEQsUUFBSUEsSUFBSSxDQUFDcUIsS0FBVCxFQUFnQjtBQUNaLGFBQU9ZLFlBQVksQ0FBQ2pDLElBQUksQ0FBQ3FCLEtBQU4sQ0FBbkI7QUFDSDs7QUFDRCxXQUFPckIsSUFBUDtBQUNIOztBQUVELFdBQVNrQyxXQUFULENBQ0k3RCxJQURKLEVBRUk2QyxVQUZKLEVBR0U7QUFDRSxVQUFNN0IsTUFBTSxHQUFHNkIsVUFBVSxDQUFDOUIsS0FBWCxJQUFvQjhCLFVBQVUsQ0FBQzdCLE1BQTlDOztBQUNBLFFBQUksQ0FBQ0EsTUFBTCxFQUFhO0FBQ1RzQyxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBYSxNQUFLdkQsSUFBSyxLQUFJd0QsSUFBSSxDQUFDQyxTQUFMLENBQWVaLFVBQWYsRUFBMkJkLE1BQTNCLENBQWtDLENBQWxDLEVBQXFDLEdBQXJDLENBQTBDLEVBQXJFO0FBQ0E7QUFDSDs7QUFDRCxVQUFNSixJQUFZLEdBQUc7QUFDakIzQixNQUFBQSxJQURpQjtBQUVqQmtCLE1BQUFBLFFBQVEsRUFBRTJCLFVBQVUsQ0FBQzlCLEtBQVgsR0FBbUJILGNBQWMsQ0FBQ0csS0FBbEMsR0FBMENILGNBQWMsQ0FBQ0ksTUFGbEQ7QUFHakJHLE1BQUFBLE1BQU0sRUFBRSxFQUhTO0FBSWpCMkMsTUFBQUEsVUFBVSxFQUFHakIsVUFBRCxDQUFrQnJFLENBQWxCLENBQW9Cc0YsVUFKZjtBQUtqQm5GLE1BQUFBLEdBQUcsRUFBRXVELFFBQVEsQ0FBQ1csVUFBRDtBQUxJLEtBQXJCOztBQVFBLFFBQUlsQixJQUFJLENBQUNtQyxVQUFULEVBQXFCO0FBQ2pCbkMsTUFBQUEsSUFBSSxDQUFDUixNQUFMLENBQVk0QyxJQUFaLENBQWlCO0FBQ2IvRCxRQUFBQSxJQUFJLEVBQUUsSUFETztBQUViK0MsUUFBQUEsVUFBVSxFQUFFLENBRkM7QUFHYnBCLFFBQUFBLElBQUksRUFBRVAsV0FBVyxDQUFDSyxNQUhMO0FBSWI5QyxRQUFBQSxHQUFHLEVBQUU7QUFKUSxPQUFqQjtBQU1IOztBQUNEcUMsSUFBQUEsTUFBTSxDQUFDZ0QsT0FBUCxDQUFnQmxCLEtBQUQsSUFBVztBQUN0Qm5CLE1BQUFBLElBQUksQ0FBQ1IsTUFBTCxDQUFZNEMsSUFBWixDQUFpQnJCLFlBQVksQ0FBQzFDLElBQUQsRUFBTzhDLEtBQVAsQ0FBN0I7QUFDQSxZQUFNbUIsU0FBUyxHQUFHTCxZQUFZLENBQUNkLEtBQUQsQ0FBOUI7QUFDQSxZQUFNb0IsT0FBTyxHQUFJRCxTQUFTLENBQUNqRCxNQUFWLElBQW9CaUQsU0FBUyxDQUFDbEQsS0FBL0IsR0FBd0NrRCxTQUF4QyxHQUFvRCxJQUFwRTs7QUFDQSxVQUFJQyxPQUFKLEVBQWE7QUFDVEwsUUFBQUEsV0FBVyxDQUFDLDRCQUFrQjdELElBQWxCLEVBQXdCOEMsS0FBSyxDQUFDOUMsSUFBOUIsQ0FBRCxFQUFzQ2tFLE9BQXRDLENBQVg7QUFDSDtBQUNKLEtBUEQ7QUFRQTNCLElBQUFBLE9BQU8sQ0FBQ3dCLElBQVIsQ0FBYXBDLElBQWI7QUFDSDs7QUFFRCxRQUFNUSxNQUFNLEdBQUcsMEJBQWFHLFNBQWIsQ0FBZjs7QUFFQSxNQUFJSCxNQUFNLENBQUNnQyxLQUFYLEVBQWtCO0FBQ2RoQyxJQUFBQSxNQUFNLENBQUNnQyxLQUFQLENBQWFDLEtBQWIsQ0FBbUJKLE9BQW5CLENBQTRCckMsSUFBRCxJQUFvQztBQUMzRGtDLE1BQUFBLFdBQVcsQ0FBQ2xDLElBQUksQ0FBQzNCLElBQU4sRUFBWTJCLElBQVosQ0FBWDtBQUNILEtBRkQ7QUFHSDs7QUFHRCxRQUFNZCxVQUErQixHQUFHLElBQUk0QixHQUFKLEVBQXhDO0FBQ0EsUUFBTTRCLFNBQXNCLEdBQUcsSUFBSUMsR0FBSixFQUEvQjtBQUNBLFFBQU1DLFFBQTZCLEdBQUcsSUFBSTlCLEdBQUosRUFBdEM7QUFDQSxRQUFNK0IsZUFBeUIsR0FBRyxFQUFsQztBQUNBakMsRUFBQUEsT0FBTyxDQUFDeUIsT0FBUixDQUFnQlMsQ0FBQyxJQUFJNUQsVUFBVSxDQUFDc0MsR0FBWCxDQUFlc0IsQ0FBQyxDQUFDekUsSUFBakIsRUFBdUJ5RSxDQUF2QixDQUFyQjs7QUFDQSxRQUFNQyxXQUFXLEdBQUkvQyxJQUFELElBQWtCO0FBQ2xDLFFBQUk0QyxRQUFRLENBQUNJLEdBQVQsQ0FBYWhELElBQUksQ0FBQzNCLElBQWxCLENBQUosRUFBNkI7QUFDekI7QUFDSDs7QUFDRCxRQUFJcUUsU0FBUyxDQUFDTSxHQUFWLENBQWNoRCxJQUFJLENBQUMzQixJQUFuQixDQUFKLEVBQThCO0FBQzFCc0QsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQWEsdUNBQXNDNUIsSUFBSSxDQUFDM0IsSUFBSyxFQUE3RDtBQUNBO0FBQ0g7O0FBQ0RxRSxJQUFBQSxTQUFTLENBQUNPLEdBQVYsQ0FBY2pELElBQUksQ0FBQzNCLElBQW5CO0FBQ0EyQixJQUFBQSxJQUFJLENBQUNSLE1BQUwsQ0FBWTZDLE9BQVosQ0FBcUJsQixLQUFELElBQVc7QUFDM0IsVUFBSUEsS0FBSyxDQUFDbkIsSUFBTixDQUFXVCxRQUFYLEtBQXdCTixjQUFjLENBQUNDLFVBQTNDLEVBQXVEO0FBQ25ELFlBQUljLElBQUksR0FBRzRDLFFBQVEsQ0FBQ00sR0FBVCxDQUFhL0IsS0FBSyxDQUFDbkIsSUFBTixDQUFXM0IsSUFBeEIsQ0FBWDs7QUFDQSxZQUFJLENBQUMyQixJQUFMLEVBQVc7QUFDUEEsVUFBQUEsSUFBSSxHQUFHZCxVQUFVLENBQUNnRSxHQUFYLENBQWUvQixLQUFLLENBQUNuQixJQUFOLENBQVczQixJQUExQixDQUFQOztBQUNBLGNBQUkyQixJQUFKLEVBQVU7QUFDTitDLFlBQUFBLFdBQVcsQ0FBQy9DLElBQUQsQ0FBWDtBQUNILFdBRkQsTUFFTztBQUNIMkIsWUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQWEsOEJBQTZCVCxLQUFLLENBQUNuQixJQUFOLENBQVczQixJQUFLLEVBQTFEO0FBQ0EwRCxZQUFBQSxPQUFPLENBQUNDLElBQVIsQ0FBYSxDQUFiO0FBQ0g7QUFDSjs7QUFDRCxZQUFJaEMsSUFBSixFQUFVO0FBQ05tQixVQUFBQSxLQUFLLENBQUNuQixJQUFOLEdBQWFBLElBQWI7QUFDSDtBQUNKO0FBQ0osS0FoQkQ7QUFpQkEwQyxJQUFBQSxTQUFTLENBQUNTLE1BQVYsQ0FBaUJuRCxJQUFJLENBQUMzQixJQUF0QjtBQUNBd0UsSUFBQUEsZUFBZSxDQUFDVCxJQUFoQixDQUFxQnBDLElBQXJCO0FBQ0FkLElBQUFBLFVBQVUsQ0FBQ2lFLE1BQVgsQ0FBa0JuRCxJQUFJLENBQUMzQixJQUF2QjtBQUNBdUUsSUFBQUEsUUFBUSxDQUFDcEIsR0FBVCxDQUFheEIsSUFBSSxDQUFDM0IsSUFBbEIsRUFBd0IyQixJQUF4QjtBQUNILEdBOUJEOztBQStCQVksRUFBQUEsT0FBTyxDQUFDeUIsT0FBUixDQUFnQlUsV0FBaEI7QUFDQSxTQUFPO0FBQ0hOLElBQUFBLEtBQUssRUFBRUksZUFESjtBQUVIaEMsSUFBQUE7QUFGRyxHQUFQO0FBSUgiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuaW1wb3J0IHttYWtlRmllbGRUeXBlTmFtZX0gZnJvbSBcInRvbi1sYWJzLWRldi1vcHMvZGlzdC9zcmMvZ2VuXCI7XG5pbXBvcnQge0RlZiwgcGFyc2VUeXBlRGVmfSBmcm9tIFwidG9uLWxhYnMtZGV2LW9wcy9kaXN0L3NyYy9zY2hlbWFcIjtcbmltcG9ydCB0eXBlIHtcbiAgICBJbnRTaXplVHlwZSxcbiAgICBTY2hlbWFEb2MsXG4gICAgU2NoZW1hTWVtYmVyLFxuICAgIFNjaGVtYVR5cGUsXG4gICAgVHlwZURlZlxufSBmcm9tIFwidG9uLWxhYnMtZGV2LW9wcy9zcmMvc2NoZW1hXCI7XG5cbmNvbnN0IHsgcmVmLCBhcnJheU9mIH0gPSBEZWY7XG5cbmNvbnN0IFRvU3RyaW5nRm9ybWF0dGVyID0ge1xuICAgIHVuaXhNaWxsaXNlY29uZHNUb1N0cmluZzogJ3VuaXhNaWxsaXNlY29uZHNUb1N0cmluZycsXG4gICAgdW5peFNlY29uZHNUb1N0cmluZzogJ3VuaXhTZWNvbmRzVG9TdHJpbmcnLFxuXG59XG5cbmV4cG9ydCB0eXBlIFRvU3RyaW5nRm9ybWF0dGVyVHlwZSA9ICRWYWx1ZXM8dHlwZW9mIFRvU3RyaW5nRm9ybWF0dGVyPjtcblxuZXhwb3J0IGNvbnN0IGpvaW4gPSAoXG4gICAgcmVmRGVmOiAoc3RyaW5nIHwgeyBbc3RyaW5nXTogVHlwZURlZiB9KSxcbiAgICBvbjogc3RyaW5nLFxuICAgIHJlZk9uOiBzdHJpbmcsXG4gICAgcHJlQ29uZGl0aW9uPzogc3RyaW5nLFxuKTogVHlwZURlZiA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucmVmKHJlZkRlZiksXG4gICAgICAgIF86IHtcbiAgICAgICAgICAgIGpvaW46IHtcbiAgICAgICAgICAgICAgICBvbixcbiAgICAgICAgICAgICAgICByZWZPbixcbiAgICAgICAgICAgICAgICBwcmVDb25kaXRpb246IChwcmVDb25kaXRpb24gfHwgJycpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICB9XG59O1xuXG5leHBvcnQgY29uc3Qgd2l0aERvYyA9IChkZWY6IFR5cGVEZWYsIGRvYz86IHN0cmluZykgPT4gKHtcbiAgICAuLi5kZWYsXG4gICAgLi4uKGRvYyA/IHsgX2RvYzogZG9jIH0gOiB7fSksXG59KTtcblxuZXhwb3J0IGNvbnN0IHJlcXVpcmVkID0gKGRlZjogVHlwZURlZikgPT4gZGVmO1xuXG5jb25zdCB1aW50ID0gKHNpemU6IEludFNpemVUeXBlLCBkb2M/OiBzdHJpbmcpID0+IHdpdGhEb2Moe1xuICAgIF9pbnQ6IHtcbiAgICAgICAgdW5zaWduZWQ6IHRydWUsXG4gICAgICAgIHNpemUsXG4gICAgfSxcbn0sIGRvYyk7XG5cbmNvbnN0IGludCA9IChzaXplOiBJbnRTaXplVHlwZSwgZG9jPzogc3RyaW5nKSA9PiB3aXRoRG9jKHtcbiAgICBfaW50OiB7XG4gICAgICAgIHVuc2lnbmVkOiBmYWxzZSxcbiAgICAgICAgc2l6ZSxcbiAgICB9LFxufSwgZG9jKTtcblxuZXhwb3J0IGNvbnN0IGk4ID0gKGRvYz86IHN0cmluZykgPT4gaW50KDgsIGRvYyk7XG5leHBvcnQgY29uc3QgaTMyID0gKGRvYz86IHN0cmluZykgPT4gaW50KDMyLCBkb2MpO1xuZXhwb3J0IGNvbnN0IHU4ID0gKGRvYz86IHN0cmluZykgPT4gdWludCg4LCBkb2MpO1xuZXhwb3J0IGNvbnN0IHUxNiA9IChkb2M/OiBzdHJpbmcpID0+IHVpbnQoMTYsIGRvYyk7XG5leHBvcnQgY29uc3QgdTMyID0gKGRvYz86IHN0cmluZykgPT4gdWludCgzMiwgZG9jKTtcbmV4cG9ydCBjb25zdCB1NjQgPSAoZG9jPzogc3RyaW5nKSA9PiB1aW50KDY0LCBkb2MpO1xuZXhwb3J0IGNvbnN0IHUxMjggPSAoZG9jPzogc3RyaW5nKSA9PiB1aW50KDEyOCwgZG9jKTtcbmNvbnN0IHUyNTYgPSAoZG9jPzogc3RyaW5nKSA9PiB1aW50KDI1NiwgZG9jKTtcblxuZXhwb3J0IGNvbnN0IHUzMldpdGhGb3JtYXR0ZXIgPSAoZm9ybWF0dGVyOiBUb1N0cmluZ0Zvcm1hdHRlclR5cGUsIGRvYz86IHN0cmluZykgPT4gd2l0aERvYyh7XG4gICAgX2ludDoge1xuICAgICAgICB1bnNpZ25lZDogdHJ1ZSxcbiAgICAgICAgc2l6ZTogMzIsXG4gICAgfSxcbiAgICBfOiB7XG4gICAgICAgIGZvcm1hdHRlcixcbiAgICB9LFxufSwgZG9jKTtcblxuZXhwb3J0IGNvbnN0IHVuaXhTZWNvbmRzID0gKGRvYz86IHN0cmluZykgPT4gdTMyV2l0aEZvcm1hdHRlcihUb1N0cmluZ0Zvcm1hdHRlci51bml4U2Vjb25kc1RvU3RyaW5nLCBkb2MpO1xuXG5leHBvcnQgY29uc3QgZ3JhbXMgPSB1MTI4O1xuXG50eXBlIEludEVudW1WYWx1ZXMgPSB7XG4gICAgW3N0cmluZ106IG51bWJlclxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIHU4ZW51bShuYW1lOiBzdHJpbmcsIHZhbHVlczogSW50RW51bVZhbHVlcykge1xuICAgIHJldHVybiAoZG9jPzogc3RyaW5nKTogVHlwZURlZiA9PiB7XG4gICAgICAgIGNvbnN0IHZhbHVlc0RvYyA9IE9iamVjdC5lbnRyaWVzKHZhbHVlcykubWFwKChbbmFtZSwgdmFsdWVdKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYC0gJHsodmFsdWU6IGFueSl9IOKAkyAke25hbWV9YDtcbiAgICAgICAgfSkuam9pbignXFxuJyk7XG4gICAgICAgIGNvbnN0IGVmZmVjdGl2ZURvYyA9IGAke2RvYyA/IGAke2RvY31cXG5gIDogJyd9JHt2YWx1ZXNEb2N9YDtcbiAgICAgICAgcmV0dXJuIHdpdGhEb2Moe1xuICAgICAgICAgICAgX2ludDoge1xuICAgICAgICAgICAgICAgIHVuc2lnbmVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNpemU6IDgsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXzoge1xuICAgICAgICAgICAgICAgIGVudW06IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LCBlZmZlY3RpdmVEb2MpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IE90aGVyQ3VycmVuY3k6IFR5cGVEZWYgPSB7XG4gICAgY3VycmVuY3k6IHUzMigpLFxuICAgIHZhbHVlOiB1MjU2KCksXG59O1xuXG5leHBvcnQgY29uc3Qgb3RoZXJDdXJyZW5jeUNvbGxlY3Rpb24gPSAoZG9jPzogc3RyaW5nKTogVHlwZURlZiA9PiBhcnJheU9mKHJlZih7IE90aGVyQ3VycmVuY3kgfSksIGRvYyk7XG5leHBvcnQgY29uc3QgRGJUeXBlQ2F0ZWdvcnkgPSB7XG4gICAgdW5yZXNvbHZlZDogJ3VucmVzb2x2ZWQnLFxuICAgIHNjYWxhcjogJ3NjYWxhcicsXG4gICAgdW5pb246ICd1bmlvbicsXG4gICAgc3RydWN0OiAnc3RydWN0Jyxcbn07XG50eXBlIERiSm9pbiA9IHtcbiAgICBjb2xsZWN0aW9uOiBzdHJpbmcsXG4gICAgb246IHN0cmluZyxcbiAgICByZWZPbjogc3RyaW5nLFxuICAgIHByZUNvbmRpdGlvbjogc3RyaW5nLFxufVxuZXhwb3J0IHR5cGUgRGJUeXBlID0ge1xuICAgIG5hbWU6IHN0cmluZyxcbiAgICBmaWVsZHM6IERiRmllbGRbXSxcbiAgICBjYXRlZ29yeTogJ3VucmVzb2x2ZWQnIHwgJ3NjYWxhcicgfCAndW5pb24nIHwgJ3N0cnVjdCcsXG4gICAgY29sbGVjdGlvbj86IHN0cmluZyxcbiAgICBkb2M6IHN0cmluZyxcbn1cbmV4cG9ydCB0eXBlIEludEVudW1EZWYgPSB7XG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHZhbHVlczoge1xuICAgICAgICBbc3RyaW5nXTogbnVtYmVyXG4gICAgfSxcbn1cbmV4cG9ydCB0eXBlIERiRmllbGQgPSB7XG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHR5cGU6IERiVHlwZSxcbiAgICBhcnJheURlcHRoOiBudW1iZXIsXG4gICAgam9pbj86IERiSm9pbixcbiAgICBlbnVtRGVmPzogSW50RW51bURlZixcbiAgICBmb3JtYXR0ZXI/OiBUb1N0cmluZ0Zvcm1hdHRlclR5cGUsXG4gICAgZG9jOiBzdHJpbmcsXG59XG5cbmZ1bmN0aW9uIHNjYWxhclR5cGUobmFtZTogc3RyaW5nKTogRGJUeXBlIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBuYW1lLFxuICAgICAgICBjYXRlZ29yeTogRGJUeXBlQ2F0ZWdvcnkuc2NhbGFyLFxuICAgICAgICBmaWVsZHM6IFtdLFxuICAgICAgICBkb2M6ICcnLFxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IHNjYWxhclR5cGVzID0ge1xuICAgIGludDogc2NhbGFyVHlwZSgnSW50JyksXG4gICAgdWludDY0OiBzY2FsYXJUeXBlKCdTdHJpbmcnKSxcbiAgICB1aW50MTAyNDogc2NhbGFyVHlwZSgnU3RyaW5nJyksXG4gICAgZmxvYXQ6IHNjYWxhclR5cGUoJ0Zsb2F0JyksXG4gICAgYm9vbGVhbjogc2NhbGFyVHlwZSgnQm9vbGVhbicpLFxuICAgIHN0cmluZzogc2NhbGFyVHlwZSgnU3RyaW5nJyksXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gaXNCaWdJbnQodHlwZTogRGJUeXBlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHR5cGUgPT09IHNjYWxhclR5cGVzLnVpbnQxMDI0IHx8IHR5cGUgPT09IHNjYWxhclR5cGVzLnVpbnQ2NDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVucmVzb2x2ZWRUeXBlKG5hbWU6IHN0cmluZyk6IERiVHlwZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgY2F0ZWdvcnk6IERiVHlwZUNhdGVnb3J5LnVucmVzb2x2ZWQsXG4gICAgICAgIGZpZWxkczogW10sXG4gICAgICAgIGRvYzogJycsXG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9FbnVtU3R5bGUoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYCR7cy5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKX0ke3Muc3Vic3RyKDEpfWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdHJpbmdpZnlFbnVtVmFsdWVzKHZhbHVlczogeyBbc3RyaW5nXTogbnVtYmVyIH0pOiBzdHJpbmcge1xuICAgIGNvbnN0IGZpZWxkcyA9IE9iamVjdC5lbnRyaWVzKHZhbHVlcykubWFwKChbbmFtZSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIHJldHVybiBgJHt0b0VudW1TdHlsZShuYW1lKX06ICR7KHZhbHVlOiBhbnkpfWA7XG4gICAgfSk7XG4gICAgcmV0dXJuIGB7ICR7ZmllbGRzLmpvaW4oJywgJyl9IH1gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9jTUQoc2NoZW1hOiBTY2hlbWFEb2MpOiBzdHJpbmcge1xuICAgIGNvbnN0IGRvYyA9IHNjaGVtYS5kb2M7XG4gICAgaWYgKCFkb2MpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGRvYyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIGRvYztcbiAgICB9XG4gICAgaWYgKGRvYy5tZCkge1xuICAgICAgICByZXR1cm4gKGRvYy5tZDogYW55KTtcbiAgICB9XG4gICAgcmV0dXJuICcnO1xufVxuXG5leHBvcnQgdHlwZSBEYlNjaGVtYSA9IHtcbiAgICB0eXBlczogRGJUeXBlW10sXG4gICAgZW51bVR5cGVzOiBNYXA8c3RyaW5nLCBJbnRFbnVtRGVmPixcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlRGJTY2hlbWEoc2NoZW1hRGVmOiBUeXBlRGVmKTogRGJTY2hlbWEge1xuICAgIGNvbnN0IGRiVHlwZXM6IERiVHlwZVtdID0gW107XG4gICAgY29uc3QgZW51bVR5cGVzOiBNYXA8c3RyaW5nLCBJbnRFbnVtRGVmPiA9IG5ldyBNYXAoKTtcblxuICAgIGZ1bmN0aW9uIHBhcnNlRGJGaWVsZChcbiAgICAgICAgdHlwZU5hbWU6IHN0cmluZyxcbiAgICAgICAgc2NoZW1hRmllbGQ6IFNjaGVtYU1lbWJlcjxTY2hlbWFUeXBlPixcbiAgICApOiBEYkZpZWxkIHtcbiAgICAgICAgbGV0IHNjaGVtYVR5cGUgPSBzY2hlbWFGaWVsZDtcbiAgICAgICAgY29uc3QgZmllbGQ6IERiRmllbGQgPSB7XG4gICAgICAgICAgICBuYW1lOiBzY2hlbWFGaWVsZC5uYW1lLFxuICAgICAgICAgICAgYXJyYXlEZXB0aDogMCxcbiAgICAgICAgICAgIHR5cGU6IHNjYWxhclR5cGVzLnN0cmluZyxcbiAgICAgICAgICAgIGRvYzogZ2V0RG9jTUQoc2NoZW1hRmllbGQpLFxuICAgICAgICB9O1xuICAgICAgICB3aGlsZSAoc2NoZW1hVHlwZS5hcnJheSkge1xuICAgICAgICAgICAgZmllbGQuYXJyYXlEZXB0aCArPSAxO1xuICAgICAgICAgICAgc2NoZW1hVHlwZSA9IHNjaGVtYVR5cGUuYXJyYXk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZXggPSAoc2NoZW1hVHlwZTogYW55KS5fO1xuICAgICAgICBjb25zdCBlbnVtRGVmOiA/SW50RW51bURlZiA9IChleCAmJiBleC5lbnVtKSB8fCBudWxsO1xuICAgICAgICBpZiAoZW51bURlZikge1xuICAgICAgICAgICAgZmllbGQuZW51bURlZiA9IGVudW1EZWY7XG4gICAgICAgICAgICBlbnVtVHlwZXMuc2V0KGVudW1EZWYubmFtZSwgZW51bURlZik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgam9pbiA9IGV4ICYmIGV4LmpvaW47XG4gICAgICAgIGlmIChqb2luKSB7XG4gICAgICAgICAgICBmaWVsZC5qb2luID0gam9pbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXggJiYgZXguZm9ybWF0dGVyKSB7XG4gICAgICAgICAgICBmaWVsZC5mb3JtYXR0ZXIgPSBleC5mb3JtYXR0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNjaGVtYVR5cGUudW5pb24gfHwgc2NoZW1hVHlwZS5zdHJ1Y3QpIHtcbiAgICAgICAgICAgIGZpZWxkLnR5cGUgPSB1bnJlc29sdmVkVHlwZShtYWtlRmllbGRUeXBlTmFtZSh0eXBlTmFtZSwgc2NoZW1hRmllbGQubmFtZSkpO1xuICAgICAgICB9IGVsc2UgaWYgKHNjaGVtYVR5cGUucmVmKSB7XG4gICAgICAgICAgICBmaWVsZC50eXBlID0gdW5yZXNvbHZlZFR5cGUoc2NoZW1hVHlwZS5yZWYubmFtZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoc2NoZW1hVHlwZS5ib29sKSB7XG4gICAgICAgICAgICBmaWVsZC50eXBlID0gc2NhbGFyVHlwZXMuYm9vbGVhbjtcbiAgICAgICAgfSBlbHNlIGlmIChzY2hlbWFUeXBlLmludCkge1xuICAgICAgICAgICAgY29uc3QgdW5zaWduZWQ6IGJvb2xlYW4gPSAoc2NoZW1hVHlwZS5pbnQgJiYgc2NoZW1hVHlwZS5pbnQudW5zaWduZWQpIHx8IGZhbHNlO1xuICAgICAgICAgICAgY29uc3Qgc2l6ZTogbnVtYmVyID0gKHNjaGVtYVR5cGUuaW50ICYmIHNjaGVtYVR5cGUuaW50LnNpemUpIHx8IDMyO1xuICAgICAgICAgICAgaWYgKHVuc2lnbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNpemUgPj0gMTI4KSB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLnR5cGUgPSBzY2FsYXJUeXBlcy51aW50MTAyNDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNpemUgPj0gNjQpIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQudHlwZSA9IHNjYWxhclR5cGVzLnVpbnQ2NDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNpemUgPj0gMzIpIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQudHlwZSA9IHNjYWxhclR5cGVzLmZsb2F0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLnR5cGUgPSBzY2FsYXJUeXBlcy5pbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoc2l6ZSA+IDMyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW50ZWdlciB0eXBlIHdpdGggc2l6ZSAke3NpemV9IGJpdCBkb2VzIG5vdCBzdXBwb3J0ZWRgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZC50eXBlID0gc2NhbGFyVHlwZXMuaW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChzY2hlbWFUeXBlLmZsb2F0KSB7XG4gICAgICAgICAgICBmaWVsZC50eXBlID0gc2NhbGFyVHlwZXMuZmxvYXQ7XG4gICAgICAgIH0gZWxzZSBpZiAoc2NoZW1hVHlwZS5zdHJpbmcpIHtcbiAgICAgICAgICAgIGZpZWxkLnR5cGUgPSBzY2FsYXJUeXBlcy5zdHJpbmc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmaWVsZC50eXBlID0gc2NhbGFyVHlwZXMuc3RyaW5nO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0ludmFsaWQgZmllbGQgdHlwZTogJywgSlNPTi5zdHJpbmdpZnkoc2NoZW1hVHlwZSkpO1xuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWVsZDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB1bndyYXBBcnJheXModHlwZTogU2NoZW1hVHlwZSk6IFNjaGVtYVR5cGUge1xuICAgICAgICBpZiAodHlwZS5hcnJheSkge1xuICAgICAgICAgICAgcmV0dXJuIHVud3JhcEFycmF5cyh0eXBlLmFycmF5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHlwZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwYXJzZURiVHlwZShcbiAgICAgICAgbmFtZTogc3RyaW5nLFxuICAgICAgICBzY2hlbWFUeXBlOiBTY2hlbWFUeXBlXG4gICAgKSB7XG4gICAgICAgIGNvbnN0IHN0cnVjdCA9IHNjaGVtYVR5cGUudW5pb24gfHwgc2NoZW1hVHlwZS5zdHJ1Y3Q7XG4gICAgICAgIGlmICghc3RydWN0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgPz8gJHtuYW1lfTogJHtKU09OLnN0cmluZ2lmeShzY2hlbWFUeXBlKS5zdWJzdHIoMCwgMjAwKX1gKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0eXBlOiBEYlR5cGUgPSB7XG4gICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgY2F0ZWdvcnk6IHNjaGVtYVR5cGUudW5pb24gPyBEYlR5cGVDYXRlZ29yeS51bmlvbiA6IERiVHlwZUNhdGVnb3J5LnN0cnVjdCxcbiAgICAgICAgICAgIGZpZWxkczogW10sXG4gICAgICAgICAgICBjb2xsZWN0aW9uOiAoc2NoZW1hVHlwZTogYW55KS5fLmNvbGxlY3Rpb24sXG4gICAgICAgICAgICBkb2M6IGdldERvY01EKHNjaGVtYVR5cGUpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0eXBlLmNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgIHR5cGUuZmllbGRzLnB1c2goe1xuICAgICAgICAgICAgICAgIG5hbWU6ICdpZCcsXG4gICAgICAgICAgICAgICAgYXJyYXlEZXB0aDogMCxcbiAgICAgICAgICAgICAgICB0eXBlOiBzY2FsYXJUeXBlcy5zdHJpbmcsXG4gICAgICAgICAgICAgICAgZG9jOiAnJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHN0cnVjdC5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgdHlwZS5maWVsZHMucHVzaChwYXJzZURiRmllbGQobmFtZSwgZmllbGQpKTtcbiAgICAgICAgICAgIGNvbnN0IHVud3JhcHBlZCA9IHVud3JhcEFycmF5cyhmaWVsZCk7XG4gICAgICAgICAgICBjb25zdCBvd25UeXBlID0gKHVud3JhcHBlZC5zdHJ1Y3QgfHwgdW53cmFwcGVkLnVuaW9uKSA/IHVud3JhcHBlZCA6IG51bGw7XG4gICAgICAgICAgICBpZiAob3duVHlwZSkge1xuICAgICAgICAgICAgICAgIHBhcnNlRGJUeXBlKG1ha2VGaWVsZFR5cGVOYW1lKG5hbWUsIGZpZWxkLm5hbWUpLCBvd25UeXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGRiVHlwZXMucHVzaCh0eXBlKTtcbiAgICB9XG5cbiAgICBjb25zdCBzY2hlbWEgPSBwYXJzZVR5cGVEZWYoc2NoZW1hRGVmKTtcblxuICAgIGlmIChzY2hlbWEuY2xhc3MpIHtcbiAgICAgICAgc2NoZW1hLmNsYXNzLnR5cGVzLmZvckVhY2goKHR5cGU6IFNjaGVtYU1lbWJlcjxTY2hlbWFUeXBlPikgPT4ge1xuICAgICAgICAgICAgcGFyc2VEYlR5cGUodHlwZS5uYW1lLCB0eXBlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICBjb25zdCB1bnJlc29sdmVkOiBNYXA8c3RyaW5nLCBEYlR5cGU+ID0gbmV3IE1hcDxzdHJpbmcsIERiVHlwZT4oKTtcbiAgICBjb25zdCByZXNvbHZpbmc6IFNldDxzdHJpbmc+ID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgY29uc3QgcmVzb2x2ZWQ6IE1hcDxzdHJpbmcsIERiVHlwZT4gPSBuZXcgTWFwPHN0cmluZywgRGJUeXBlPigpO1xuICAgIGNvbnN0IG9yZGVyZWRSZXNvbHZlZDogRGJUeXBlW10gPSBbXTtcbiAgICBkYlR5cGVzLmZvckVhY2godCA9PiB1bnJlc29sdmVkLnNldCh0Lm5hbWUsIHQpKTtcbiAgICBjb25zdCByZXNvbHZlVHlwZSA9ICh0eXBlOiBEYlR5cGUpID0+IHtcbiAgICAgICAgaWYgKHJlc29sdmVkLmhhcyh0eXBlLm5hbWUpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc29sdmluZy5oYXModHlwZS5uYW1lKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYFdBUk5JTkc6IENpcmN1bGFyIHJlZmVyZW5jZSB0byB0eXBlICR7dHlwZS5uYW1lfWApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJlc29sdmluZy5hZGQodHlwZS5uYW1lKTtcbiAgICAgICAgdHlwZS5maWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlLmNhdGVnb3J5ID09PSBEYlR5cGVDYXRlZ29yeS51bnJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgbGV0IHR5cGUgPSByZXNvbHZlZC5nZXQoZmllbGQudHlwZS5uYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAoIXR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHVucmVzb2x2ZWQuZ2V0KGZpZWxkLnR5cGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlVHlwZSh0eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBSZWZlcmVuY2VkIHR5cGUgbm90IGZvdW5kOiAke2ZpZWxkLnR5cGUubmFtZX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZC50eXBlID0gdHlwZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXNvbHZpbmcuZGVsZXRlKHR5cGUubmFtZSk7XG4gICAgICAgIG9yZGVyZWRSZXNvbHZlZC5wdXNoKHR5cGUpO1xuICAgICAgICB1bnJlc29sdmVkLmRlbGV0ZSh0eXBlLm5hbWUpO1xuICAgICAgICByZXNvbHZlZC5zZXQodHlwZS5uYW1lLCB0eXBlKTtcbiAgICB9O1xuICAgIGRiVHlwZXMuZm9yRWFjaChyZXNvbHZlVHlwZSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZXM6IG9yZGVyZWRSZXNvbHZlZCxcbiAgICAgICAgZW51bVR5cGVzLFxuICAgIH1cbn1cbiJdfQ==