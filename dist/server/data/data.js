"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _collection = require("./collection");

var _auth = require("../auth");

var _config = require("../config");

var _logs = _interopRequireDefault(require("../logs"));

var _opentracing = require("opentracing");

var _tracer = require("../tracer");

var _utils = require("../utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
 * Copyright 2018-2020 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at:
 *
 * http://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 */
class QData {
  // Dependencies
  // Own
  constructor(options) {
    this.providers = options.providers;
    this.slowQueriesProviders = options.slowQueriesProviders || options.providers;
    this.logs = options.logs;
    this.stats = options.stats;
    this.auth = options.auth;
    this.tracer = options.tracer;
    this.isTests = options.isTests;
    this.log = this.logs.create('data');
    this.statPostCount = new _tracer.StatsCounter(this.stats, _config.STATS.post.count, []);
    this.statPostFailed = new _tracer.StatsCounter(this.stats, _config.STATS.post.failed, []);
    this.collections = [];
    this.collectionsByName = new Map();
  }

  addCollection(name, docType, mutable, indexes) {
    const collection = new _collection.QDataCollection({
      name,
      docType,
      mutable,
      indexes,
      provider: mutable ? this.providers.mutable : this.providers.immutable,
      slowQueriesProvider: mutable ? this.providers.mutable : this.slowQueriesProviders.immutable,
      logs: this.logs,
      auth: this.auth,
      tracer: this.tracer,
      stats: this.stats,
      isTests: this.isTests
    });
    this.collections.push(collection);
    this.collectionsByName.set(name, collection);
    return collection;
  }

  start() {
    const mutable = [];
    const immutable = [];
    this.collections.forEach(x => (x.mutable ? mutable : immutable).push(x.name));
    this.providers.mutable.start(mutable);
    this.providers.immutable.start(immutable);
    this.slowQueriesProviders.mutable.start([]);
    this.slowQueriesProviders.immutable.start([]);
  }

  dropCachedDbInfo() {
    this.collections.forEach(x => x.dropCachedDbInfo());
  }

  async query(provider, text, vars, orderBy) {
    return (0, _utils.wrap)(this.log, 'QUERY', {
      text,
      vars
    }, async () => {
      return provider.query(text, vars, orderBy);
    });
  }

  async finishOperations(operationIds) {
    let count = 0;
    this.collections.forEach(x => count += x.finishOperations(operationIds));
    return count;
  }

}

exports.default = QData;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zZXJ2ZXIvZGF0YS9kYXRhLmpzIl0sIm5hbWVzIjpbIlFEYXRhIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwicHJvdmlkZXJzIiwic2xvd1F1ZXJpZXNQcm92aWRlcnMiLCJsb2dzIiwic3RhdHMiLCJhdXRoIiwidHJhY2VyIiwiaXNUZXN0cyIsImxvZyIsImNyZWF0ZSIsInN0YXRQb3N0Q291bnQiLCJTdGF0c0NvdW50ZXIiLCJTVEFUUyIsInBvc3QiLCJjb3VudCIsInN0YXRQb3N0RmFpbGVkIiwiZmFpbGVkIiwiY29sbGVjdGlvbnMiLCJjb2xsZWN0aW9uc0J5TmFtZSIsIk1hcCIsImFkZENvbGxlY3Rpb24iLCJuYW1lIiwiZG9jVHlwZSIsIm11dGFibGUiLCJpbmRleGVzIiwiY29sbGVjdGlvbiIsIlFEYXRhQ29sbGVjdGlvbiIsInByb3ZpZGVyIiwiaW1tdXRhYmxlIiwic2xvd1F1ZXJpZXNQcm92aWRlciIsInB1c2giLCJzZXQiLCJzdGFydCIsImZvckVhY2giLCJ4IiwiZHJvcENhY2hlZERiSW5mbyIsInF1ZXJ5IiwidGV4dCIsInZhcnMiLCJvcmRlckJ5IiwiZmluaXNoT3BlcmF0aW9ucyIsIm9wZXJhdGlvbklkcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQWtCQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFFQTs7QUFDQTs7QUFFQTs7OztBQTNCQTs7Ozs7Ozs7Ozs7Ozs7O0FBOENlLE1BQU1BLEtBQU4sQ0FBWTtBQUN2QjtBQVNBO0FBUUFDLEVBQUFBLFdBQVcsQ0FBQ0MsT0FBRCxFQUF3QjtBQUMvQixTQUFLQyxTQUFMLEdBQWlCRCxPQUFPLENBQUNDLFNBQXpCO0FBQ0EsU0FBS0Msb0JBQUwsR0FBNEJGLE9BQU8sQ0FBQ0Usb0JBQVIsSUFBZ0NGLE9BQU8sQ0FBQ0MsU0FBcEU7QUFDQSxTQUFLRSxJQUFMLEdBQVlILE9BQU8sQ0FBQ0csSUFBcEI7QUFDQSxTQUFLQyxLQUFMLEdBQWFKLE9BQU8sQ0FBQ0ksS0FBckI7QUFD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QSxJQUFGO0FBQVFDLE1BQUFBO0FBQVIsS0FBeEIsRUFBd0MsWUFBWTtBQUN2RCxhQUFPWCxRQUFRLENBQUNTLEtBQVQsQ0FBZUMsSUFBZixFQUFxQkMsSUFBckIsRUFBMkJDLE9BQTNCLENBQVA7QUFDSCxLQUZNLENBQVA7QUFHSDs7QUFFRCxRQUFNQyxnQkFBTixDQUF1QkMsWUFBdkIsRUFBbUU7QUFDL0QsUUFBSTNCLEtBQUssR0FBRyxDQUFaO0FBQ0EsU0FBS0csV0FBTCxDQUFpQmdCLE9BQWpCLENBQXlCQyxDQUFDLElBQUtwQixLQUFLLElBQUlvQixDQUFDLENBQUNNLGdCQUFGLENBQW1CQyxZQUFuQixDQUF4QztBQUNBLFdBQU8zQixLQUFQO0FBQ0g7O0FBL0VzQiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxOC0yMDIwIFRPTiBERVYgU09MVVRJT05TIExURC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgU09GVFdBUkUgRVZBTFVBVElPTiBMaWNlbnNlICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcbiAqIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZVxuICogTGljZW5zZSBhdDpcbiAqXG4gKiBodHRwOi8vd3d3LnRvbi5kZXYvbGljZW5zZXNcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIFRPTiBERVYgc29mdHdhcmUgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuLy8gQGZsb3dcblxuaW1wb3J0IHsgUURhdGFDb2xsZWN0aW9uIH0gZnJvbSAnLi9jb2xsZWN0aW9uJztcbmltcG9ydCB7IEF1dGggfSBmcm9tICcuLi9hdXRoJztcbmltcG9ydCB7IFNUQVRTIH0gZnJvbSAnLi4vY29uZmlnJztcbmltcG9ydCB0eXBlIHsgUUxvZyB9IGZyb20gJy4uL2xvZ3MnO1xuaW1wb3J0IFFMb2dzIGZyb20gJy4uL2xvZ3MnXG5pbXBvcnQgdHlwZSB7IE9yZGVyQnksIFFUeXBlIH0gZnJvbSAnLi4vZmlsdGVyL2ZpbHRlcnMnO1xuaW1wb3J0IHsgVHJhY2VyIH0gZnJvbSAnb3BlbnRyYWNpbmcnO1xuaW1wb3J0IHsgU3RhdHNDb3VudGVyIH0gZnJvbSAnLi4vdHJhY2VyJztcbmltcG9ydCB0eXBlIHsgSVN0YXRzIH0gZnJvbSAnLi4vdHJhY2VyJztcbmltcG9ydCB7IHdyYXAgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgdHlwZSB7IFFEYXRhUHJvdmlkZXIsIFFJbmRleEluZm8gfSBmcm9tICcuL2RhdGEtcHJvdmlkZXInO1xuXG5leHBvcnQgdHlwZSBRRGF0YVByb3ZpZGVycyA9IHtcbiAgICBtdXRhYmxlOiBRRGF0YVByb3ZpZGVyLFxuICAgIGltbXV0YWJsZTogUURhdGFQcm92aWRlcixcbn1cblxuZXhwb3J0IHR5cGUgUURhdGFPcHRpb25zID0ge1xuICAgIHByb3ZpZGVyczogUURhdGFQcm92aWRlcnMsXG4gICAgc2xvd1F1ZXJpZXNQcm92aWRlcnM/OiBRRGF0YVByb3ZpZGVycyxcblxuICAgIGxvZ3M6IFFMb2dzLFxuICAgIGF1dGg6IEF1dGgsXG4gICAgdHJhY2VyOiBUcmFjZXIsXG4gICAgc3RhdHM6IElTdGF0cyxcbiAgICBpc1Rlc3RzOiBib29sZWFuLFxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBRRGF0YSB7XG4gICAgLy8gRGVwZW5kZW5jaWVzXG4gICAgcHJvdmlkZXJzOiBRRGF0YVByb3ZpZGVycztcbiAgICBzbG93UXVlcmllc1Byb3ZpZGVyczogUURhdGFQcm92aWRlcnM7XG4gICAgbG9nczogUUxvZ3M7XG4gICAgc3RhdHM6IElTdGF0cztcbiAgICBhdXRoOiBBdXRoO1xuICAgIHRyYWNlcjogVHJhY2VyO1xuICAgIGlzVGVzdHM6IGJvb2xlYW47XG5cbiAgICAvLyBPd25cbiAgICBsb2c6IFFMb2c7XG4gICAgc3RhdFBvc3RDb3VudDogU3RhdHNDb3VudGVyO1xuICAgIHN0YXRQb3N0RmFpbGVkOiBTdGF0c0NvdW50ZXI7XG5cbiAgICBjb2xsZWN0aW9uczogUURhdGFDb2xsZWN0aW9uW107XG4gICAgY29sbGVjdGlvbnNCeU5hbWU6IE1hcDxzdHJpbmcsIFFEYXRhQ29sbGVjdGlvbj47XG5cbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBRRGF0YU9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5wcm92aWRlcnMgPSBvcHRpb25zLnByb3ZpZGVycztcbiAgICAgICAgdGhpcy5zbG93UXVlcmllc1Byb3ZpZGVycyA9IG9wdGlvbnMuc2xvd1F1ZXJpZXNQcm92aWRlcnMgfHwgb3B0aW9ucy5wcm92aWRlcnM7XG4gICAgICAgIHRoaXMubG9ncyA9IG9wdGlvbnMubG9ncztcbiAgICAgICAgdGhpcy5zdGF0cyA9IG9wdGlvbnMuc3RhdHM7XG4gICAgICAgIHRoaXMuYXV0aCA9IG9wdGlvbnMuYXV0aDtcbiAgICAgICAgdGhpcy50cmFjZXIgPSBvcHRpb25zLnRyYWNlcjtcbiAgICAgICAgdGhpcy5pc1Rlc3RzID0gb3B0aW9ucy5pc1Rlc3RzO1xuXG4gICAgICAgIHRoaXMubG9nID0gdGhpcy5sb2dzLmNyZWF0ZSgnZGF0YScpO1xuXG4gICAgICAgIHRoaXMuc3RhdFBvc3RDb3VudCA9IG5ldyBTdGF0c0NvdW50ZXIodGhpcy5zdGF0cywgU1RBVFMucG9zdC5jb3VudCwgW10pO1xuICAgICAgICB0aGlzLnN0YXRQb3N0RmFpbGVkID0gbmV3IFN0YXRzQ291bnRlcih0aGlzLnN0YXRzLCBTVEFUUy5wb3N0LmZhaWxlZCwgW10pO1xuXG4gICAgICAgIHRoaXMuY29sbGVjdGlvbnMgPSBbXTtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uc0J5TmFtZSA9IG5ldyBNYXAoKTtcbiAgICB9XG5cbiAgICBhZGRDb2xsZWN0aW9uKG5hbWU6IHN0cmluZywgZG9jVHlwZTogUVR5cGUsIG11dGFibGU6IGJvb2xlYW4sIGluZGV4ZXM6IFFJbmRleEluZm9bXSkge1xuICAgICAgICBjb25zdCBjb2xsZWN0aW9uID0gbmV3IFFEYXRhQ29sbGVjdGlvbih7XG4gICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgZG9jVHlwZSxcbiAgICAgICAgICAgIG11dGFibGUsXG4gICAgICAgICAgICBpbmRleGVzLFxuICAgICAgICAgICAgcHJvdmlkZXI6IG11dGFibGUgPyB0aGlzLnByb3ZpZGVycy5tdXRhYmxlIDogdGhpcy5wcm92aWRlcnMuaW1tdXRhYmxlLFxuICAgICAgICAgICAgc2xvd1F1ZXJpZXNQcm92aWRlcjogbXV0YWJsZSA/IHRoaXMucHJvdmlkZXJzLm11dGFibGUgOiB0aGlzLnNsb3dRdWVyaWVzUHJvdmlkZXJzLmltbXV0YWJsZSxcbiAgICAgICAgICAgIGxvZ3M6IHRoaXMubG9ncyxcbiAgICAgICAgICAgIGF1dGg6IHRoaXMuYXV0aCxcbiAgICAgICAgICAgIHRyYWNlcjogdGhpcy50cmFjZXIsXG4gICAgICAgICAgICBzdGF0czogdGhpcy5zdGF0cyxcbiAgICAgICAgICAgIGlzVGVzdHM6IHRoaXMuaXNUZXN0cyxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbnMucHVzaChjb2xsZWN0aW9uKTtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uc0J5TmFtZS5zZXQobmFtZSwgY29sbGVjdGlvbik7XG4gICAgICAgIHJldHVybiBjb2xsZWN0aW9uO1xuICAgIH1cblxuICAgIHN0YXJ0KCkge1xuICAgICAgICBjb25zdCBtdXRhYmxlID0gW107XG4gICAgICAgIGNvbnN0IGltbXV0YWJsZSA9IFtdO1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25zLmZvckVhY2goeCA9PiAoeC5tdXRhYmxlID8gbXV0YWJsZSA6IGltbXV0YWJsZSkucHVzaCh4Lm5hbWUpKTtcbiAgICAgICAgdGhpcy5wcm92aWRlcnMubXV0YWJsZS5zdGFydChtdXRhYmxlKTtcbiAgICAgICAgdGhpcy5wcm92aWRlcnMuaW1tdXRhYmxlLnN0YXJ0KGltbXV0YWJsZSk7XG4gICAgICAgIHRoaXMuc2xvd1F1ZXJpZXNQcm92aWRlcnMubXV0YWJsZS5zdGFydChbXSk7XG4gICAgICAgIHRoaXMuc2xvd1F1ZXJpZXNQcm92aWRlcnMuaW1tdXRhYmxlLnN0YXJ0KFtdKTtcbiAgICB9XG5cbiAgICBkcm9wQ2FjaGVkRGJJbmZvKCkge1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25zLmZvckVhY2goKHg6IFFEYXRhQ29sbGVjdGlvbikgPT4geC5kcm9wQ2FjaGVkRGJJbmZvKCkpO1xuICAgIH1cblxuICAgIGFzeW5jIHF1ZXJ5KHByb3ZpZGVyOiBRRGF0YVByb3ZpZGVyLCB0ZXh0OiBzdHJpbmcsIHZhcnM6IHsgW3N0cmluZ106IGFueSB9LCBvcmRlckJ5OiBPcmRlckJ5W10pIHtcbiAgICAgICAgcmV0dXJuIHdyYXAodGhpcy5sb2csICdRVUVSWScsIHsgdGV4dCwgdmFycyB9LCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcHJvdmlkZXIucXVlcnkodGV4dCwgdmFycywgb3JkZXJCeSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFzeW5jIGZpbmlzaE9wZXJhdGlvbnMob3BlcmF0aW9uSWRzOiBTZXQ8c3RyaW5nPik6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbnMuZm9yRWFjaCh4ID0+IChjb3VudCArPSB4LmZpbmlzaE9wZXJhdGlvbnMob3BlcmF0aW9uSWRzKSkpO1xuICAgICAgICByZXR1cm4gY291bnQ7XG4gICAgfVxufVxuIl19