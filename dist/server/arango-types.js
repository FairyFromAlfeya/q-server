"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.resolveBigUInt = resolveBigUInt;
exports.convertBigUInt = convertBigUInt;
exports.struct = struct;
exports.array = array;
exports.join = join;
exports.joinArray = joinArray;
exports.bigUInt2 = exports.bigUInt1 = exports.scalar = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

/*
 * Copyright 2018-2019 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at:
 *
 * http://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 */

/**
 * Abstract interface for objects that acts as a helpers to perform queries over documents
 * using query filters.
 */

/**
 * Generates AQL condition for complex filter.
 *
 * @param {string} path Path to document field.
 * @param {object} filter A filter object specified by user.
 * @param {object} fieldTypes A map of available values for filter fields to helpers.
 * @param {function} qlField Function that generates condition for a concrete field.
 * @return {string} AQL condition
 */
function qlFields(path, filter, fieldTypes, qlField) {
  var conditions = [];
  Object.entries(filter).forEach(function (_ref) {
    var _ref2 = (0, _slicedToArray2["default"])(_ref, 2),
        filterKey = _ref2[0],
        filterValue = _ref2[1];

    var fieldType = fieldTypes[filterKey];

    if (fieldType) {
      conditions.push(qlField(fieldType, path, filterKey, filterValue));
    }
  });
  return qlCombine(conditions, 'AND', 'false');
}
/**
 * Test document value against complex filter.
 *
 * @param {any} value Value of the field in document.
 * @param {object} filter A filter object specified by user.
 * @param {object} fieldTypes A map of available values for filter fields to helpers.
 * @param {function} testField Function that performs test value against a selected field.
 * @return {string} AQL condition
 */


function testFields(value, filter, fieldTypes, testField) {
  var failed = Object.entries(filter).find(function (_ref3) {
    var _ref4 = (0, _slicedToArray2["default"])(_ref3, 2),
        filterKey = _ref4[0],
        filterValue = _ref4[1];

    var fieldType = fieldTypes[filterKey];
    return !(fieldType && testField(fieldType, value, filterKey, filterValue));
  });
  return !failed;
}

function combine(path, key) {
  return key !== '' ? "".concat(path, ".").concat(key) : path;
}

function qlOp(path, op, filter) {
  var pathWrapper = path.endsWith('._key') ? "TO_STRING(".concat(path, ")") : path;
  return "".concat(pathWrapper, " ").concat(op, " ").concat(JSON.stringify(filter));
}

function qlCombine(conditions, op, defaultConditions) {
  if (conditions.length === 0) {
    return defaultConditions;
  }

  if (conditions.length === 1) {
    return conditions[0];
  }

  return '(' + conditions.join(") ".concat(op, " (")) + ')';
}

function qlIn(path, filter) {
  var conditions = filter.map(function (value) {
    return qlOp(path, '==', value);
  });
  return qlCombine(conditions, 'OR', 'false');
} // Scalars


var scalarEq = {
  ql: function ql(path, filter) {
    return qlOp(path, '==', filter);
  },
  test: function test(value, filter) {
    return value === filter;
  }
};
var scalarNe = {
  ql: function ql(path, filter) {
    return qlOp(path, '!=', filter);
  },
  test: function test(value, filter) {
    return value !== filter;
  }
};
var scalarLt = {
  ql: function ql(path, filter) {
    return qlOp(path, '<', filter);
  },
  test: function test(value, filter) {
    return value < filter;
  }
};
var scalarLe = {
  ql: function ql(path, filter) {
    return qlOp(path, '<=', filter);
  },
  test: function test(value, filter) {
    return value <= filter;
  }
};
var scalarGt = {
  ql: function ql(path, filter) {
    return qlOp(path, '>', filter);
  },
  test: function test(value, filter) {
    return value > filter;
  }
};
var scalarGe = {
  ql: function ql(path, filter) {
    return qlOp(path, '>=', filter);
  },
  test: function test(value, filter) {
    return value >= filter;
  }
};
var scalarIn = {
  ql: function ql(path, filter) {
    return qlIn(path, filter);
  },
  test: function test(value, filter) {
    return filter.includes(value);
  }
};
var scalarNotIn = {
  ql: function ql(path, filter) {
    return "NOT (".concat(qlIn(path, filter), ")");
  },
  test: function test(value, filter) {
    return !filter.includes(value);
  }
};

function createScalar() {
  var fields = {
    eq: scalarEq,
    ne: scalarNe,
    lt: scalarLt,
    le: scalarLe,
    gt: scalarGt,
    ge: scalarGe,
    "in": scalarIn,
    notIn: scalarNotIn
  };
  return {
    ql: function ql(path, filter) {
      return qlFields(path, filter, fields, function (op, path, filterKey, filterValue) {
        return op.ql(path, filterValue);
      });
    },
    test: function test(value, filter) {
      return testFields(value, filter, fields, function (op, value, filterKey, filterValue) {
        return op.test(value, filterValue);
      });
    }
  };
}

function resolveBigUInt(prefixLength, value) {
  if (value === null || value === undefined) {
    return value;
  }

  return typeof value === 'number' ? "0x".concat(value.toString(16)) : "0x".concat(value.toString().substr(prefixLength));
}

function convertBigUInt(prefixLength, value) {
  if (value === null || value === undefined) {
    return value;
  }

  var hex = BigInt(value).toString(16);
  var len = hex.length.toString(16);
  var missingZeros = prefixLength - len.length;
  var prefix = missingZeros > 0 ? "".concat('0'.repeat(missingZeros)).concat(len) : len;
  return "".concat(prefix).concat(hex);
}

function createBigUInt(prefixLength) {
  var fields = {
    eq: scalarEq,
    ne: scalarNe,
    lt: scalarLt,
    le: scalarLe,
    gt: scalarGt,
    ge: scalarGe,
    "in": scalarIn,
    notIn: scalarNotIn
  };
  return {
    ql: function ql(path, filter) {
      return qlFields(path, filter, fields, function (op, path, filterKey, filterValue) {
        return op.ql(path, convertBigUInt(prefixLength, filterValue));
      });
    },
    test: function test(value, filter) {
      return testFields(value, filter, fields, function (op, value, filterKey, filterValue) {
        return op.test(value, convertBigUInt(prefixLength, filterValue));
      });
    }
  };
}

var scalar = createScalar();
exports.scalar = scalar;
var bigUInt1 = createBigUInt(1);
exports.bigUInt1 = bigUInt1;
var bigUInt2 = createBigUInt(2); // Structs

exports.bigUInt2 = bigUInt2;

function struct(fields, isCollection) {
  return {
    ql: function ql(path, filter) {
      return qlFields(path, filter, fields, function (fieldType, path, filterKey, filterValue) {
        var fieldName = isCollection && filterKey === 'id' ? '_key' : filterKey;
        return fieldType.ql(combine(path, fieldName), filterValue);
      });
    },
    test: function test(value, filter) {
      if (!value) {
        return false;
      }

      return testFields(value, filter, fields, function (fieldType, value, filterKey, filterValue) {
        var fieldName = isCollection && filterKey === 'id' ? '_key' : filterKey;
        return fieldType.test(value[fieldName], filterValue);
      });
    }
  };
} // Arrays


function array(itemType) {
  var ops = {
    all: {
      ql: function ql(path, filter) {
        var itemQl = itemType.ql('CURRENT', filter);
        return "LENGTH(".concat(path, "[* FILTER ").concat(itemQl, "]) == LENGTH(").concat(path, ")");
      },
      test: function test(value, filter) {
        var failedIndex = value.findIndex(function (x) {
          return !itemType.test(x, filter);
        });
        return failedIndex < 0;
      }
    },
    any: {
      ql: function ql(path, filter) {
        var itemQl = itemType.ql('CURRENT', filter);
        return "LENGTH(".concat(path, "[* FILTER ").concat(itemQl, "]) > 0");
      },
      test: function test(value, filter) {
        var succeededIndex = value.findIndex(function (x) {
          return itemType.test(x, filter);
        });
        return succeededIndex >= 0;
      }
    }
  };
  return {
    ql: function ql(path, filter) {
      return qlFields(path, filter, ops, function (op, path, filterKey, filterValue) {
        return op.ql(path, filterValue);
      });
    },
    test: function test(value, filter) {
      if (!value) {
        return false;
      }

      return testFields(value, filter, ops, function (op, value, filterKey, filterValue) {
        return op.test(value, filterValue);
      });
    }
  };
} // Joins


function join(onField, refCollection, refType) {
  return {
    ql: function ql(path, filter) {
      var on_path = path.split('.').slice(0, -1).concat(onField).join('.');
      var alias = "".concat(on_path.replace('.', '_'));
      var refQl = refType.ql(alias, filter);
      return "\n                LENGTH(\n                    FOR ".concat(alias, " IN ").concat(refCollection, "\n                    FILTER (").concat(alias, "._key == ").concat(on_path, ") AND (").concat(refQl, ")\n                    LIMIT 1\n                    RETURN 1\n                ) > 0");
    },
    test: refType.test
  };
}

function joinArray(onField, refCollection, refType) {
  return {
    ql: function ql(path, filter) {
      var refFilter = filter.all || filter.any;
      var all = !!filter.all;
      var on_path = path.split('.').slice(0, -1).concat(onField).join('.');
      var alias = "".concat(on_path.replace('.', '_'));
      var refQl = refType.ql(alias, refFilter);
      return "\n                (LENGTH(".concat(on_path, ") > 0)\n                AND (LENGTH(\n                    FOR ").concat(alias, " IN ").concat(refCollection, "\n                    FILTER (").concat(alias, "._key IN ").concat(on_path, ") AND (").concat(refQl, ")\n                    ").concat(!all ? 'LIMIT 1' : '', "\n                    RETURN 1\n                ) ").concat(all ? "== LENGTH(".concat(on_path, ")") : '> 0', ")");
    },
    test: refType.test
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NlcnZlci9hcmFuZ28tdHlwZXMuanMiXSwibmFtZXMiOlsicWxGaWVsZHMiLCJwYXRoIiwiZmlsdGVyIiwiZmllbGRUeXBlcyIsInFsRmllbGQiLCJjb25kaXRpb25zIiwiT2JqZWN0IiwiZW50cmllcyIsImZvckVhY2giLCJmaWx0ZXJLZXkiLCJmaWx0ZXJWYWx1ZSIsImZpZWxkVHlwZSIsInB1c2giLCJxbENvbWJpbmUiLCJ0ZXN0RmllbGRzIiwidmFsdWUiLCJ0ZXN0RmllbGQiLCJmYWlsZWQiLCJmaW5kIiwiY29tYmluZSIsImtleSIsInFsT3AiLCJvcCIsInBhdGhXcmFwcGVyIiwiZW5kc1dpdGgiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVmYXVsdENvbmRpdGlvbnMiLCJsZW5ndGgiLCJqb2luIiwicWxJbiIsIm1hcCIsInNjYWxhckVxIiwicWwiLCJ0ZXN0Iiwic2NhbGFyTmUiLCJzY2FsYXJMdCIsInNjYWxhckxlIiwic2NhbGFyR3QiLCJzY2FsYXJHZSIsInNjYWxhckluIiwiaW5jbHVkZXMiLCJzY2FsYXJOb3RJbiIsImNyZWF0ZVNjYWxhciIsImZpZWxkcyIsImVxIiwibmUiLCJsdCIsImxlIiwiZ3QiLCJnZSIsIm5vdEluIiwicmVzb2x2ZUJpZ1VJbnQiLCJwcmVmaXhMZW5ndGgiLCJ1bmRlZmluZWQiLCJ0b1N0cmluZyIsInN1YnN0ciIsImNvbnZlcnRCaWdVSW50IiwiaGV4IiwiQmlnSW50IiwibGVuIiwibWlzc2luZ1plcm9zIiwicHJlZml4IiwicmVwZWF0IiwiY3JlYXRlQmlnVUludCIsInNjYWxhciIsImJpZ1VJbnQxIiwiYmlnVUludDIiLCJzdHJ1Y3QiLCJpc0NvbGxlY3Rpb24iLCJmaWVsZE5hbWUiLCJhcnJheSIsIml0ZW1UeXBlIiwib3BzIiwiYWxsIiwiaXRlbVFsIiwiZmFpbGVkSW5kZXgiLCJmaW5kSW5kZXgiLCJ4IiwiYW55Iiwic3VjY2VlZGVkSW5kZXgiLCJvbkZpZWxkIiwicmVmQ29sbGVjdGlvbiIsInJlZlR5cGUiLCJvbl9wYXRoIiwic3BsaXQiLCJzbGljZSIsImNvbmNhdCIsImFsaWFzIiwicmVwbGFjZSIsInJlZlFsIiwiam9pbkFycmF5IiwicmVmRmlsdGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBOzs7OztBQXlCQTs7Ozs7Ozs7O0FBU0EsU0FBU0EsUUFBVCxDQUNJQyxJQURKLEVBRUlDLE1BRkosRUFHSUMsVUFISixFQUlJQyxPQUpKLEVBS1U7QUFDTixNQUFNQyxVQUFvQixHQUFHLEVBQTdCO0FBQ0FDLEVBQUFBLE1BQU0sQ0FBQ0MsT0FBUCxDQUFlTCxNQUFmLEVBQXVCTSxPQUF2QixDQUErQixnQkFBOEI7QUFBQTtBQUFBLFFBQTVCQyxTQUE0QjtBQUFBLFFBQWpCQyxXQUFpQjs7QUFDekQsUUFBTUMsU0FBUyxHQUFHUixVQUFVLENBQUNNLFNBQUQsQ0FBNUI7O0FBQ0EsUUFBSUUsU0FBSixFQUFlO0FBQ1hOLE1BQUFBLFVBQVUsQ0FBQ08sSUFBWCxDQUFnQlIsT0FBTyxDQUFDTyxTQUFELEVBQVlWLElBQVosRUFBa0JRLFNBQWxCLEVBQTZCQyxXQUE3QixDQUF2QjtBQUNIO0FBQ0osR0FMRDtBQU1BLFNBQU9HLFNBQVMsQ0FBQ1IsVUFBRCxFQUFhLEtBQWIsRUFBb0IsT0FBcEIsQ0FBaEI7QUFDSDtBQUVEOzs7Ozs7Ozs7OztBQVNBLFNBQVNTLFVBQVQsQ0FDSUMsS0FESixFQUVJYixNQUZKLEVBR0lDLFVBSEosRUFJSWEsU0FKSixFQUtXO0FBQ1AsTUFBTUMsTUFBTSxHQUFHWCxNQUFNLENBQUNDLE9BQVAsQ0FBZUwsTUFBZixFQUF1QmdCLElBQXZCLENBQTRCLGlCQUE4QjtBQUFBO0FBQUEsUUFBNUJULFNBQTRCO0FBQUEsUUFBakJDLFdBQWlCOztBQUNyRSxRQUFNQyxTQUFTLEdBQUdSLFVBQVUsQ0FBQ00sU0FBRCxDQUE1QjtBQUNBLFdBQU8sRUFBRUUsU0FBUyxJQUFJSyxTQUFTLENBQUNMLFNBQUQsRUFBWUksS0FBWixF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akQ7QUFiWCxHQUFQO0FBZUg7O0FBRUQsU0FBU3lELFNBQVQsQ0FBbUJWLE9BQW5CLEVBQW9DQyxhQUFwQyxFQUEyREMsT0FBM0QsRUFBa0Y7QUFDOUUsU0FBTztBQUNIbEQsSUFBQUEsRUFERyxjQUNBaEMsSUFEQSxFQUNNQyxNQUROLEVBQ2M7QUFDYixVQUFNMEYsU0FBUyxHQUFHMUYsTUFBTSxDQUFDd0UsR0FBUCxJQUFjeEUsTUFBTSxDQUFDNkUsR0FBdkM7QUFDQSxVQUFNTCxHQUFHLEdBQUcsQ0FBQyxDQUFDeEUsTUFBTSxDQUFDd0UsR0FBckI7QUFDQSxVQUFNVSxPQUFPLEdBQUduRixJQUFJLENBQUNvRixLQUFMLENBQVcsR0FBWCxFQUFnQkMsS0FBaEIsQ0FBc0IsQ0FBdEIsRUFBeUIsQ0FBQyxDQUExQixFQUE2QkMsTUFBN0IsQ0FBb0NOLE9BQXBDLEVBQTZDcEQsSUFBN0MsQ0FBa0QsR0FBbEQsQ0FBaEI7QUFDQSxVQUFNMkQsS0FBSyxhQUFNSixPQUFPLENBQUNLLE9BQVIsQ0FBZ0IsR0FBaEIsRUFBcUIsR0FBckIsQ0FBTixDQUFYO0FBQ0EsVUFBTUMsS0FBSyxHQUFHUCxPQUFPLENBQUNsRCxFQUFSLENBQVd1RCxLQUFYLEVBQWtCSSxTQUFsQixDQUFkO0FBQ0EsaURBQ2NSLE9BRGQsMkVBR2NJLEtBSGQsaUJBRzBCTixhQUgxQiwyQ0FJa0JNLEtBSmxCLHNCQUltQ0osT0FKbkMsb0JBSW9ETSxLQUpwRCxvQ0FLVSxDQUFDaEIsR0FBRCxHQUFPLFNBQVAsR0FBbUIsRUFMN0IsK0RBT1FBLEdBQUcsdUJBQWdCVSxPQUFoQixTQUE2QixLQVB4QztBQVFILEtBZkU7QUFnQkhsRCxJQUFBQSxJQUFJLEVBQUVpRCxPQUFPLENBQUNqRDtBQWhCWCxHQUFQO0FBa0JIIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE4LTIwMTkgVE9OIERFViBTT0xVVElPTlMgTFRELlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBTT0ZUV0FSRSBFVkFMVUFUSU9OIExpY2Vuc2UgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxuICogdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlXG4gKiBMaWNlbnNlIGF0OlxuICpcbiAqIGh0dHA6Ly93d3cudG9uLmRldi9saWNlbnNlc1xuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgVE9OIERFViBzb2Z0d2FyZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gQGZsb3dcblxuXG5kZWNsYXJlIGZ1bmN0aW9uIEJpZ0ludChhOiBhbnkpOiBhbnk7XG5cbi8qKlxuICogQWJzdHJhY3QgaW50ZXJmYWNlIGZvciBvYmplY3RzIHRoYXQgYWN0cyBhcyBhIGhlbHBlcnMgdG8gcGVyZm9ybSBxdWVyaWVzIG92ZXIgZG9jdW1lbnRzXG4gKiB1c2luZyBxdWVyeSBmaWx0ZXJzLlxuICovXG50eXBlIFFUeXBlID0ge1xuICAgIC8qKlxuICAgICAqIEdlbmVyYXRlcyBhbiBBcmFuZ28gUUwgY29uZGl0aW9uIGZvciBzcGVjaWZpZWQgZmllbGQgYmFzZWQgb24gc3BlY2lmaWVkIGZpbHRlci5cbiAgICAgKiBUaGUgY29uZGl0aW9uIG11c3QgYmUgYSBzdHJpbmcgZXhwcmVzc2lvbiB0aGF0IGV2YWx1YXRlcyB0byBib29sZWFuLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHBhdGggUGF0aCBmcm9tIGRvY3VtZW50IHJvb3QgdG8gY29uY3JldGUgZmllbGRcbiAgICAgKiBAcGFyYW0ge2FueX0gZmlsdGVyIEZpbHRlciB0aGF0IHdpbGwgYmUgYXBwbGllZCB0byB0aGlzIGZpZWxkXG4gICAgICogQHJldHVybiB7c3RyaW5nfSBBcmFuZ28gUUwgY29uZGl0aW9uIHRleHRcbiAgICAgKi9cbiAgICBxbDogKHBhdGg6IHN0cmluZywgZmlsdGVyOiBhbnkpID0+IHN0cmluZyxcbiAgICAvKipcbiAgICAgKiBUZXN0cyB2YWx1ZSBpbiBkb2N1bWVudCBmcm9tIEFyYW5nbyBEQiBhZ2FpbnN0IHNwZWNpZmllZCBmaWx0ZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2FueX0gdmFsdWUgVmFsdWUgdGhhdCBtdXN0IGJlIHRlc3RlZCBhZ2FpbnN0IGZpbHRlclxuICAgICAqIEBwYXJhbSB7YW55fSBmaWx0ZXIgRmlsdGVyIHVzZWQgdG8gdGVzdCBhIHZhbHVlXG4gICAgICogQHJldHVybiB0cnVlIGlmIHZhbHVlIG1hdGNoZXMgZmlsdGVyXG4gICAgICovXG4gICAgdGVzdDogKHZhbHVlOiBhbnksIGZpbHRlcjogYW55KSA9PiBib29sZWFuLFxufVxuXG5cbi8qKlxuICogR2VuZXJhdGVzIEFRTCBjb25kaXRpb24gZm9yIGNvbXBsZXggZmlsdGVyLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIFBhdGggdG8gZG9jdW1lbnQgZmllbGQuXG4gKiBAcGFyYW0ge29iamVjdH0gZmlsdGVyIEEgZmlsdGVyIG9iamVjdCBzcGVjaWZpZWQgYnkgdXNlci5cbiAqIEBwYXJhbSB7b2JqZWN0fSBmaWVsZFR5cGVzIEEgbWFwIG9mIGF2YWlsYWJsZSB2YWx1ZXMgZm9yIGZpbHRlciBmaWVsZHMgdG8gaGVscGVycy5cbiAqIEBwYXJhbSB7ZnVuY3Rpb259IHFsRmllbGQgRnVuY3Rpb24gdGhhdCBnZW5lcmF0ZXMgY29uZGl0aW9uIGZvciBhIGNvbmNyZXRlIGZpZWxkLlxuICogQHJldHVybiB7c3RyaW5nfSBBUUwgY29uZGl0aW9uXG4gKi9cbmZ1bmN0aW9uIHFsRmllbGRzKFxuICAgIHBhdGg6IHN0cmluZyxcbiAgICBmaWx0ZXI6IGFueSxcbiAgICBmaWVsZFR5cGVzOiB7IFtzdHJpbmddOiBRVHlwZSB9LFxuICAgIHFsRmllbGQ6IChmaWVsZDogYW55LCBwYXRoOiBzdHJpbmcsIGZpbHRlcktleTogc3RyaW5nLCBmaWx0ZXJWYWx1ZTogYW55KSA9PiBzdHJpbmdcbik6IHN0cmluZyB7XG4gICAgY29uc3QgY29uZGl0aW9uczogc3RyaW5nW10gPSBbXTtcbiAgICBPYmplY3QuZW50cmllcyhmaWx0ZXIpLmZvckVhY2goKFtmaWx0ZXJLZXksIGZpbHRlclZhbHVlXSkgPT4ge1xuICAgICAgICBjb25zdCBmaWVsZFR5cGUgPSBmaWVsZFR5cGVzW2ZpbHRlcktleV07XG4gICAgICAgIGlmIChmaWVsZFR5cGUpIHtcbiAgICAgICAgICAgIGNvbmRpdGlvbnMucHVzaChxbEZpZWxkKGZpZWxkVHlwZSwgcGF0aCwgZmlsdGVyS2V5LCBmaWx0ZXJWYWx1ZSkpXG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcWxDb21iaW5lKGNvbmRpdGlvbnMsICdBTkQnLCAnZmFsc2UnKTtcbn1cblxuLyoqXG4gKiBUZXN0IGRvY3VtZW50IHZhbHVlIGFnYWluc3QgY29tcGxleCBmaWx0ZXIuXG4gKlxuICogQHBhcmFtIHthbnl9IHZhbHVlIFZhbHVlIG9mIHRoZSBmaWVsZCBpbiBkb2N1bWVudC5cbiAqIEBwYXJhbSB7b2JqZWN0fSBmaWx0ZXIgQSBmaWx0ZXIgb2JqZWN0IHNwZWNpZmllZCBieSB1c2VyLlxuICogQHBhcmFtIHtvYmplY3R9IGZpZWxkVHlwZXMgQSBtYXAgb2YgYXZhaWxhYmxlIHZhbHVlcyBmb3IgZmlsdGVyIGZpZWxkcyB0byBoZWxwZXJzLlxuICogQHBhcmFtIHtmdW5jdGlvbn0gdGVzdEZpZWxkIEZ1bmN0aW9uIHRoYXQgcGVyZm9ybXMgdGVzdCB2YWx1ZSBhZ2FpbnN0IGEgc2VsZWN0ZWQgZmllbGQuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEFRTCBjb25kaXRpb25cbiAqL1xuZnVuY3Rpb24gdGVzdEZpZWxkcyhcbiAgICB2YWx1ZTogYW55LFxuICAgIGZpbHRlcjogYW55LFxuICAgIGZpZWxkVHlwZXM6IHsgW3N0cmluZ106IFFUeXBlIH0sXG4gICAgdGVzdEZpZWxkOiAoZmllbGRUeXBlOiBhbnksIHZhbHVlOiBhbnksIGZpbHRlcktleTogc3RyaW5nLCBmaWx0ZXJWYWx1ZTogYW55KSA9PiBib29sZWFuXG4pOiBib29sZWFuIHtcbiAgICBjb25zdCBmYWlsZWQgPSBPYmplY3QuZW50cmllcyhmaWx0ZXIpLmZpbmQoKFtmaWx0ZXJLZXksIGZpbHRlclZhbHVlXSkgPT4ge1xuICAgICAgICBjb25zdCBmaWVsZFR5cGUgPSBmaWVsZFR5cGVzW2ZpbHRlcktleV07XG4gICAgICAgIHJldHVybiAhKGZpZWxkVHlwZSAmJiB0ZXN0RmllbGQoZmllbGRUeXBlLCB2YWx1ZSwgZmlsdGVyS2V5LCBmaWx0ZXJWYWx1ZSkpO1xuICAgIH0pO1xuICAgIHJldHVybiAhZmFpbGVkO1xufVxuXG5cbmZ1bmN0aW9uIGNvbWJpbmUocGF0aDogc3RyaW5nLCBrZXk6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGtleSAhPT0gJycgPyBgJHtwYXRofS4ke2tleX1gIDogcGF0aDtcbn1cblxuZnVuY3Rpb24gcWxPcChwYXRoOiBzdHJpbmcsIG9wOiBzdHJpbmcsIGZpbHRlcjogYW55KTogc3RyaW5nIHtcbiAgICBjb25zdCBwYXRoV3JhcHBlciA9IHBhdGguZW5kc1dpdGgoJy5fa2V5JylcbiAgICAgICAgPyBgVE9fU1RSSU5HKCR7cGF0aH0pYFxuICAgICAgICA6IHBhdGg7XG4gICAgcmV0dXJuIGAke3BhdGhXcmFwcGVyfSAke29wfSAke0pTT04uc3RyaW5naWZ5KGZpbHRlcil9YDtcbn1cblxuZnVuY3Rpb24gcWxDb21iaW5lKGNvbmRpdGlvbnM6IHN0cmluZ1tdLCBvcDogc3RyaW5nLCBkZWZhdWx0Q29uZGl0aW9uczogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAoY29uZGl0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRDb25kaXRpb25zO1xuICAgIH1cbiAgICBpZiAoY29uZGl0aW9ucy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGNvbmRpdGlvbnNbMF07XG4gICAgfVxuICAgIHJldHVybiAnKCcgKyBjb25kaXRpb25zLmpvaW4oYCkgJHtvcH0gKGApICsgJyknO1xufVxuXG5mdW5jdGlvbiBxbEluKHBhdGg6IHN0cmluZywgZmlsdGVyOiBhbnkpOiBzdHJpbmcge1xuICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBmaWx0ZXIubWFwKHZhbHVlID0+IHFsT3AocGF0aCwgJz09JywgdmFsdWUpKTtcbiAgICByZXR1cm4gcWxDb21iaW5lKGNvbmRpdGlvbnMsICdPUicsICdmYWxzZScpO1xufVxuXG4vLyBTY2FsYXJzXG5cbmNvbnN0IHNjYWxhckVxOiBRVHlwZSA9IHtcbiAgICBxbChwYXRoLCBmaWx0ZXIpIHtcbiAgICAgICAgcmV0dXJuIHFsT3AocGF0aCwgJz09JywgZmlsdGVyKTtcbiAgICB9LFxuICAgIHRlc3QodmFsdWUsIGZpbHRlcikge1xuICAgICAgICByZXR1cm4gdmFsdWUgPT09IGZpbHRlcjtcbiAgICB9LFxufTtcblxuY29uc3Qgc2NhbGFyTmU6IFFUeXBlID0ge1xuICAgIHFsKHBhdGgsIGZpbHRlcikge1xuICAgICAgICByZXR1cm4gcWxPcChwYXRoLCAnIT0nLCBmaWx0ZXIpO1xuICAgIH0sXG4gICAgdGVzdCh2YWx1ZSwgZmlsdGVyKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZSAhPT0gZmlsdGVyO1xuICAgIH0sXG59O1xuXG5jb25zdCBzY2FsYXJMdDogUVR5cGUgPSB7XG4gICAgcWwocGF0aCwgZmlsdGVyKSB7XG4gICAgICAgIHJldHVybiBxbE9wKHBhdGgsICc8JywgZmlsdGVyKTtcbiAgICB9LFxuICAgIHRlc3QodmFsdWUsIGZpbHRlcikge1xuICAgICAgICByZXR1cm4gdmFsdWUgPCBmaWx0ZXI7XG4gICAgfSxcbn07XG5cbmNvbnN0IHNjYWxhckxlOiBRVHlwZSA9IHtcbiAgICBxbChwYXRoLCBmaWx0ZXIpIHtcbiAgICAgICAgcmV0dXJuIHFsT3AocGF0aCwgJzw9JywgZmlsdGVyKTtcbiAgICB9LFxuICAgIHRlc3QodmFsdWUsIGZpbHRlcikge1xuICAgICAgICByZXR1cm4gdmFsdWUgPD0gZmlsdGVyO1xuICAgIH0sXG59O1xuXG5jb25zdCBzY2FsYXJHdDogUVR5cGUgPSB7XG4gICAgcWwocGF0aCwgZmlsdGVyKSB7XG4gICAgICAgIHJldHVybiBxbE9wKHBhdGgsICc+JywgZmlsdGVyKTtcbiAgICB9LFxuICAgIHRlc3QodmFsdWUsIGZpbHRlcikge1xuICAgICAgICByZXR1cm4gdmFsdWUgPiBmaWx0ZXI7XG4gICAgfSxcbn07XG5cbmNvbnN0IHNjYWxhckdlOiBRVHlwZSA9IHtcbiAgICBxbChwYXRoLCBmaWx0ZXIpIHtcbiAgICAgICAgcmV0dXJuIHFsT3AocGF0aCwgJz49JywgZmlsdGVyKTtcbiAgICB9LFxuICAgIHRlc3QodmFsdWUsIGZpbHRlcikge1xuICAgICAgICByZXR1cm4gdmFsdWUgPj0gZmlsdGVyO1xuICAgIH0sXG59O1xuXG5jb25zdCBzY2FsYXJJbjogUVR5cGUgPSB7XG4gICAgcWwocGF0aCwgZmlsdGVyKSB7XG4gICAgICAgIHJldHVybiBxbEluKHBhdGgsIGZpbHRlcik7XG4gICAgfSxcbiAgICB0ZXN0KHZhbHVlLCBmaWx0ZXIpIHtcbiAgICAgICAgcmV0dXJuIGZpbHRlci5pbmNsdWRlcyh2YWx1ZSk7XG4gICAgfSxcbn07XG5cbmNvbnN0IHNjYWxhck5vdEluOiBRVHlwZSA9IHtcbiAgICBxbChwYXRoLCBmaWx0ZXIpIHtcbiAgICAgICAgcmV0dXJuIGBOT1QgKCR7cWxJbihwYXRoLCBmaWx0ZXIpfSlgO1xuICAgIH0sXG4gICAgdGVzdCh2YWx1ZSwgZmlsdGVyKSB7XG4gICAgICAgIHJldHVybiAhZmlsdGVyLmluY2x1ZGVzKHZhbHVlKTtcbiAgICB9XG59O1xuXG5mdW5jdGlvbiBjcmVhdGVTY2FsYXIoKTogUVR5cGUge1xuICAgIGNvbnN0IGZpZWxkcyA9IHtcbiAgICAgICAgZXE6IHNjYWxhckVxLFxuICAgICAgICBuZTogc2NhbGFyTmUsXG4gICAgICAgIGx0OiBzY2FsYXJMdCxcbiAgICAgICAgbGU6IHNjYWxhckxlLFxuICAgICAgICBndDogc2NhbGFyR3QsXG4gICAgICAgIGdlOiBzY2FsYXJHZSxcbiAgICAgICAgaW46IHNjYWxhckluLFxuICAgICAgICBub3RJbjogc2NhbGFyTm90SW4sXG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgICBxbChwYXRoLCBmaWx0ZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBxbEZpZWxkcyhwYXRoLCBmaWx0ZXIsIGZpZWxkcywgKG9wLCBwYXRoLCBmaWx0ZXJLZXksIGZpbHRlclZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9wLnFsKHBhdGgsIGZpbHRlclZhbHVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB0ZXN0KHZhbHVlLCBmaWx0ZXIpIHtcbiAgICAgICAgICAgIHJldHVybiB0ZXN0RmllbGRzKHZhbHVlLCBmaWx0ZXIsIGZpZWxkcywgKG9wLCB2YWx1ZSwgZmlsdGVyS2V5LCBmaWx0ZXJWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcC50ZXN0KHZhbHVlLCBmaWx0ZXJWYWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICB9O1xufVxuXG5mdW5jdGlvbiByZXNvbHZlQmlnVUludChwcmVmaXhMZW5ndGg6IG51bWJlciwgdmFsdWU6IGFueSk6IHN0cmluZyB7XG4gICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpXG4gICAgICAgID8gYDB4JHt2YWx1ZS50b1N0cmluZygxNil9YFxuICAgICAgICA6IGAweCR7dmFsdWUudG9TdHJpbmcoKS5zdWJzdHIocHJlZml4TGVuZ3RoKX1gO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0QmlnVUludChwcmVmaXhMZW5ndGg6IG51bWJlciwgdmFsdWU6IGFueSk6IHN0cmluZyB7XG4gICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICBjb25zdCBoZXggPSBCaWdJbnQodmFsdWUpLnRvU3RyaW5nKDE2KTtcbiAgICBjb25zdCBsZW4gPSBoZXgubGVuZ3RoLnRvU3RyaW5nKDE2KTtcbiAgICBjb25zdCBtaXNzaW5nWmVyb3MgPSBwcmVmaXhMZW5ndGggLSBsZW4ubGVuZ3RoO1xuICAgIGNvbnN0IHByZWZpeCA9IG1pc3NpbmdaZXJvcyA+IDAgPyBgJHsnMCcucmVwZWF0KG1pc3NpbmdaZXJvcyl9JHtsZW59YCA6IGxlbjtcbiAgICByZXR1cm4gYCR7cHJlZml4fSR7aGV4fWA7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUJpZ1VJbnQocHJlZml4TGVuZ3RoOiBudW1iZXIpOiBRVHlwZSB7XG4gICAgY29uc3QgZmllbGRzID0ge1xuICAgICAgICBlcTogc2NhbGFyRXEsXG4gICAgICAgIG5lOiBzY2FsYXJOZSxcbiAgICAgICAgbHQ6IHNjYWxhckx0LFxuICAgICAgICBsZTogc2NhbGFyTGUsXG4gICAgICAgIGd0OiBzY2FsYXJHdCxcbiAgICAgICAgZ2U6IHNjYWxhckdlLFxuICAgICAgICBpbjogc2NhbGFySW4sXG4gICAgICAgIG5vdEluOiBzY2FsYXJOb3RJbixcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICAgIHFsKHBhdGgsIGZpbHRlcikge1xuICAgICAgICAgICAgcmV0dXJuIHFsRmllbGRzKHBhdGgsIGZpbHRlciwgZmllbGRzLCAob3AsIHBhdGgsIGZpbHRlcktleSwgZmlsdGVyVmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3AucWwocGF0aCwgY29udmVydEJpZ1VJbnQocHJlZml4TGVuZ3RoLCBmaWx0ZXJWYWx1ZSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRlc3QodmFsdWUsIGZpbHRlcikge1xuICAgICAgICAgICAgcmV0dXJuIHRlc3RGaWVsZHModmFsdWUsIGZpbHRlciwgZmllbGRzLCAob3AsIHZhbHVlLCBmaWx0ZXJLZXksIGZpbHRlclZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9wLnRlc3QodmFsdWUsIGNvbnZlcnRCaWdVSW50KHByZWZpeExlbmd0aCwgZmlsdGVyVmFsdWUpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgIH07XG59XG5cbmNvbnN0IHNjYWxhcjogUVR5cGUgPSBjcmVhdGVTY2FsYXIoKTtcbmNvbnN0IGJpZ1VJbnQxOiBRVHlwZSA9IGNyZWF0ZUJpZ1VJbnQoMSk7XG5jb25zdCBiaWdVSW50MjogUVR5cGUgPSBjcmVhdGVCaWdVSW50KDIpO1xuXG4vLyBTdHJ1Y3RzXG5cbmZ1bmN0aW9uIHN0cnVjdChmaWVsZHM6IHsgW3N0cmluZ106IFFUeXBlIH0sIGlzQ29sbGVjdGlvbj86IGJvb2xlYW4pOiBRVHlwZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcWwocGF0aCwgZmlsdGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gcWxGaWVsZHMocGF0aCwgZmlsdGVyLCBmaWVsZHMsIChmaWVsZFR5cGUsIHBhdGgsIGZpbHRlcktleSwgZmlsdGVyVmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSBpc0NvbGxlY3Rpb24gJiYgKGZpbHRlcktleSA9PT0gJ2lkJykgPyAnX2tleScgOiBmaWx0ZXJLZXk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkVHlwZS5xbChjb21iaW5lKHBhdGgsIGZpZWxkTmFtZSksIGZpbHRlclZhbHVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB0ZXN0KHZhbHVlLCBmaWx0ZXIpIHtcbiAgICAgICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGVzdEZpZWxkcyh2YWx1ZSwgZmlsdGVyLCBmaWVsZHMsIChmaWVsZFR5cGUsIHZhbHVlLCBmaWx0ZXJLZXksIGZpbHRlclZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGROYW1lID0gaXNDb2xsZWN0aW9uICYmIChmaWx0ZXJLZXkgPT09ICdpZCcpID8gJ19rZXknIDogZmlsdGVyS2V5O1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZFR5cGUudGVzdCh2YWx1ZVtmaWVsZE5hbWVdLCBmaWx0ZXJWYWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy8gQXJyYXlzXG5cbmZ1bmN0aW9uIGFycmF5KGl0ZW1UeXBlOiBRVHlwZSk6IFFUeXBlIHtcbiAgICBjb25zdCBvcHMgPSB7XG4gICAgICAgIGFsbDoge1xuICAgICAgICAgICAgcWwocGF0aCwgZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbVFsID0gaXRlbVR5cGUucWwoJ0NVUlJFTlQnLCBmaWx0ZXIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBgTEVOR1RIKCR7cGF0aH1bKiBGSUxURVIgJHtpdGVtUWx9XSkgPT0gTEVOR1RIKCR7cGF0aH0pYDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0ZXN0KHZhbHVlLCBmaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmYWlsZWRJbmRleCA9IHZhbHVlLmZpbmRJbmRleCh4ID0+ICFpdGVtVHlwZS50ZXN0KHgsIGZpbHRlcikpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsZWRJbmRleCA8IDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBhbnk6IHtcbiAgICAgICAgICAgIHFsKHBhdGgsIGZpbHRlcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1RbCA9IGl0ZW1UeXBlLnFsKCdDVVJSRU5UJywgZmlsdGVyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYExFTkdUSCgke3BhdGh9WyogRklMVEVSICR7aXRlbVFsfV0pID4gMGA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGVzdCh2YWx1ZSwgZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3VjY2VlZGVkSW5kZXggPSB2YWx1ZS5maW5kSW5kZXgoeCA9PiBpdGVtVHlwZS50ZXN0KHgsIGZpbHRlcikpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdWNjZWVkZWRJbmRleCA+PSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcWwocGF0aCwgZmlsdGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gcWxGaWVsZHMocGF0aCwgZmlsdGVyLCBvcHMsIChvcCwgcGF0aCwgZmlsdGVyS2V5LCBmaWx0ZXJWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcC5xbChwYXRoLCBmaWx0ZXJWYWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdGVzdCh2YWx1ZSwgZmlsdGVyKSB7XG4gICAgICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRlc3RGaWVsZHModmFsdWUsIGZpbHRlciwgb3BzLCAob3AsIHZhbHVlLCBmaWx0ZXJLZXksIGZpbHRlclZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9wLnRlc3QodmFsdWUsIGZpbHRlclZhbHVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vLyBKb2luc1xuXG5mdW5jdGlvbiBqb2luKG9uRmllbGQ6IHN0cmluZywgcmVmQ29sbGVjdGlvbjogc3RyaW5nLCByZWZUeXBlOiBRVHlwZSk6IFFUeXBlIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBxbChwYXRoLCBmaWx0ZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IG9uX3BhdGggPSBwYXRoLnNwbGl0KCcuJykuc2xpY2UoMCwgLTEpLmNvbmNhdChvbkZpZWxkKS5qb2luKCcuJyk7XG4gICAgICAgICAgICBjb25zdCBhbGlhcyA9IGAke29uX3BhdGgucmVwbGFjZSgnLicsICdfJyl9YDtcbiAgICAgICAgICAgIGNvbnN0IHJlZlFsID0gcmVmVHlwZS5xbChhbGlhcywgZmlsdGVyKTtcbiAgICAgICAgICAgIHJldHVybiBgXG4gICAgICAgICAgICAgICAgTEVOR1RIKFxuICAgICAgICAgICAgICAgICAgICBGT1IgJHthbGlhc30gSU4gJHtyZWZDb2xsZWN0aW9ufVxuICAgICAgICAgICAgICAgICAgICBGSUxURVIgKCR7YWxpYXN9Ll9rZXkgPT0gJHtvbl9wYXRofSkgQU5EICgke3JlZlFsfSlcbiAgICAgICAgICAgICAgICAgICAgTElNSVQgMVxuICAgICAgICAgICAgICAgICAgICBSRVRVUk4gMVxuICAgICAgICAgICAgICAgICkgPiAwYDtcbiAgICAgICAgfSxcbiAgICAgICAgdGVzdDogcmVmVHlwZS50ZXN0LFxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGpvaW5BcnJheShvbkZpZWxkOiBzdHJpbmcsIHJlZkNvbGxlY3Rpb246IHN0cmluZywgcmVmVHlwZTogUVR5cGUpOiBRVHlwZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcWwocGF0aCwgZmlsdGVyKSB7XG4gICAgICAgICAgICBjb25zdCByZWZGaWx0ZXIgPSBmaWx0ZXIuYWxsIHx8IGZpbHRlci5hbnk7XG4gICAgICAgICAgICBjb25zdCBhbGwgPSAhIWZpbHRlci5hbGw7XG4gICAgICAgICAgICBjb25zdCBvbl9wYXRoID0gcGF0aC5zcGxpdCgnLicpLnNsaWNlKDAsIC0xKS5jb25jYXQob25GaWVsZCkuam9pbignLicpO1xuICAgICAgICAgICAgY29uc3QgYWxpYXMgPSBgJHtvbl9wYXRoLnJlcGxhY2UoJy4nLCAnXycpfWA7XG4gICAgICAgICAgICBjb25zdCByZWZRbCA9IHJlZlR5cGUucWwoYWxpYXMsIHJlZkZpbHRlcik7XG4gICAgICAgICAgICByZXR1cm4gYFxuICAgICAgICAgICAgICAgIChMRU5HVEgoJHtvbl9wYXRofSkgPiAwKVxuICAgICAgICAgICAgICAgIEFORCAoTEVOR1RIKFxuICAgICAgICAgICAgICAgICAgICBGT1IgJHthbGlhc30gSU4gJHtyZWZDb2xsZWN0aW9ufVxuICAgICAgICAgICAgICAgICAgICBGSUxURVIgKCR7YWxpYXN9Ll9rZXkgSU4gJHtvbl9wYXRofSkgQU5EICgke3JlZlFsfSlcbiAgICAgICAgICAgICAgICAgICAgJHshYWxsID8gJ0xJTUlUIDEnIDogJyd9XG4gICAgICAgICAgICAgICAgICAgIFJFVFVSTiAxXG4gICAgICAgICAgICAgICAgKSAke2FsbCA/IGA9PSBMRU5HVEgoJHtvbl9wYXRofSlgIDogJz4gMCd9KWA7XG4gICAgICAgIH0sXG4gICAgICAgIHRlc3Q6IHJlZlR5cGUudGVzdCxcbiAgICB9O1xufVxuXG5leHBvcnQge1xuICAgIHNjYWxhcixcbiAgICBiaWdVSW50MSxcbiAgICBiaWdVSW50MixcbiAgICByZXNvbHZlQmlnVUludCxcbiAgICBjb252ZXJ0QmlnVUludCxcbiAgICBzdHJ1Y3QsXG4gICAgYXJyYXksXG4gICAgam9pbixcbiAgICBqb2luQXJyYXlcbn1cblxuZXhwb3J0IHR5cGUge1xuICAgIFFUeXBlXG59XG5cbiJdfQ==